!function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/codebase/",o(o.s=36)}([function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={getConfig:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getConfigMysql:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getVersion:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/version").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o(0);var n={errorMessageAjax:function(e){var t=e.response;webix.alert({type:"alert-error",title:"ERROR",text:t})},errorMessage:function(e){webix.alert({type:"alert-error",title:"ERROR",text:e})},normalMessage:function(e){webix.alert({title:"INFORMATION",text:e})},errorRestriccion:function(){webix.alert({title:"INFORMATION",text:"Hay registros dependientes de esta entrada. No se puede eliminar."})},mensajeAceptar:function(e,t){webix.alert({title:"INFORMACIÓN",ok:"Aceptar",text:e,type:"alert-warning"}).then((function(e){t&&t.location.reload(!0)}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o(11),i=o(0),r={getUsuarioCookie:function(){var e=n.a.getCookie("usuarioComercializa");return e?JSON.parse(e):null},setUsuarioCookie:function(e){n.a.setCookie("usuarioComercializa",JSON.stringify(e),1)},deleteUsuarioCookie:function(e){n.a.deleteCookie("usuarioComercializa")},getAccesoCookie:function(){var e=n.a.getCookie("loginComercializa");return e?JSON.parse(e):null},setAccesoCookie:function(e){n.a.setCookie("loginComercializa",JSON.stringify(e),1e5)},deleteAccesoCookie:function(){n.a.deleteCookie("loginComercializa")},checkLoggedUser:function(){var e=r.getUsuarioCookie();return e||(window.open("/#!/login","_blank"),window.close(),!1)},getLogin:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var n=o.urlApi+"/api/usuarios/login",i={usuario:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(n,i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getUsuarios:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getUsuario:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getDepartamentosAsociados:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamentos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuario:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuarioDepartamento:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{departamento:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuario:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e.usuarioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuarioDepartamento:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var n=o.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{departamento:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteUsuario:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteUsuarioDepartamento:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareDataForCombo:function(){return[{id:1,value:"Usuario"},{id:2,value:"Jefe de Equipo"},{id:3,value:"Vigilante"}]}}},function(e,t,o){"use strict";o.d(t,"d",(function(){return U})),o.d(t,"b",(function(){return y})),o.d(t,"c",(function(){return d})),o.d(t,"a",(function(){return v}));var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(){a(this,e)},c=function(){function e(t){a(this,e),this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,o){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),o))return this.show(null)},e.prototype.getParam=function(e,t){var o=this._data[e];if(void 0!==o||!t)return o;var n=this.getParentView();return n?n.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(o){return(o.config.id===e||o.config.localId===e)&&o.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,o){var n=e.attachEvent(t,o);return this._events.push({obj:e,id:n}),n},e.prototype.contains=function(e){for(var t in this._subs){var o=this._subs[t].view;if(o===e||o.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var o=t.view._getDefaultSub();if(o)return o}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function l(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),o=[],n=0;n<t.length;n++){var i=t[n],r={},a=i.indexOf(":");if(-1===a&&(a=i.indexOf("?")),-1!==a){var s=i.substr(a+1).split(/[\:\?\&]/g),c=Array.isArray(s),l=0;for(s=c?s:s[Symbol.iterator]();;){var u;if(c){if(l>=s.length)break;u=s[l++]}else{if((l=s.next()).done)break;u=l.value}var p=u.split("=");r[p[0]]=decodeURIComponent(p[1])}}o[n]={page:a>-1?i.substr(0,a):i,params:r,isNew:!0}}return o}function u(e){var t=[],o=e,n=Array.isArray(o),i=0;for(o=n?o:o[Symbol.iterator]();;){var r;if(n){if(i>=o.length)break;r=o[i++]}else{if((i=o.next()).done)break;r=i.value}var a=r;t.push("/"+a.page);var s=p(a.params);s&&t.push("?"+s)}return t.join("")}function p(e){var t=[];for(var o in e)t.length&&t.push("&"),t.push(o+"="+encodeURIComponent(e[o]));return t.join("")}var f=function(){function e(t,o){a(this,e),this._next=1,this.route="string"==typeof t?{url:l(t),path:t}:t,this.index=o}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(){return new e(this.route,this.index+this._next)},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=u(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var o=this.route.url;if(null===e)return o;var n=this.route.url;if(o=n.slice(0,this.index+(t?this._next:0)),e){o=o.concat(l(e));for(var i=0;i<o.length;i++)n[i]&&(o[i].view=n[i].view),n[i]&&o[i].page===n[i].page&&(o[i].isNew=!1)}return o},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=u(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,o){var n=this,i=this._join(e,o);return new Promise((function(e,o){var r=u(i),a={url:i,redirect:r,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[a.redirect,t,a]))return void o(new s);a.confirm.catch((function(e){return o(e)})).then((function(){if(null!==a.redirect){if(a.redirect!==r)return c.show(a.redirect),void o(new s);n.route.path=r,n.route.url=i,e()}else o(new s)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=u(t.url)),new e(t,0)},e.prototype.update=function(e,t,o){var n=this.route.url[this.index+(o||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(e,t,o);""===e?n.page=t:n.params[e]=t,this.route.path=u(this.route.url)},e}(),d=function(e){function t(o,n){a(this,t);var r=i(this,e.call(this,o.webix));return r.app=o,r._children=[],r}return r(t,e),t.prototype.ui=function(e,t){var o=(t=t||{}).container||e.container,i=this.app.createView(e);return this._children.push(i),i.render(o,this._segment,this),"object"!==(void 0===e?"undefined":n(e))||e instanceof c?i:i.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"===(void 0===e?"undefined":n(e))){for(var o in e)this.setParam(o,e[o]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var i=this.getParentView();return i?i.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var r=this.getSubViewInfo(t.target);if(r){if(r.parent!==this)return r.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,r.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},t.prototype._show=function(e,t,o){var n=this;return e.show(t,o,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){e.route.linkRouter&&(n.app.getRouter().set(e.route.path,{silent:!0}),n.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,o){var n=this;"string"==typeof t&&(t=new f(t,0)),this._segment=t,this._parent=o,this._init_url_data();var i="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==i?(this._container=i,this._render(t)):this._urlChange().then((function(){return n.getRoot()}))},t.prototype._render=function(e){var t=this,o=this.config();return o.then?o.then((function(o){return t._render_final(o,e)})):this._render_final(o,e)},t.prototype._render_final=function(e,t){var o=this,n=null,i=null,r=!1;if(this._container.tagName?i=this._container:(n=this._container).popup?(i=document.body,r=!0):i=this.webix.$$(n.id),!this.app||!i)return Promise.reject(null);var a=void 0,s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!n&&s.isNew&&s.view&&s.view.destructor();try{if(n&&!r){var l=i,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,i);var p=this._root;r&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),a=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){a=Promise.reject(e)}return a.catch((function(e){return o._initError(o,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var o in this._subs){var n=this._subs[o],i=this._renderFrameLock(o,n,null);i&&t.push(i)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,o){if(!t.lock){var n=this._renderFrame(e,t,o);n&&(t.lock=n.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,o){var n=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==o&&(t.url=o),t.route){if(null!==o)return t.route.show(o,t.view).then((function(){return n._createSubView(t,t.route)}));if(t.branch)return}var i=t.view;if(!i&&t.url){if("string"==typeof t.url)return t.route=new f(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||i instanceof t.url||(i=new t.url(this.app,"")),i||(i=t.url)}if(i)return i.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var o=this;return this.app.createFromURL(t.current()).then((function(n){return n.render(e,t,o)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(c),h=function(e){function t(o,n){a(this,t);var r=i(this,e.call(this,o,n));return r._ui=n.ui,r}return r(t,e),t.prototype.config=function(){return this._ui},t}(d),m=function(){function e(t,o,n){a(this,e),this.path="",this.app=n}return e.prototype.set=function(e,t){this.path=e;var o=this.app;o.app.getRouter().set(o._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),b=!0,g=function(e){function t(o){a(this,t);var n=(o||{}).webix||window.webix,r=i(this,e.call(this,n));return r.config=r.webix.extend({name:"App",version:"1.0",start:"/home"},o,!0),r.app=r.config.app,r.ready=Promise.resolve(),r._services={},r.webix.extend(r,r.webix.EventSystem),r}return r(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,o){if((e instanceof c||"function"==typeof e&&e.prototype instanceof c)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,o);for(var i in t=t||(e instanceof Array?[]:{}),e){var r=e[i];if("function"==typeof r&&r.prototype instanceof c&&(r={$subview:r}),!r||"object"!==(void 0===r?"undefined":n(r))||r instanceof this.webix.DataCollection||r instanceof RegExp||r instanceof Map)t[i]=r;else if(r instanceof Date)t[i]=new Date(r);else{var a=this.copyConfig(r,r instanceof Array?[]:{},o);null!==a&&(t[i]=a)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var o=t.getAttribute("trigger");if(o)return this._forView(t,(function(e){return e.app.trigger(o)})),e.cancelBubble=!0,e.preventDefault();var n=t.getAttribute("route");if(n)return this._forView(t,(function(e){return e.show(n)})),e.cancelBubble=!0,e.preventDefault()}var i=t.parentNode;i&&this.clickHandler(e,i)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,o=this.config.views,n=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{o&&"string"==typeof(n="function"==typeof o?o(e):o[e])&&(e=n,n=null),n||(n="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){n=this._loadError(e,t)}return n.then||(n=Promise.resolve(n)),n=n.then((function(e){return e.__esModule?e.default:e})).catch((function(o){return t._loadError(e,o)}))},t.prototype._forView=function(e,t){var o=this.webix.$$(e);o&&t(o.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},t.prototype.createView=function(e,o){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:o,router:m});if(e.prototype instanceof c)return new e(this,{name:o});e=e(this)}return e instanceof c?e:new h(this,{name:o,ui:e})},t.prototype.show=function(e){return this.render(this._container,e||this.config.start)},t.prototype.trigger=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];this.apply(e,o)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,o=Array(t),n=0;n<t;n++)o[n]=arguments[n];this.apply(e,o)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var o=0;o<t.length;o++)if(console.error(t[o]),t[o]instanceof Error){var n=t[o].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},t.prototype.render=function(e,t,o){var n=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var i=null;!this.$router?(b&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return n.clickHandler(e)})),b=!1),"string"==typeof t&&(t=new f(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):i="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var r=this.getSubView(),a=this._subSegment,s=a.show(i,r).then((function(){return n.createFromURL(a.current())})).then((function(t){return t.render(e,a)})).then((function(e){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),e}));return this.ready=this.ready.then((function(){return s})),s},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new d(this,{})},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof s))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var o=this._container;this.webix.html.addCss(o,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(o,"webixappstart"),t.webix.html.addCss(o,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new f(this.config.start,0));else{var n=this.$router.get();n||(n=this.config.start,this.$router.set(n,{silent:!0})),e=new f(n,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,o){var n=!0!==e.$subview?e.$subview:null,i=e.name||(n?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(o[i]={id:t.id,url:n,branch:e.branch,popup:e.popup}).popup?null:t},t}(c),v=function(){function e(t,o){var n=this;a(this,e),this.config=o||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return n.cb(n.get())}}return e.prototype.set=function(e,t){var o=this;if(this.config.routes){var n=e.split("?",2);for(var i in this.config.routes)if(this.config.routes[i]===n[0]){e=i+(n.length>1?"?"+n[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),o=this.config.routes[t[0]];o&&(e=o+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),w=!1;function $(e){if(!w&&e){w=!0;var t=window;t.Promise||(t.Promise=e.promise);var o=e.version.split(".");10*o[0]+1*o[1]<53&&(e.ui.freeze=function(t){var o=t();return o&&o.then?o.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),o});var i=e.ui.baselayout.prototype.addView,r=e.ui.baselayout.prototype.removeView,a={addView:function(e,t){var o=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return i.apply(this,arguments);var r=function(){var n=o.$scope,r={};e=n.app.copyConfig(e,{},r),i.apply(o,[e,t]);var a=function(e){n._renderFrame(e,r[e],null).then((function(){n._subs[e]=r[e]}))};for(var s in r)a(s);return{v:e.id}}();return"object"===(void 0===r?"undefined":n(r))?r.v:void 0},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var o in t){var n=t[o];e.$$(n.id)||(n.view.destructor(),delete t[o])}}}};e.extend(e.ui.layout.prototype,a,!0),e.extend(e.ui.baselayout.prototype,a,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var o=e.uid().toString();for(var n in t.body={id:o},this.$ready.push((function(){this.$app.render({id:o})})),this.$app){var i=this.$app[n];"function"!=typeof i||this[n]||(this[n]=i.bind(this.$app))}}},e.ui.proxy)}}var y=function(e){function t(o){a(this,t),o.router=o.router||v;var n=i(this,e.call(this,o));return $(n.webix),n}return r(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),o(38)("./"+e)},t}(g);(function(){function e(t,o,n){a(this,e),this.storage=o.storage||n.webix.storage.session,this.name=o.storeName||o.id+":route",this.cb=t}e.prototype.set=function(e,t){var o=this;this.storage.put(this.name,e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.storage.get(this.name)}})(),function(e){function t(){return a(this,t),i(this,e.apply(this,arguments))}r(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function e(t,o){a(this,e),this.path="",this.cb=t}e.prototype.set=function(e,t){var o=this;this.path=e,t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.path}}();function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function P(e,t,o){for(var n in e)x(e,n)&&t.call(o||e,e[n],n,e)}function C(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var j=String.prototype.replace,_=String.prototype.split,E=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},A={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:E,chinese:function(){return 0},croatian:E,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:E,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},S={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function I(e){var t,o=(t={},P(S,(function(e,o){P(e,(function(e){t[e]=o}))})),t);return o[e]||o[_.call(e,/-/,1)[0]]||o.en}function F(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var T=/\$/g,V=/%\{(.*?)\}/g;function R(e,t,o,n){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var i=e,r=n||V,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&i){var s=_.call(i,"||||");i=(s[function(e,t){return A[I(e)](t)}(o||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return i=j.call(i,r,(function(e,t){return x(a,t)&&null!=a[t]?j.call(a[t],T,"$$"):e}))}function k(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var o=t.allowMissing?R:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:o,this.warn=t.warn||C,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",o=e&&e.suffix||"}";if("||||"===t||"||||"===o)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(F(t)+"(.*?)"+F(o),"g")}(t.interpolation)}k.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},k.prototype.extend=function(e,t){P(e,(function(e,o){var i=t?t+"."+o:o;"object"===(void 0===e?"undefined":n(e))?this.extend(e,i):this.phrases[i]=e}),this)},k.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:P(e,(function(e,o){var i=t?t+"."+o:o;"object"===(void 0===e?"undefined":n(e))?this.unset(e,i):delete this.phrases[i]}),this)},k.prototype.clear=function(){this.phrases={}},k.prototype.replace=function(e){this.clear(),this.extend(e)},k.prototype.t=function(e,t){var o,n,i=null==t?{}:t;if("string"==typeof this.phrases[e])o=this.phrases[e];else if("string"==typeof i._)o=i._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,i,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof o&&(n=R(o,i,this.currentLocale,this.tokenRegex)),n},k.prototype.has=function(e){return x(this.phrases,e)},k.transformPhrase=function(e,t,o){return R(e,t,o)};var O=k;function N(e,t,o){if(t.urls)o=t.urls[o]||o;else if(t.param){var n;(n={})[t.param]=o,o=n}e.show(o)}var D={good:"check",error:"warning",saving:"refresh fa-spin"},L={good:"Ok",error:"Error",saving:"Connecting..."};function M(e,t,o){for(var n=0;n<o.length;n++)e[o[n]]=t[n+1]?t[n+1].page:""}var G=window.webix;G&&$(G);var U={UnloadGuard:function(e,t,o){t.on(e,"app:guard",(function(e,n,i){if(n===t||n.contains(t)){var r=o();i.confirm=!1===r?Promise.reject(new s):i.confirm.then((function(){return r}))}}))},Locale:function(e,t,n){var i=(n=n||{}).storage,r=i?i.get("lang")||"en":n.lang||"en";function a(t,o,a){o.__esModule&&(o=o.default);var s={phrases:o};n.polyglot&&e.webix.extend(s,n.polyglot);var l=c.polyglot=new O(s);if(l.locale(t),c._=e.webix.bind(l.t,l),r=t,i&&i.put("lang",r),n.webix){var u=n.webix[t];u&&e.webix.i18n.setLocale(u)}return a?Promise.resolve():e.refresh()}function s(e,t){if(!1!==n.path){var i=(n.path?n.path+"/":"")+e;a(e,o(39)("./"+i),t)}}var c={getLang:function(){return r},setLang:s,setLangData:a,_:null,polyglot:null};e.setService("locale",c),s(r,!0)},Menu:function(e,t,o){var n=t.getSubViewInfo().parent,i=t.$$(o.id||o),r=!1;i.attachEvent("onchange",(function(){r||N(n,o,this.getValue())})),i.attachEvent("onafterselect",(function(){if(!r){var e=null;i.setValue?e=this.getValue():i.getSelectedId&&(e=i.getSelectedId()),N(n,o,e)}})),t.on(e,"app:route",(function(){var e="";if(o.param)e=t.getParam(o.param,!0);else{var a=n.getUrl()[1];a&&(e=a.page)}e&&(r=!0,i.setValue&&i.getValue()!==e?i.setValue(e):i.select&&i.exists(e)&&i.getSelectedId()!==e&&i.select(e),r=!1)}))},Theme:function(e,t,o){var n=(o=o||{}).storage,i=n?n.get("theme")||"flat-default":o.theme||"flat-default",r={getTheme:function(){return i},setTheme:function(t,o){for(var r=t.split("-"),a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var c=a[s].getAttribute("title");c&&(c===t||c===r[0]?a[s].disabled=!1:a[s].disabled=!0)}e.webix.skin.set(r[0]),e.webix.html.removeCss(document.body,"theme-"+i),e.webix.html.addCss(document.body,"theme-"+t),i=t,n&&n.put("theme",t),o||e.refresh()}};e.setService("theme",r),r.setTheme(i,!0)},User:function(e,t,o){var n=(o=o||{}).login||"/login",i=o.logout||"/logout",r=o.afterLogin||e.config.start,a=o.afterLogout||"/login",s=o.ping||3e5,c=o.model,l=o.user,u={getUser:function(){return l},getStatus:function(e){return e?c.status().catch((function(){return null})).then((function(e){l=e})):null!==l},login:function(t,o){return c.login(t,o).then((function(t){if(l=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[l]),e.show(r)}))},logout:function(){return l=null,c.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function p(e,t){e===i?(u.logout(),t.redirect=a):e===n||u.getStatus()||(t.redirect=n)}e.setService("user",u),e.attachEvent("app:guard",(function(e,t,n){return!(!o.public||!o.public(e))||(void 0===l&&(n.confirm=u.getStatus(!0).then((function(){return p(e,n)}))),p(e,n))})),s&&setInterval((function(){return u.getStatus(!0)}),s)},Status:function(e,t,o){var n="good",i=0,r=!1,a=o.expire;a||!1===a||(a=2e3);var s=o.texts||L,c=o.icons||D;function l(e){var i=t.$$(o.target);i&&(e||(e="<div class='status_"+n+"'><span class='webix_icon fa-"+c[n]+"'></span> "+s[n]+"</div>"),i.setHTML(e))}function u(){i--,h("good")}function p(e){i--,h("error",e)}function f(e){i++,h("saving"),e&&e.then&&e.then(u,p)}function d(){0===i&&l(" ")}function h(t,o){i<0&&(i=0),"saving"===t?(n="saving",l()):(r="error"===t,0===i&&(n=r?"error":"good",r?e.error("app:error:server",[o.responseText||o]):a&&setTimeout(d,a),l()))}function m(o){var n=e.webix.dp(o);n&&(t.on(n,"onAfterDataSend",f),t.on(n,"onAfterSaveError",(function(e,t,o){return p(o)})),t.on(n,"onAfterSave",u))}"string"==typeof o&&(o={target:o}),e.setService("status",{getStatus:function(){return n},setStatus:h,track:m}),o.remote&&t.on(e.webix,"onRemoteCall",f),o.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,o,n,i,r,a){f(a)})),o.data&&m(o.data)},UrlParam:function(e,t,o){var n=o.route||o,i={};t.on(e,"app:urlchange",(function(e,o){t===e&&(M(i,o.suburl(),n),o.size(n.length+1))}));var r=t.setParam,a=t.getParam;t.setParam=function(e,o,a){var s=n.indexOf(e);return s>=0?(i[e]=o,this._segment.update("",o,s+1),a?t.show(null):void 0):r.call(this,e,o,a)},t.getParam=function(e,t){var o=i[e];return void 0!==o?o:a.call(this,e,t)},M(i,t.getUrl(),n)}},z=window;z.Promise||(z.Promise=z.webix.promise)},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={prepareDataForDataTable:function(e,t){var o=[];return t.forEach((function(t){t.id=t[e],o.push(t)})),o},prepareDataForCombo:function(e,t,o){var n=[];return o.forEach((function(o){n.push({id:o[e],value:o[t]})})),n}}},function(e,t,o){"use strict";o.r(t),o.d(t,"languageService",(function(){return r}));var n=o(3),i={es:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},en:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},fr:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}}},r={setLanguage:function(e,t){e.use(n.d.Locale,{lang:t}),webix.i18n.locales[t]=i[t],webix.i18n.setLocale(t)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getCliente:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesAgenteActivos:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/clientes-activos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesActivosLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/clientes/activo/login",i={cliente:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(n,i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},putClienteLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/clientes/restablece/loginPass/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{cliente:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},postClientePorCampo:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/recupera/cliente/activo/campo/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{valor:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getServiciosPartes:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/servicios/partes/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},getServicioParte:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/servicios/parte/uno/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},getServiciosComercial:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/agente/"+e.comercialId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getServicio:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getNumServicio:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/servicios/nuevo/numero/servicio";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},postServicioWeb:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/web";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{servicio:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putServicio:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e.servicioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{servicio:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteServicio:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareData:function(e){return e.forEach((function(e){e.fechaEntrada&&(e.fechaEntrada=new Date(e.fechaEntrada))})),e}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getAgentes:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getAgentesNombre:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/activos/?nombre="+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgente:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgenteCliente:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agente/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSyncAgentes:function(){var e=n.a.geturlApi()+"/api/comerciales/",t=webix.ajax().headers({"Content-Type":"application/json"}).sync().get(e),o={data:null,err:null};return 200!=t.status?o.err=t:o.data=JSON.parse(t.response),o},getAgentesActivosLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/comerciales/login",i={login:e,password:t};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(n,i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},postComercialPorCampo:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/recupera/comercial/activo/campo/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{valor:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putComercialLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/comerciales/restablece/loginPass/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{comercial:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getEmpresas:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getEmpresa:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postEmpresa:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putEmpresa:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteEmpresa:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getFacturasReparaciones:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/facturas/solo/reparaciones";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getFacturasClienteAgenteDepartamento:function(e,t,o){return new webix.promise((function(i,r){n.a.getConfig().then((function(n){var i=n.urlApi+"/api/facturas/cliente-agente/recupera/todas/"+t+"/"+o+"/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){i(e.json())})).catch((function(e){r(e)}))}))},getFacprovesReparaciones:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/facturasProveedores/solo/reparaciones";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},recuperaFechaCobroCli:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/facturas/recupera/fecha/cobro/conta/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},recuperaFechaPagoPro:function(e,t,o){return new webix.promise((function(i,r){n.a.getConfig().then((function(n){var i=n.urlApi+"/api/facturasProveedores/recupera/fecha/cobro/conta/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){i(e.json())})).catch((function(e){r(e)}))}))},postGeneraFacturasClientes:function(e,t,o,i){return new webix.promise((function(r,a){n.a.getConfig().then((function(n){var r=n.urlApi+"/api/facturas/factura/cliente/parte/"+t+"/"+o+"/"+i;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(r,{seleccionados:e})})).then((function(e){r(e.json())})).catch((function(e){a(e)}))}))},postGeneraPrefacturasClientes:function(e,t,o,i){return new webix.promise((function(r,a){n.a.getConfig().then((function(n){var r=n.urlApi+"/api/prefacturas/prefactura/cliente/parte/"+t+"/"+o+"/"+i;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(r,{seleccionados:e})})).then((function(e){r(e.json())})).catch((function(e){a(e)}))}))},postGeneraFacturasProfesionales:function(e,t,o,i){return new webix.promise((function(r,a){n.a.getConfig().then((function(n){var r=n.urlApi+"/api/facturas/factura/cliente/parte/"+t+"/"+o+"/"+i;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(r,{seleccionados:e})})).then((function(e){r(e.json())})).catch((function(e){a(e)}))}))},postGeneraFacturasProveedores:function(e,t,o,i){return new webix.promise((function(r,a){n.a.getConfig().then((function(n){var r=n.urlApi+"/api/facturasProveedores/factura/proveedores/parte/"+t+"/"+o+"/"+i;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(r,{seleccionados:e})})).then((function(e){r(e.json())})).catch((function(e){a(e)}))}))},putLineaFacprove:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/facturasProveedores/actualiza/linea/desde/parte/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{datos:e})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},putCabFacprove:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturasProveedores/actualiza/cabecera/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaFacprove:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/facturasProveedores/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n,{facproveLinea:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},putLineaFactura:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturas/actualiza/linea/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putCabFactura:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturas/actualiza/cabecera/factura/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaFactura:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/facturas/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n,{facturaLinea:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},deleteAntprove:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/anticiposProveedores/borrar/desde/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n,{proveedorId:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},deleteAntclien:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/anticiposClientes/borrar/desde/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n,{clienteId:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={areCookiesEnabled:function(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie",e=-1!=document.cookie.indexOf("testcookie")),e},setCookie:function(e,t,o){n.areCookiesEnabled()||alert("NO COOKIES");var i=new Date;i.setDate(i.getDate()+o);var r=encodeURI(t)+(null==o?"":"; expires="+i.toUTCString());document.cookie=e+"="+r},deleteCookie:function(e){n.areCookiesEnabled()||alert("NO COOKIES"),document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},getCookie:function(e){var t,o,n,i=document.cookie.split(";");for(t=0;t<i.length;t++)if(o=i[t].substr(0,i[t].indexOf("=")),n=i[t].substr(i[t].indexOf("=")+1),(o=o.replace(/^\s+|\s+$/g,""))==e)return decodeURI(n)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getTiposProfesional:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getTiposProfesionalesTarifa:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/tarifa/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getTipoProfesional:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postTipoProfesional:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{tipoProfesional:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putTipoProfesional:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{tipoProfesional:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteTipoProfesional:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={postCorreo:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/correoElectronico/enlace";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,e)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postCorreoNuevoServicio:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/enviar/correo/servicio/web";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{correo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var n,i=o(3),r=(o(2),o(0));function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"facturasEpisReport",position:"top",move:!0,resize:!0,scroll:"x,y",width:1129,height:775,fullscreen:!1,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("facturasEpisReport").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){r.a.getConfigMysql().then((function(e){n=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){$$("facturasEpisReport").show();var o=new Stimulsoft.Viewer.StiViewerOptions;Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile("../stireport/localization/es.xml",!0),Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHltN9ZO4D78QwpEoh6+UpBm5mrGyhSAIsuWoljPQdUv6R6vgviStsx8W3jirJvfPH27oRYrC2WIPEmaoAZTNtqb+nDxUpJlSmG62eA46oRJDV8kJ2cJSEx19GMJXYgZvv7yQT9aJHYaSrTVD7wdhpNVS1nQC3OtisVd7MQNQeM40GJxcZpyZDPfvld8mK6VX0RTPJsQZ7UcCEH4Y3LaKzA5DmUS+mwSnjXz/JFv1uO2JNkfcioieXfYfTaBIgZlKecarCS5vBgMrXly3m5kw+YwpJ2v+cMXuDk3UrZgrdxNnOhg8ZHPg9ijHxqUomZZBzKpVQU0d06ne60j/liMH5KirAI2JCVfBcBvIcyliJos8LAWr9q/1sPR9y7LmA1eyS1/dXaxmEaqi5ubhLqlf+OS0xFX6tlBBgegqHlIj6Fytwvq5YlGAZ0Cra05JhnKh/ohYlADQz6Jbg5sOKyn5EbejvPS3tWr0LRBH2FO6+mJaSEAwzGmoWT057ScSvGgQmfx8wCqSF+PgK/zTzjy75Oh",StiOptions.WebServer.url=n.report.stiUrl,o.appearance.scrollbarsMode=!0,o.appearance.fullScreenMode=!1,o.toolbar.showSendEmailButton=!1,o.toolbar.viewMode=Stimulsoft.Viewer.StiWebViewMode.Continuous;var i=new Stimulsoft.Viewer.StiViewer(o,"StiViewer",!1),r=new Stimulsoft.Report.StiReport;r.loadFile(t);n.report.host;n.report.database,n.report.user,n.report.password;for(var a=0;a<r.dataSources.items.length;a++)r.dataSources.items[a].sqlCommand;var s=r.dataSources.items[0].sqlCommand;s=s+" WHERE pf.facturaId = "+e,r.dataSources.items[0].sqlCommand=s,i.report=r,i.renderHtml("report_viewer")},t.prototype.cancel=function(){$$("facturasEpisReport").hide()},t}(i.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app.getService("locale")._;return{view:"sidebar",width:280,id:"main:menu",activeTitle:!0,select:!0,on:{onBeforeSelect:function(e){if("partes"===e&&2!=i.a.checkLoggedUser().tipoComercialId)return!1;if("creacionServicioForm"===e&&1!=i.a.checkLoggedUser().tipoComercialId)return!1}},data:[{id:"inicio",icon:"mdi mdi-home",value:"Inicio"},{id:"Reparaciones",icon:"mdi mdi-book",value:e("Reparaciones"),open:!0,data:[{id:"facturas",icon:"mdi mdi-currency-eur",value:e("Facturas")},{id:"servicios",icon:"mdi mdi-transcribe",value:e("Servicios")},{id:"tarifas",icon:"mdi mdi-format-list-numbers",value:e("Tarifas")},{id:"partes",icon:"mdi mdi-format-list-numbers",value:e("Partes")},{id:"creacionServicioForm",icon:"mdi mdi-format-list-numbers",value:e("Solicitud de servicio")}]}]}},t.prototype.init=function(){this.use(n.d.Menu,"main:menu")},t}(n.c);t.default=s},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(5);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app,o=(t.getService("locale"),t.getService("theme"),i.a.getUsuarioCookie());this.app.getService("locale")._;return{view:"toolbar",height:60,elements:[{view:"button",type:"icon",icon:"mdi mdi-menu",width:37,align:"left",click:function(){$$("main:menu").toggle()}},{view:"label",label:"<a href='#!/top/inicio'><img src='assets/img/logo.png' height='50' /></a>",width:150},{view:"button",width:60,label:'<span class="mdi mdi-account-key mdi-36px mystyle"></span>'},{height:46,id:"person_template",css:"header_person",borderless:!0,data:o,template:function(e){var t="<div style='height:100%;width:100%;'>";return t+="<span class='name'>"+e.nombre+"</span> </div>"}},{view:"label",label:"\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t<img style=\"vertical-align:middle\" src='assets/img/handshake.png' height='35' />\n\t\t\t\t\t\t<span>"+this.app.config.name+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t",width:200},{view:"button",type:"icon",icon:"mdi mdi-exit-run mdi-36px",width:50,align:"right",tooltip:"Salir",click:function(){i.a.deleteUsuarioCookie(),e.show("/login")}}]}},t.prototype.init=function(){i.a.checkLoggedUser(),r.languageService.setLanguage(this.app,"es")},t}(n.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=(o(11),o(0)),a=function(){return new webix.promise((function(e,t){r.a.getConfig().then((function(e){var t=e.urlApi+"/api/version";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t,null)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;e.getService("locale"),e.getService("theme"),i.a.getUsuarioCookie(),this.app.getService("locale")._;return{view:"label",id:"vers",align:"center",label:"NREG: ",height:60,minWidth:100}},t.prototype.init=function(){a().then((function(e){$$("vers").config.label="Proasistencia "+e.version+" - Aplicación general © Ariadna Software S.L. 2019-2020",$$("vers").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?messageApi.errorRestriccion():messageApi.errorMessageAjax(e)}))},t}(n.c);t.default=l},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(0),i={getTarifaProfesiones:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/tarifas_cliente/cliente-agente/recupera/tarifa-profesiones/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},getLineasTarifaProfesion:function(e,t){var o=[];return o.push(t),new webix.promise((function(t,i){n.a.getConfig().then((function(t){var n=t.urlApi+"/api/tarifas_cliente/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(n,{tiposProfesionales:o})})).then((function(e){t(e.json())})).catch((function(e){i(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(10),a=o(1),s=o(4),c=o(5),l=o(9),u=o(14);function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){return p(this,t),f(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,o=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Facturas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("facturasGrid"),{filename:"facturas",name:"Partes",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"facturasNReg",label:"NREG: "},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},((e={view:"datatable",css:{"font-size":"0.9em"},id:"facturasGrid",scroll:"x,y",pager:"mypager1",select:"row",scheme:{$change:function(e){$$("facturasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"facturaId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"numeroFactura",header:[{text:"Numero.",css:{"text-align":"left"}},{content:"textFilter"}],sort:"string",adjust:!0,css:{"text-align":"left"}},{id:"emisorNombre",header:["Emp.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"receptorNombre",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fecha",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"total",header:["Base",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"totalConIva",header:["Total",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"formaPagoNombre",header:["Forma de pago",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-printer'></span>",css:{"text-align":"center"},adjust:"header"}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var n=this,i=this.data.pull[t.row];l.a.getEmpresa(i.empresaId).then((function(e){if(e.infFacCliRep){var t="/stireport/reports/"+e.infFacCliRep+".mrt";n.$scope.imprimirWindow.showWindow(i.facturaId,t)}else a.a.errorMessage("Esta empresa no tiene plantilla de factura asociada")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridFacturas",this.getState())}},e)]}},t.prototype.init=function(e,t){this.imprimirWindow=this.ui(u.default),$$("facturasGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=this,i=this.data.pull[e.row];i=this.data.pull[e.row];l.a.getEmpresa(i.empresaId).then((function(e){if(e.infFacCliRep){var t="/stireport/reports/"+e.infFacCliRep+".mrt";n.$scope.imprimirWindow.showWindow(i.facturaId,t)}else a.a.errorMessage("Esta empresa no tiene plantilla de factura asociada")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))}))},t.prototype.urlChange=function(e,t){var o=i.a.checkLoggedUser(),n=!1,r=o.comercialId;o.esCliente&&(n=!0,r=o.clienteId),c.languageService.setLanguage(this.app,"es"),this.load(n,r)},t.prototype.load=function(e,t){var o=this;r.a.getFacturasClienteAgenteDepartamento(e,t,7).then((function(e){e||(e=[]),e=o.formateaCampos(e),$$("facturasGrid").clearAll(),$$("facturasGrid").parse(s.a.prepareDataForDataTable("facturaId",e));var t=$$("facturasGrid").count();$$("facturasNReg").config.label="NREG: "+t,$$("facturasNReg").refresh();var n=webix.storage.local.get("stateGridFacturas");n&&o.$$("facturasGrid").setState(n)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.formateaCampos=function(e){return e.forEach((function(e){e.emisorNombre=e.emisorNombre.substr(0,3),e.fecha=new Date(e.fecha)})),e},t.prototype.cleanAndload=function(){$$("facturasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t.prototype.print=function(){},t}(n.c);t.default=d},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(0);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"imprimirWindow",position:"center",move:!0,resize:!0,fullscreen:!0,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("imprimirWindow").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){i.a.getConfigMysql().then((function(e){myconfig=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){},t.prototype.cancel=function(){$$("imprimirWindow").hide()},t}(n.c);t.default=s},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(5);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"iframe",id:"frame-body",src:"/ComerWeb/index.html"}},t.prototype.init=function(){i.a.checkLoggedUser(),r.languageService.setLanguage(this.app,"es")},t}(n.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(1),a=o(4),s=o(18),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-format-list-numbers",width:37,align:"left"},{view:"label",label:"Lineas de tarifa"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("tarifaLineasGrid"),{filename:"avisos",name:"Tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "}]},{view:"datatable",id:"tarifaLineasGrid",autoWidth:!0,heigth:800,select:"row",scheme:{$change:function(e){$$("tarifaLineasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"tarifaClienteLineaId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"codigoReparacion",header:["Codigo",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"unidadConstructiva",header:["Descripcion",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"precioUnitario",header:["Importe",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:!0}],onClick:{},editable:!0,editaction:"dblclick",rules:{},on:{}},{view:"form",id:"frmBotones",elements:[{cols:[{minwidth:600},{rows:[{padding:20,cols:[{view:"button",label:"Volver",click:this.accept,type:"form"}]}]}]}]}]}},t.prototype.init=function(e,t){},t.prototype.urlChange=function(e,t){i.a.checkLoggedUser(),c.languageService.setLanguage(this.app,"es");var o=null,n=null;t[0].params.tarifaClienteId&&(o=t[0].params.tarifaClienteId),t[0].params.tipoProfesionalId&&(n=t[0].params.tipoProfesionalId),n&&o&&this.load(o,n)},t.prototype.load=function(e,t){var o=this;s.a.getLineasTarifaProfesion(e,t).then((function(e){$$("tarifaLineasGrid").clearAll(),$$("tarifaLineasGrid").parse(a.a.prepareDataForDataTable("tarifaClienteLineaId",e));var t=$$("tarifaLineasGrid").count();$$("TarifasNReg").config.label="NREG: "+t,$$("TarifasNReg").refresh();var n=webix.storage.local.get("stateGridTarifas");n&&o.$$("tarifaLineasGrid").setState(n)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.accept=function(){this.$scope.show("/top/tarifas")},t.prototype.cleanAndload=function(){$$("tarifaLineasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(n.c);t.default=p},function(e,t,o){"use strict";o.r(t);var n,i,r=o(3),a=o(6),s=o(8),c=o(1),l=o(0);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){return u(this,t),p(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return this.app,{view:"layout",css:"loginBackRestablecer",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmRestablecer",rules:{$obj:function(e){return e.login1!=e.login2?(webix.message("Los nombres de usuario no coinciden"),!1):e.password1==e.password2||(webix.message("Las contraseñas no coinciden"),!1)}},elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png'/>"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login1",id:"login1",required:!0,label:"Nuevo nombre de usuario",labelPosition:"top"},{view:"text",name:"login2",id:"login2",required:!0,label:"Repita nuevo nombre de usuario",labelPosition:"top"},{view:"text",type:"password",name:"password1",id:"password1",required:!0,label:"Nueva Contraseña",labelPosition:"top"},{view:"text",type:"password",name:"password2",id:"password2",required:!0,label:"Repita nueva Contraseña",labelPosition:"top"},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){n=this.gup("clienteId"),i=this.gup("comercialId"),l.a.getVersion().then((function(e){$$("version").data.label="VRS "+e.version,$$("version").refresh()})).catch((function(e){c.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){if($$("frmRestablecer").validate()){var e=$$("frmRestablecer").getValues(),t={loginWeb:e.login1,passWeb:e.password1};""!=n&&a.a.putClienteLogin(n,t).then((function(e){e&&1==e.affectedRows&&webix.alert({title:"INFORMATION",text:"Los cambios se han efectuado con exito. Puede ahora ingresar en la aplicación con el nuevo usuario y contraseña"}).then((function(e){})).fail((function(e){c.a.errorMessage(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)})),""!=i&&s.a.putComercialLogin(i,t).then((function(e){e&&1==e.affectedRows&&webix.alert({title:"INFORMATION",text:"Los cambios se han efectuado con exito. Puede ahora ingresar en la aplicación con el nuevo usuario y contraseña"}).then((function(e){})).fail((function(e){c.a.errorMessage(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.gup=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return t?t[1]:t?void 0:""},t}(r.c);t.default=f},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(1),a=o(4),s=o(7),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p,f,d=!1,h=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-transcribe",width:37,align:"left"},{view:"label",label:"Avisos"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("serviciosGrid"),{filename:"avisos",name:"Servicios",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ServiciosNReg",label:"NREG: "}]},{view:"datatable",id:"serviciosGrid",autoWidth:!0,select:"row",scheme:{$change:function(e){$$("serviciosGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"servicioId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"parteId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"fechaEntrada",header:[{text:"Fecha solicitud",css:{"text-align":"center"}},{content:"textFilter"}],sort:"date",adjust:"data",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"nombreCliente",header:["Nombre Cliente",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"tipoProfesionNombre",header:["Profesion",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estadoParteNombre",header:["Estado",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-eye'></span>",css:{"text-align":"center"},width:100}],onClick:{onDelete:function(e,t,o){var n=this.data.pull[t.row].nombre;this.$scope.delete(t.row,n)},onEdit:function(e,t,o){var n=$$("serviciosGrid").getItem(t.row);this.$scope.edit(t.row,n.parteId)}},editable:!0,editaction:"dblclick",rules:{direccionTrabajo:webix.rules.isNotEmpty},on:{onAfterEditStart:function(e){p=e.row,f=this.data.pull[p]},onAfterEditStop:function(e,t,o){var n=this,i=this.getColumnIndex(t.column),a=this.config.columns.length;if(d&&i!=a-2)return!1;if(e.value!=e.old)if(d=!1,this.validate(p)){delete(f=this.data.pull[p]).id;var c=f;delete c.fechaEntrada,0==c.servicioId?s.a.postServicio(c).then((function(e){n.$scope.load(e.servicioId),$$("serviciosGrid").editStop()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)})):s.a.putServicio(c).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}else r.a.errorMessage("Valores incorrectos")},onAfterFilter:function(){webix.storage.local.put("stateGridServicios",this.getState())}}}]}},t.prototype.init=function(e,t){this.$$("serviciosGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=$$("serviciosGrid").getItem(e.row);this.$scope.edit(e.row,n.parteId)}))},t.prototype.urlChange=function(e,t){var o=i.a.checkLoggedUser(),n=!1,r=o.comercialId;o.esCliente&&(n=!0,r=o.clienteId),i.a.checkLoggedUser(),c.languageService.setLanguage(this.app,"es");var a=null;t[0].params.servicioId&&(a=t[0].params.servicioId),webix.UIManager.addHotKey("Esc",(function(){return $$("serviciosGrid").remove(-1),!1}),$$("serviciosGrid")),webix.extend($$("serviciosGrid"),webix.ProgressBar),this.load(a,r,n)},t.prototype.load=function(e,t,o){var n=this;s.a.getServiciosPartes(t,o).then((function(t){t=s.a.prepareData(t),$$("serviciosGrid").clearAll(),$$("serviciosGrid").parse(a.a.prepareDataForDataTable("servicioId",t)),e&&($$("serviciosGrid").select(e),$$("serviciosGrid").showItem(e));var o=$$("serviciosGrid").count();$$("ServiciosNReg").config.label="NREG: "+o,$$("ServiciosNReg").refresh();var i=webix.storage.local.get("stateGridServicios");i&&n.$$("serviciosGrid").setState(i)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.edit=function(e,t){this.show("/top/serviciosForm?servicioId="+e+"&parteId="+t)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,n=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&s.a.deleteServicio(e).then((function(e){n.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}})},t.prototype.cleanAndload=function(){$$("serviciosGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(n.c);t.default=h},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(7),a=o(1),s=o(5);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u,p=0,f=0,d=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"layout",id:"serviciosForm",autoheight:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-transcribe",width:37,align:"left"},{view:"label",label:"Avisos"}]},{view:"form",scroll:"y",id:"frmServicios",elements:[{cols:[{cols:[{rows:[{view:"text",id:"nombreCliente",name:"nombreCliente",disabled:!0,label:"Cliente",labelPosition:"top",minWidth:50},{view:"datepicker",id:"fechaCierre",name:"fechaCierre",minWidth:50,disabled:!0,label:"Fecha de cierre",labelPosition:"top"},{view:"text",id:"tipoProfesionNombre",name:"tipoProfesionNombre",disabled:!0,label:"Profesión ",labelPosition:"top",minWidth:50},{view:"text",id:"estadoParteNombre",name:"estadoParteNombre",disabled:!0,label:"Estado",labelPosition:"top",minWidth:50},{view:"textarea",id:"descripcionAveria",name:"descripcionAveria",disabled:!0,label:"Descripción de la avería",labelPosition:"top",minHeight:100},{view:"textarea",id:"notasWeb",name:"notasWeb",disabled:!0,label:"Notas",labelPosition:"top",minHeight:100}]}]},{cols:[{id:"image",scroll:"y",data:{src:""},template:function(e){return"<img src="+e.src+' style="width:100%;" alt=" Enlace incorrecto, no se puede cargar" onerror="this.style.display="none">'}}]}]},{cols:[{minwidth:600},{rows:[{padding:20,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form"}]}]}]}]}]}},t.prototype.init=function(e,t){u=i.a.checkLoggedUser(),u.usuarioId,s.languageService.setLanguage(this.app,"es")},t.prototype.urlChange=function(e,t){u=i.a.checkLoggedUser(),u.usuarioId,s.languageService.setLanguage(this.app,"es"),t[0].params.servicioId&&(p=t[0].params.servicioId),t[0].params.parteId&&(f=t[0].params.parteId),p&&f&&this.load(p,f)},t.prototype.load=function(e,t){r.a.getServicioParte(e,t).then((function(e){e.fechaEntrada=new Date(e.fechaEntrada),e.fechaCierre&&(e.fechaCierre=new Date(e.fechaCierre)),$$("frmServicios").setValues(e),e.imagen&&""!=e.imagen?($$("image").show(),$$("image").setValues({src:e.imagen})):$$("image").hide()})).catch((function(e){a.a.errorMessageAjax(e)}))},t.prototype.accept=function(){this.$scope.show("/top/servicios?servicioId="+p)},t}(n.c);t.default=d},function(e,t,o){"use strict";o.r(t),t.default={template:"Start page",css:"webix_shadow_medium app_start"}},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(1),a=o(4),s=o(18),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-format-list-numbers",width:37,align:"left"},{view:"label",label:"Tarifas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("tarifasGrid"),{filename:"avisos",name:"Tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "}]},{view:"datatable",id:"tarifasGrid",autoWidth:!0,select:"row",scheme:{$change:function(e){$$("tarifasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"tarifaClienteId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"tipoProfesionalId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"tipoProfesionalNombre",header:["Profesion",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"nombre",header:["Nombre Tarifa",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-eye'></span>",css:{"text-align":"center"},width:100}],onClick:{onEdit:function(e,t,o){var n=$$("tarifasGrid").getItem(t.row);this.$scope.edit(t.row,n.tarifaClienteId)}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterFilter:function(){webix.storage.local.put("stateGridTarifas",this.getState())}}}]}},t.prototype.init=function(e,t){this.$$("tarifasGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=$$("tarifasGrid").getItem(e.row);this.$scope.edit(e.row,n.tarifaClienteId)}))},t.prototype.urlChange=function(e,t){var o=i.a.checkLoggedUser(),n=!1,r=o.comercialId;o.esCliente&&(n=!0,r=o.clienteId),i.a.checkLoggedUser(),c.languageService.setLanguage(this.app,"es");var a=null;t[0].params.tarifaClienteId&&(a=t[0].params.tarifaClienteId),webix.UIManager.addHotKey("Esc",(function(){return $$("tarifasGrid").remove(-1),!1}),$$("tarifasGrid")),webix.extend($$("tarifasGrid"),webix.ProgressBar),this.load(a,r,n)},t.prototype.load=function(e,t,o){var n=this;s.a.getTarifaProfesiones(t,o).then((function(t){$$("tarifasGrid").clearAll(),$$("tarifasGrid").parse(a.a.prepareDataForDataTable("tipoProfesionalId",t)),e&&($$("tarifasGrid").select(e),$$("tarifasGrid").showItem(e));var o=$$("tarifasGrid").count();$$("TarifasNReg").config.label="NREG: "+o,$$("TarifasNReg").refresh();var i=webix.storage.local.get("stateGridTarifas");i&&n.$$("tarifasGrid").setState(i)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.edit=function(e,t){this.show("/top/lineasTarifaProfesion?tarifaClienteId="+t+"&tipoProfesionalId="+e)},t.prototype.cleanAndload=function(){$$("tarifasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(n.c);t.default=p},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(15),r=o(16),a=o(17);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{type:"view",rows:[r.default,{cols:[i.default,{view:"resizer",id:"resizer"},{$subview:!0}]},a.default]}},t.prototype.init=function(){},t}(n.c);t.default=l},function(e,t){},function(e,t,o){"use strict";o.r(t),t.default={Inicio:"Inicio","Nombre usuario":"Nombre usuario","Administración":"Administración",Salir:"Salir","Facturación":"Facturación",Facturas:"Facturas","Refrescar la lista (Ctrl+R)":"Refrescar la lista (Ctrl+R)","Descargar como Excel":"Descargar como Excel",Fecha:"Fecha","IMPRESIÓN DE ENTREGAS":"IMPRESIÓN DE ENTREGAS","IMPRESIÓN DE FACTURAS":"IMPRESIÓN DE FACTURAS",Servicios:"Servicios",Reparaciones:"Reparaciones",Tarifas:"Tarifas",Partes:"Partes","Lineas del parte":"Lineas del parte","Nuevo registro en formulario (Ctrl+A)":"Nuevo registro en formulario (Ctrl+A)",Id:"Id",Codigo:"Codigo",Descripcion:"Descripcion",Comentarios:"Comentarios","Uds.":"Uds.","%IVA Cli.":"%IVA Cli.","€/Ud. Cli.":"€/Ud. Cli.","Imp cli.":"Imp cli.","Imp. cli.IVA":"Imp. cli.IVA","%IVA Pro.":"%IVA Pro.","€/Ud. Pro.":"€/Ud. Pro.","Imp pro.":"Imp pro.","Imp. pro.IVA":"Imp. pro.IVA",Resultado:"Resultado","Ocultar/Mostrar aviso asociado":"Ocultar/Mostrar aviso asociado","Fecha sol.":"Fecha sol.","Fech.prev.":"Fech.prev.","Fech.Rep.":"Fech.Rep.","Fech.cobro":"Fech.cobro","Fech.pago":"Fech.pago"}},function(e,t,o){"use strict";o.r(t),t.default={"Ancient Dashboard":"Ancient Dashboard"}},function(e,t,o){"use strict";o.r(t);var n,i,r,a,s,c,l,u,p,f,d,h=o(3),m=o(2),b=o(0),g=function(e,t){return new webix.promise((function(o,n){b.a.getConfig().then((function(o){var n=o.urlApi+"/api/partes/estado/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},v=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/partes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},w=function(e,t){return new webix.promise((function(o,n){b.a.getConfig().then((function(o){var n=o.urlApi+"/api/partes/nuevo/numero/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},$=function(e){return e.forEach((function(e){e.fecha_solicitud&&(e.fecha_solicitud=new Date(e.fecha_solicitud)),e.fecha_prevista&&(e.fecha_prevista=new Date(e.fecha_prevista)),e.fecha_reparacion&&(e.fecha_reparacion=new Date(e.fecha_reparacion)),e.fecha_factura_cliente&&(e.fecha_factura_cliente=new Date(e.fecha_factura_cliente)),e.fecha_cobro_cliente&&(e.fecha_cobro_cliente=new Date(e.fecha_cobro_cliente)),e.fecha_factura_profesional&&(e.fecha_factura_profesional=new Date(e.fecha_factura_profesional)),e.fecha_pago_profesional&&(e.fecha_pago_profesional=new Date(e.fecha_pago_profesional))})),e},y=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/partes/lineas/del/parte/servicio/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},x=function(e,t,o){return new webix.promise((function(n,i){b.a.getConfig().then((function(n){var i=n.urlApi+"/api/partes/linea/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i)})).then((function(e){n(e.json())})).catch((function(e){i(e)}))}))},P=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},C=o(1),j=o(4),_=o(12),E=function(e,t){return new webix.promise((function(o,n){b.a.getConfig().then((function(o){var n=o.urlApi+"/api/proveedores/tipo/proveedor/por/tipo/null/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},A=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/proveedores/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},S=function(e,t,o){return new webix.promise((function(n,i){b.a.getConfig().then((function(n){var i=n.urlApi+"/api/proveedores/tipo/proveedor/por/tipo/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){n(e.json())})).catch((function(e){i(e)}))}))},I=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_parte_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},F=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_presupuesto";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},T=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/rechazos_presupuesto";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},V=o(8),R=o(10),k=!1,O={getGrid:function(e){var t=e.getService("locale")._;return"<span class='onDelete webix_icon wxi-trash'></span>",{view:"layout",id:"lineasDelParte",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Lineas del parte")}]},{cols:[{view:"button",id:"btnNew3",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){if(r)if(""!=$$("cmbProveedores").getValue())$$("cmbProveedores").getValue(),$$("cliId").getValue();else C.a.errorMessage(t("Tiene que asignar un profesional al parte"));else C.a.errorMessage(t("Debe dar de alta el parte antes las lineas"))}},{view:"label",id:"partesLineasNReg",label:"NREG: "},{view:"pager",id:"mypager3",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"LineasParteGrid",pager:"mypager3",select:"row",autoheight:!0,footer:!0,ready:function(){$$("LineasParteGrid").attachEvent("onItemDblClick",(function(e,t,o){this.data.pull[e.row],$$("cmbProveedores").getValue(),$$("cliId").getValue()}))},columns:[{id:"parteLineaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"codigoArticulo",header:[t("Codigo"),{content:"textFilter"}],sort:"string",width:80},{id:"descripcion",header:[t("Descripcion"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"comentarios",header:[t("Comentarios"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"unidades",header:[t("Uds."),{content:"textFilter"}],sort:"string",width:40},{id:"ivaCliente",header:[t("%IVA Cli."),{content:"textFilter"}],sort:"string",width:50},{id:"precioCliente",header:[t("€/Ud. Cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"importeCliente",header:[t("Imp cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"importeClienteIva",header:[t("Imp. cli.IVA"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"ivaProveedor",header:[t("%IVA Pro."),{content:"textFilter"}],sort:"string",width:50},{id:"precioProveedor",header:[t("€/Ud. Pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"importeProveedor",header:[t("Imp pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"importeProveedorIva",header:[t("Imp. pro.IVA"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat,footer:{content:"summColumn"}}],rightSplit:1,onClick:{onDelete:function(t,o,n){o=o.row;var i=this.data.pull[o],r=i.codigoArticulo,a=i.facproveLineaId,s=i.facproveId,c=i.facturaLineaId,l=i.facturaId;O.delete(o,r,e,a,s,c,l)},onEdit:function(e,t,o){this.data.pull[t.row],$$("cmbProveedores").getValue(),$$("cliId").getValue()}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){n=e.row,i=this.data.pull[n]},onAfterEditStop:function(e,t,o){var r=this.getColumnIndex(t.column),a=this.config.columns.length;if(k&&r!=a-2)return!1;(e.value!=e.old||k)&&(k=!1,this.validate(n)?(delete(i=this.data.pull[n]).id,i.parteLineaId):C.a.errorMessage("Valores incorrectos"))},onAfterFilter:function(){var e=$$("LineasParteGrid").count();$$("partesLineasNReg").config.label="NREG: "+e,$$("partesLineasNReg").refresh()}}}]}},loadGrid:function(e,t){a=t,s=0,(r=e)?y(r).then((function(e){if(e.length>0){s=e.length,X.estableceNumLineas(s),$$("LineasParteGrid").clearAll(),$$("LineasParteGrid").parse(j.a.prepareDataForDataTable("parteLineaId",e));var t=$$("LineasParteGrid").count();$$("partesLineasNReg").config.label="NREG: "+t,$$("partesLineasNReg").refresh()}else $$("LineasParteGrid").clearAll(),X.estableceNumLineas(s)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)})):$$("LineasParteGrid").clearAll()},delete:function(e,t,o,n,i,s,c){var l={},u={},p=o.getService("locale")._;(n||s)&&(t+=". Este parte tiene facturas asocidas. La linea que borre tembién será eliminada de la facturas en la que se encuentre."),webix.confirm({title:p("AVISO"),text:p("Está seguro que desea eliminar la linea con codigo articulo *").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&x(e,r,a).then((function(e){n&&(l={facproveId:i,facproveLineaId:n},R.a.deleteLineaFacprove(n,l).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))),s&&(u={facturaId:c,facturaLineaId:s},R.a.deleteLineaFactura(s,u).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))),console.log($$("cmbEstadosParteProfesional").getValue()),O.loadGrid(r,a),$$("importeCli").setValue(e.importe_cliente),$$("importeCliIva").setValue(e.importe_cliente_iva),$$("importePro").setValue(e.importe_profesional),$$("importeProIva").setValue(e.importe_profesional_iva),$$("aCuentaProfesional").setValue(e.aCuentaProfesional)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},estableceContado:function(e){setTimeout((function(){var t=0;if(e){for(var o=0;o<e.length;o++)t+=e[o].aCuentaProveedor;$$("aCuentaProfesional").setValue(t)}else $$("aCuentaProfesional").setValue(t)}),300)}},N=o(6),D=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/formas_pago";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},L=o(9),M=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},G=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/no-aceptadas/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},U=function(e,t){return new webix.promise((function(o,n){b.a.getConfig().then((function(o){var n=o.urlApi+"/api/ofertas/lineas/"+e+"/"+!0+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},z=!1,W=0,q=0,J=null,B=null,H=0,K=0,Y=0,Z=[{id:"6 meses",value:"6 meses"},{id:"sin garantía",value:"sin garantía"}],Q=0,X={getWindow:function(e){var t=O.getGrid(e);if(!z){c=e.getService("locale")._;webix.ui({view:"suggest",data:Z});var o={view:"tabview",cells:[{header:"Parte",body:{view:"layout",id:"partesForm",rows:[{view:"form",scroll:"y",autoheight:!0,id:"frmPartes",elements:[{view:"fieldset",label:"AVISO ASOCIADO",id:"avisoAsociado",body:{rows:[{cols:[{view:"text",id:"numServicio2",name:"numServicio",disabled:!0,label:"Numero",labelPosition:"top",width:80},{minWidth:650},{view:"text",id:"usuServicioNombre",name:"usuServicioNombre",label:"Operador",labelPosition:"top",width:180,disabled:!0}]},{cols:[{view:"text",id:"comercialNombre",name:"comercialNombre",label:"Agente",labelPosition:"top",disabled:!0},{view:"text",id:"cliId",name:"clienteId",label:"ClienteId",labelPosition:"top",width:100,disabled:!0,hidden:!0},{view:"text",id:"operadorAgente2",name:"operadorAgente",label:"Solicitado Por",labelPosition:"top",width:100,disabled:!0},{view:"datepicker",id:"fechaEntrada2",name:"fechaEntrada",label:"Fec. solicitud",labelPosition:"top",disabled:!0,width:180},{view:"text",id:"hora2",name:"horaEntrada",label:"Hora",labelPosition:"top",disabled:!0,width:80,format:webix.i18n.timeFormatSt,pattern:"##:##"},{view:"text",id:"proId2",name:"proId",label:"Cliente",labelPosition:"top",width:100,disabled:!0},{view:"text",id:"cliNombre",name:"cliNombre",label:"Nombre cliente",labelPosition:"top",width:340,disabled:!0}]},{cols:[{view:"text",id:"direccionTrabajoBis",name:"direccionTrabajo",width:320,label:"Direccion de trabajo",labelPosition:"top",disabled:!0},{view:"text",id:"tipoProNom",name:"tipoProNom",width:200,label:"Profesión",labelPosition:"top",disabled:!0},{view:"text",id:"nomEmpre",name:"nomEmpre",label:"Empresa",labelPosition:"top",disabled:!0},{view:"label",label:"Urgente",width:150},{view:"checkbox",id:"urgente2",name:"urgente",width:50,disabled:!0},{view:"label",label:"Presupuesto",width:100},{view:"checkbox",id:"presupuesto2",name:"necesitaPresupuesto",width:50,disabled:!0}]}]}},{view:"fieldset",label:"DATOS",id:"fieldSetDatos",body:{rows:[{cols:[{view:"text",id:"facturaId",name:"facturaId",label:"facturaId",labelPosition:"top",width:50,hidden:!0},{view:"text",id:"facproveId",name:"facproveId",label:"facproId",labelPosition:"top",width:50,hidden:!0},{view:"text",id:"parteId",name:"parteId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{minWidth:600},{view:"combo",id:"cmbEmpresas2",name:"empresaParteId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:300}]},{cols:[{view:"datepicker",id:"fechaSolicitud",name:"fecha_solicitud",width:150,label:"Fecha solicitud",labelPosition:"top"},{view:"text",id:"numParte",name:"numParte",label:"Numero de parte",labelPosition:"top",width:150},{view:"combo",id:"cmbUsuarios2",name:"operadorId",required:!0,options:{},label:"Operador",labelPosition:"top"},{view:"combo",id:"cmbTipoProfesionales",name:"tipoProfesionalId",options:{},label:"Tipo profesional",labelPosition:"top"},{view:"combo",id:"cmbProveedores",name:"proveedorId",label:"Profesional",labelPosition:"top",options:{filter:function(e,t){var o=e.id;return-1!==e.value.toLowerCase().indexOf(t)||o==t}}}]},{cols:[{view:"datepicker",id:"fechaPrevista",name:"fecha_prevista",label:"Fecha prevista",labelPosition:"top",width:250,required:!0},{view:"datepicker",id:"fechaReparacion",name:"fecha_reparacion",label:"Fecha reparacion",labelPosition:"top",width:250},{view:"combo",id:"cmbEstadosParteProfesional",name:"estadoParteProfesionalId",options:{},label:"Estado del parte Profesional",labelPosition:"top"},{view:"combo",id:"cmbEstadosParte3",name:"estadoParteId",required:!0,options:{},label:"Estado del parte cliente",labelPosition:"top"}]},{cols:[{view:"combo",id:"garantiaTrabajos",name:"garantia_trabajos",stringResult:!0,label:"Garantia de los trabajos",labelPosition:"top",options:Z,on:{onTimedKeyPress:function(){f=this.getText()},onBlur:function(){if(f){var e={id:f,value:f};Z.push(e);var t=$$("garantiaTrabajos").getPopup().getList();t.clearAll(),t.parse(Z),$$("garantiaTrabajos").setValue(f),$$("garantiaTrabajos").refresh(),f=null}}}},{view:"datepicker",id:"fechaCierreProfesional",name:"fecha_cierre_profesional",label:"Fecha cierre Profesional",labelPosition:"top",width:360},{view:"datepicker",id:"fechaCierreCliente",name:"fecha_cierre_cliente",label:"Fecha cierre cliente",labelPosition:"top",width:360}]}]}},{view:"fieldset",label:"PRESUPUESTO",id:"fieldSetPresupuesto",body:{cols:[{width:50},{view:"label",label:"Presupuesto",width:100},{view:"checkbox",id:"presupuesto",name:"presupuesto",width:50},{view:"text",id:"refPresupuesto",name:"refPresupuesto",label:"Referencia",labelPosition:"top",width:110,css:"myclass",hidden:!0},{view:"combo",id:"cmbRefPresupuestoOferta",name:"ofertaId",options:{},label:"Referencia",labelPosition:"top"},{view:"combo",id:"cmbEstadosPresupuesto",name:"estadoPresupuesto",options:{},label:"Estado del presupuesto",labelPosition:"top"},{view:"combo",id:"cmbRechazosPresupuesto",name:"rechazoPresupuestoId",options:{},label:"Causa rechazo presupuesto",labelPosition:"top",value:0},{view:"text",id:"descuentoGeneral",name:"descuentoGeneral",label:"Dto.general %",labelPosition:"top",value:0,format:"1,00",width:100,click:function(e,t){$$(e).setValue("")}},{view:"text",id:"rappel",name:"rappel",label:"Rappel %",labelPosition:"top",value:0,format:"1,00",width:100,click:function(e,t){$$(e).setValue("")}}]}},{rows:[{cols:[{view:"textarea",id:"descripcionAveria2",name:"descripcion_averia",required:!0,label:"Descripción de la avería",labelPosition:"top",height:70},{view:"textarea",id:"trabajosRealizados",name:"trabajos_realizados",label:"Notas Web",labelPosition:"top",height:70},{rows:[{padding:20,cols:[{view:"button",label:"Aceptar",click:X.cancel,hotkey:"esc"}]}]}]},{view:"textarea",id:"observacion",name:"observaciones",label:"Observaciones",labelPosition:"top",height:170}]},{cols:[{view:"fieldset",label:"CLIENTE",id:"fieldSetCliente",body:{rows:[{cols:[{view:"datepicker",id:"fechaFactCli",name:"fecha_factura_cliente",label:"Fech. fact.",labelPosition:"top",disabled:!0},{view:"text",id:"numeroFactCli",name:"numero_factura_cliente",label:"Nº fact.",labelPosition:"top",disabled:!0},{view:"datepicker",id:"fechaCoCli",name:"fecha_cobro_cliente",label:"Cobro",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"importeCli",name:"importe_cliente",disabled:!0,label:"Importe",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"importeCliIva",name:"importe_cliente_iva",disabled:!0,label:"Importe con iva",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"combo",id:"cmbFormasPagoCli",name:"formaPagoClienteId",options:{},label:"Forma pago",labelPosition:"top"},{view:"label",label:"Facturar Por separado",width:150},{view:"checkbox",id:"FactPropiaCli",name:"FactPropiaCli",width:50}]}]}},{view:"fieldset",label:"PROFESIONAL",id:"fieldSetProfesional",body:{rows:[{cols:[{view:"datepicker",id:"fechaFactPro",name:"fecha_factura_profesional",label:"Fech. fact.",labelPosition:"top",disabled:!0},{view:"text",id:"numeroFactPro",name:"numero_factura_profesional",label:"Nº fact.",labelPosition:"top",disabled:!0},{view:"datepicker",id:"fechaCoPro",name:"fecha_pago_profesional",label:"Pago",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"importePro",name:"importe_profesional",disabled:!0,label:"Importe",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"importeProIva",name:"importe_profesional_iva",disabled:!0,label:"Importe con iva",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"aCuentaProfesional",name:"aCuentaProfesional",disabled:!0,label:"Contado",labelPosition:"top",value:0,format:"1,00"},{view:"combo",id:"cmbFormasPagoPro",name:"formaPagoProfesionalId",options:{},label:"Forma pago",labelPosition:"top"},{view:"label",label:"Facturar Por separado",width:150},{view:"checkbox",id:"FactPropiaPro",name:"FactPropiaPro",width:50}]}]}}]},{rows:[{cols:[{view:"text",id:"resultado",name:"resultado",label:c("Resultado"),labelPosition:"top",value:0,format:"1,00",width:100,disabled:!0,hidden:!0},{},{}]}]}]}]}},{header:"Lineas",body:{rows:[t]}}]};webix.ui({view:"window",fullscreen:!0,id:"partesFormWin",position:"center",move:!0,resize:!0,head:{view:"toolbar",cols:[{view:"icon",icon:"mdi mdi mdi-file",width:37,align:"left"},{view:"label",label:"Partes"},{view:"toggle",type:"icon",id:"ocultar",maxWidth:50,icon:"mdi mdi-arrow-down-bold-circle-outline",tooltip:c("Ocultar/Mostrar aviso asociado")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("partesFormWin").hide()}}]},modal:!0,body:o}),z=!0,$$("frmPartes").elements.rappel.attachEvent("onKeyPress",(function(e,t){d="",d+=$$("rappel").getText()})),$$("frmPartes").elements.rappel.attachEvent("onBlur",(function(e,t){d=d.replace(".",","),$$("rappel").setValue(d)})),$$("frmPartes").elements.descuentoGeneral.attachEvent("onKeyPress",(function(e,t){d="",d+=$$("descuentoGeneral").getText()})),$$("frmPartes").elements.descuentoGeneral.attachEvent("onBlur",(function(e,t){d=d.replace(".",","),$$("descuentoGeneral").setValue(d)})),$$("importeCli").attachEvent("onChange",(function(e,t){var o=e-$$("importePro").getValue();$$("resultado").setValue(o)})),$$("importePro").attachEvent("onChange",(function(e,t){var o=$$("importeCli").getValue()-e;$$("resultado").setValue(o)})),$$("cmbProveedores").attachEvent("onChange",(function(e,t){var o=$$("cmbEstadosParte3").getValue();B=e,1==o&&$$("cmbEstadosParte3").setValue(2),""!=B&&null!=B&&X.recuperaFormaPagoPro(B)})),$$("cmbFormasPagoCli").attachEvent("onChange",(function(e,t){t&&!0})),$$("cmbFormasPagoPro").attachEvent("onChange",(function(e,t){t&&!0})),$$("cmbTipoProfesionales").attachEvent("onChange",(function(e,t){""!=e&&(J=e,X.loadProveedores(B,J))})),$$("ocultar").attachEvent("onItemClick",(function(e,t){++K%2>0?$$("avisoAsociado").hide():$$("avisoAsociado").show()})),$$("cmbEstadosParteProfesional").attachEvent("onChange",(function(e,t){if(""!=e){var o=e,n=t;if(2==o&&0==Q)return C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),void $$("cmbEstadosParteProfesional").setValue(n);2==o?$$("fechaCierreProfesional").setValue($$("fechaPrevista").getValue()):$$("fechaCierreProfesional").setValue(null)}})),$$("cmbEstadosParte3").attachEvent("onChange",(function(e,t){if(""!=e){var o=e,n=t;if(5==o&&0==Q)return C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),void $$("cmbEstadosParte3").setValue(n);5==o?$$("fechaCierreCliente").setValue($$("fechaPrevista").getValue()):$$("fechaCierreCliente").setValue(null)}})),$$("cmbEstadosPresupuesto").attachEvent("onChange",(function(e,t){var o=$$("cmbRefPresupuestoOferta").getValue();isNaN(parseInt(o))||(""!=e&&3==e&&0==Q&&X.aceptarOferta(),""!=e&&3==e&&Q>0&&X.avisoNumLineas())})),$$("presupuesto").attachEvent("onChange",(function(e,t){if(""!==e){var o=e,n=$$("cmbRefPresupuestoOferta").getValue(),i=$$("cmbEstadosPresupuesto").getValue();console.log(o,isNaN(parseInt(n)),isNaN(parseInt(i))),0==o&&(isNaN(parseInt(n))||isNaN(parseInt(i))||X.desvinculaOferta(n))}}))}},loadWindow:function(e,t,o,n,i,r,a,s){if($$("avisoAsociado").disable(),$$("fieldSetDatos").disable(),$$("fieldSetPresupuesto").disable(),$$("fieldSetCliente").disable(),$$("fieldSetProfesional").disable(),null,$$("frmPartes")&&$$("frmPartes").clear(),Y=n,H=o,W=t,q=e,i,u=a,p=s,$$("partesFormWin")&&$$("partesFormWin").show(),l=m.a.checkLoggedUser(),W)$$("cmbProveedores").blockEvent(),$$("presupuesto").blockEvent(),$$("cmbEstadosParteProfesional").blockEvent(),$$("cmbEstadosParte3").blockEvent(),$$("cmbEstadosPresupuesto").blockEvent(),$$("frmPartes").clear(),O.loadGrid(W,q),v(W).then((function(e){B=e.proveedorId,u=e.empresaId,e.fecha_solicitud=new Date(e.fecha_solicitud),e.fechaEntrada&&(e.fechaEntrada=new Date(e.fechaEntrada)),e.fecha_prevista&&(e.fecha_prevista=new Date(e.fecha_prevista)),e.fecha_reparacion&&(e.fecha_reparacion=new Date(e.fecha_reparacion)),e.fecha_factura_cliente&&(e.fecha_factura_cliente=new Date(e.fecha_factura_cliente)),e.fecha_cobro_cliente&&(e.fecha_cobro_cliente=new Date(e.fecha_cobro_cliente)),e.fecha_factura_profesional&&(e.fecha_factura_profesional=new Date(e.fecha_factura_profesional)),e.fecha_pago_profesional&&(e.fecha_pago_profesional=new Date(e.fecha_pago_profesional)),e.fecha_cierre_cliente&&(e.fecha_cierre_cliente=new Date(e.fecha_cierre_cliente)),e.fecha_cierre_profesional&&(e.fecha_cierre_profesional=new Date(e.fecha_cierre_profesional)),X.loadNuevaGarantiaTrabajos(e.garantia_trabajos),$$("frmPartes").setValues(e),X.loadUsuarios(e.operadorId),X.loadTiposProfesionales(e.tipoProfesionalId),X.loadEstadosParte(e.estadoParteId),X.loadEstadosParteProfesional(e.estadoParteProfesionalId),X.loadEstadosPresupuesto(e.estadoPresupuesto),X.loadRechazosPresupuesto(e.rechazoPresupuestoId),X.loadFormasPagoCli(e.formaPagoClienteId),X.loadFormasPagoPro(e.formaPagoProfesionalId),X.loadEmpresas(e.empresaParteId),X.loadPresupuestos(e.ofertaId),H?$$("cliId").setValue(Y):$$("cliId").setValue($$("cmbClientes").getValue()),$$("cmbProveedores").unblockEvent(),$$("presupuesto").unblockEvent(),$$("cmbEstadosParteProfesional").unblockEvent(),$$("cmbEstadosParte3").unblockEvent(),$$("cmbEstadosPresupuesto").unblockEvent(),X.recuperaFechaCobroCli(),X.recuperaFechaPagoPro()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}));else{if(!H)return X.activaCampos(),B="",X.cargaInfoServicio(),$$("fechaSolicitud").setValue(new Date),X.loadTiposProfesionales($$("cmbTiposProfesional").data.value),X.loadProveedores(null,$$("cmbTiposProfesional").data.value),X.loadEstadosParte(1),X.loadEstadosParteProfesional(),X.loadEstadosPresupuesto(),X.loadRechazosPresupuesto(),X.loadNuevoNum(q,$$("numServicio").getValue()),X.recuperaFormaPagoCli(),X.loadFormasPagoPro(),X.loadEmpresas(u),$$("garantiaTrabajos").setValue("6 meses"),$$("descuentoGeneral").setValue(0),$$("importeCli").setValue(0),$$("importePro").setValue(0),$$("resultado").setValue(0),$$("importeCliIva").setValue(0),$$("importeProIva").setValue(0),$$("aCuentaProfesional").setValue(0),$$("descripcionAveria2").setValue($$("descripcionAveria").getValue()),$$("necesitaPresupuesto").getValue()?($$("rappel").setValue(0),$$("presupuesto").setValue(1)):X.loadRappelAgente(),X.loadUsuarios(l.usuarioId),void O.loadGrid(null,q);X.activaCampos(),B="",$$("fechaSolicitud").setValue(new Date),X.loadTiposProfesionales(),X.loadProveedores(),X.loadEstadosParte(1),X.loadEstadosParteProfesional(),X.loadEstadosPresupuesto(),X.loadRechazosPresupuesto(),X.loadNuevoNum(q,r.numServicio),X.recuperaFormaPagoCli(),X.loadFormasPagoPro(),X.loadEmpresas(u),$$("garantiaTrabajos").setValue("6 meses"),$$("descuentoGeneral").setValue(0),$$("importeCli").setValue(0),$$("importePro").setValue(0),$$("resultado").setValue(0),$$("importeCliIva").setValue(0),$$("importeProIva").setValue(0),$$("aCuentaProfesional").setValue(0),r.necesitaPresupuesto?($$("rappel").setValue(0),$$("presupuesto").setValue(1)):X.loadRappelAgente(),X.loadUsuarios(l.usuarioId),X.cargaInfoServicioDesdeGeneral(r)}},desactivaCampos:function(){$$("fieldSetDatos").disable(),$$("fieldSetPresupuesto").disable(),$$("fieldSetCliente").disable(),$$("fieldSetProfesional").disable(),$$("trabajosRealizados").disable(),$$("lineasDelParte").disable()},activaCampos:function(){$$("fieldSetDatos").enable(),$$("fieldSetPresupuesto").enable(),$$("fieldSetCliente").enable(),$$("fieldSetProfesional").enable(),$$("trabajosRealizados").enable(),$$("lineasDelParte").enable()},cargaInfoServicio:function(){$$("usuServicioNombre").setValue($$("cmbUsuarios").getText()),$$("comercialNombre").setValue($$("cmbAgentes").getText()),$$("proId2").setValue($$("cmbProId").getText()),$$("cliNombre").setValue($$("cmbClientes").getText()),$$("tipoProNom").setValue($$("cmbTiposProfesional").getText()),$$("operadorAgente2").setValue($$("operadorAgente").getValue()),$$("fechaEntrada2").setValue($$("fechaEntrada").getValue()),$$("hora2").setValue($$("horaEntrada").getValue()),$$("nomEmpre").setValue($$("cmbEmpresas").getText()),$$("direccionTrabajoBis").setValue($$("direccionTrabajo").getValue()),$$("presupuesto2").setValue($$("necesitaPresupuesto").getValue()),$$("urgente2").setValue($$("urgente").getValue()),$$("numServicio2").setValue($$("numServicio").getValue()),u=$$("cmbEmpresas").getValue()},cargaInfoServicioDesdeGeneral:function(e){$$("usuServicioNombre").setValue(e.usuServicioNombre),$$("comercialNombre").setValue(e.comercialNombre),$$("proId2").setValue(e.proId),$$("cliNombre").setValue(e.cliNombre),$$("tipoProNom").setValue(e.tipoProNom),$$("operadorAgente2").setValue(e.operadorAgente),$$("fechaEntrada2").setValue(e.fechaEntrada),$$("hora2").setValue(e.horaEntrada),$$("nomEmpre").setValue(e.nomEmpre),$$("direccionTrabajoBis").setValue(e.direccionTrabajo),$$("presupuesto2").setValue(e.necesitaPresupuesto),$$("urgente2").setValue(e.urgente),$$("numServicio2").setValue(e.numServicio),$$("descripcionAveria2").setValue(e.descripcionAveria)},cancel:function(){$$("partesFormWin").hide()},recuperaFechaCobroCli:function(){var e=$$("numeroFactCli").getValue();e&&""!=e&&R.a.recuperaFechaCobroCli(e,u).then((function(e){e&&$$("fechaCoCli").setValue(e.fecvenci)})).catch((function(e){C.a.errorMessageAjax(e)}))},recuperaFechaPagoPro:function(){var e=$$("numeroFactPro").getValue(),t=$$("fechaFactPro").getValue();t=webix.Date.dateToStr("%Y-%m-%d")(new Date(t)),e&&""!=e&&t&&""!=t&&R.a.recuperaFechaPagoPro(t,e,u).then((function(e){e&&$$("fechaCoCli").setValue(e.fecvenci)})).catch((function(e){C.a.errorMessageAjax(e)}))},recuperaFormaPagoCli:function(){var e=this;N.a.getCliente(Y).then((function(t){e.loadFormasPagoCli(t.formaPagoId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadFormasPagoCli:function(e){D().then((function(t){var o=j.a.prepareDataForCombo("formaPagoId","nombre",t),n=$$("cmbFormasPagoCli").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbFormasPagoCli").setValue(e),$$("cmbFormasPagoCli").refresh()):($$("cmbFormasPagoCli").setValue(null),$$("cmbFormasPagoCli").refresh())})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadNuevaGarantiaTrabajos:function(e){var t=!1;if(""!=e){for(var o=0;o<Z.length;o++)if(Z[o].value==e){t=!0;break}if(!t){var n={id:e,value:e};Z.push(n);var i=$$("garantiaTrabajos").getPopup().getList();i.clearAll(),i.parse(Z),$$("garantiaTrabajos").setValue(e),$$("garantiaTrabajos").refresh()}}},recuperaFormaPagoPro:function(e){var t=this;A(e).then((function(e){t.loadFormasPagoPro(e.formaPagoId),t.loadTiposProfesionales(e.tipoProfesionalId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadFormasPagoPro:function(e){D().then((function(t){var o=j.a.prepareDataForCombo("formaPagoId","nombre",t),n=$$("cmbFormasPagoPro").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbFormasPagoPro").setValue(e),$$("cmbFormasPagoPro").refresh()):($$("cmbFormasPagoPro").setValue(null),$$("cmbFormasPagoPro").refresh())})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadUsuarios:function(e){m.a.getUsuarios().then((function(t){var o=j.a.prepareDataForCombo("usuarioId","nombre",t),n=$$("cmbUsuarios2").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbUsuarios2").setValue(e),$$("cmbUsuarios2").refresh()):($$("cmbUsuarios2").setValue(null),$$("cmbUsuarios2").refresh())}))},loadTiposProfesionales:function(e){_.a.getTiposProfesional().then((function(t){var o=j.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTipoProfesionales").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbTipoProfesionales").setValue(e),$$("cmbTipoProfesionales").refresh())}))},loadProveedores:function(e,t){var o=new Date($$("fechaSolicitud").getValue());o=webix.Date.dateToStr("%y-%m-%d")(o),t?S(t,7,o).then((function(t){0==t.length&&(e=null);var o=j.a.prepareDataForCombo("proveedorId","nombre",t),n=$$("cmbProveedores").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbProveedores").setValue(e),$$("cmbProveedores").refresh()):($$("cmbProveedores").setValue(null),$$("cmbProveedores").refresh())})):E(7,o).then((function(t){var o=j.a.prepareDataForCombo("proveedorId","nombre",t),n=$$("cmbProveedores").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbProveedores").setValue(e),$$("cmbProveedores").refresh()):($$("cmbProveedores").setValue(null),$$("cmbProveedores").refresh())}))},loadEstadosParte:function(e){P().then((function(t){var o=j.a.prepareDataForCombo("estadoParteId","nombre",t),n=$$("cmbEstadosParte3").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbEstadosParte3").setValue(e),$$("cmbEstadosParte3").refresh()):($$("cmbEstadosParte3").setValue(null),$$("cmbEstadosParte3").refresh())}))},loadEstadosParteProfesional:function(e){I().then((function(t){var o=j.a.prepareDataForCombo("estadoParteProfesionalId","nombre",t),n=$$("cmbEstadosParteProfesional").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbEstadosParteProfesional").setValue(e),$$("cmbEstadosParteProfesional").refresh()):($$("cmbEstadosParteProfesional").setValue(null),$$("cmbEstadosParteProfesional").refresh())}))},loadEstadosPresupuesto:function(e){F().then((function(t){var o=j.a.prepareDataForCombo("estadoPresupuestoId","nombre",t),n=$$("cmbEstadosPresupuesto").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbEstadosPresupuesto").setValue(e),$$("cmbEstadosPresupuesto").refresh()):($$("cmbEstadosPresupuesto").setValue(null),$$("cmbEstadosPresupuesto").refresh())}))},loadRechazosPresupuesto:function(e){T().then((function(t){var o=j.a.prepareDataForCombo("rechazoPresupuestoId","nombre",t),n=$$("cmbRechazosPresupuesto").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbRechazosPresupuesto").setValue(e),$$("cmbRechazosPresupuesto").refresh()):($$("cmbRechazosPresupuesto").setValue(null),$$("cmbRechazosPresupuesto").refresh())}))},loadNuevoNum:function(e,t){w(e,t).then((function(e){$$("numParte").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadPartes:function(e){$$("cmbEstadosParte").setValue(e),g(e).then((function(e){e||(e=[]),e=$(e),$$("partesGrid").clearAll(),$$("partesGrid").parse(j.a.prepareDataForDataTable("parteId",e));var t=$$("partesGrid").count();$$("PartesNReg").config.label="NREG: "+t,$$("PartesNReg").refresh();var o=webix.storage.local.get("stateGridPartes");o&&$$("partesGrid").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadRappelAgente:function(){p||(p=$$("cmbAgentes").getValue()),V.a.getAgente(p).then((function(e){$$("rappel").setValue(e.porComer)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadEmpresas:function(e){L.a.getEmpresas().then((function(t){var o=j.a.prepareDataForCombo("empresaId","nombre",t),n=$$("cmbEmpresas2").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbEmpresas2").setValue(e),$$("cmbEmpresas2").refresh())}))},loadPresupuestos:function(e){var t=$$("cmbRefPresupuestoOferta").getValue(),o=$$("cmbEstadosPresupuesto").getValue();isNaN(parseInt(t))||3!=o?G(Y).then((function(t){var o=j.a.prepareDataForCombo("ofertaId","referencia",t),n=$$("cmbRefPresupuestoOferta").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbRefPresupuestoOferta").setValue(e),$$("cmbRefPresupuestoOferta").refresh())})).catch((function(e){C.a.errorMessageAjax(e)})):M(e).then((function(t){var o=[];o.push(t);var n=j.a.prepareDataForCombo("ofertaId","referencia",o),i=$$("cmbRefPresupuestoOferta").getPopup().getList();i.clearAll(),i.parse(n),e&&($$("cmbRefPresupuestoOferta").setValue(e),$$("cmbRefPresupuestoOferta").refresh())})).catch((function(e){C.a.errorMessageAjax(e)}))},loadData:function(e){parametroId=e.parametroId,X.loadArtMan(e.articuloMantenimiento),X.loadArtManGas(e.articuloMantenimientoParaGastos),console.log($$("margen")),$$("margen").setValue(e.margenMantenimiento),$$("margen").refresh(),$$("cuentaReten").setValue(e.cuentaretencion),$$("cuentaReten").refresh()},estableceNumLineas:function(e){Q=e},compruebaEstadoCerrado:function(e,t){2==e&&0==Q&&(C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),t.setValue(oldEstado))},buscarLineasOferta:function(){var e=$$("cmbRefPresupuestoOferta").getValue(),t=$$("cmbProveedores").getValue();""==t&&(t=null),U(e,t).then((function(e){e.length>0&&X.crearLinesParte(e)})).catch((function(e){C.a.errorMessageAjax(e)}))}},ee=o(5);function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ne,ie=1,re=[],ae=function(e){function t(){return te(this,t),oe(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this;X.getWindow(this.app);var o=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Partes"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("partesGrid"),{filename:"partes",name:"Partes",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"PartesNReg",label:"NREG: "}]},{cols:[{view:"combo",id:"cmbEstadosParte",name:"estadoParteId",options:{},label:"Estado del parte para mostrar",labelPosition:"top"},{width:800}]},((e={view:"datatable",css:{"font-size":"0.9em","font-weight":"bold"},scheme:{$change:function(e){var t=re.filter((function(t){return t.estadoParteId==e.estadoParteId}));e.$css={"background-color":t[0].colorFondo};var o=new Date;e.fecha_prevista<=o&&5!=e.estadoParteId&&e.fecha_prevista<=o&&6!=e.estadoParteId&&(e.$css={"background-color":"#B12225",color:"#B1B322"})}},id:"partesGrid",scroll:"x,y",select:"row",columns:[{id:"parteId",header:["Id",{content:"textFilter"}],sort:"int",width:50,hidden:!0},{id:"empresa",header:[{text:"Emp.",css:{"text-align":"left"}},{content:"textFilter"}],sort:"string",width:50,css:{"text-align":"left"}},{id:"empresaId",header:["empId",{content:"textFilter"}],sort:"int",width:10,hidden:!0},{id:"aqgenteId",header:["agenId",{content:"textFilter"}],sort:"int",width:10,hidden:!0},{id:"operadonNombre",header:["Operador",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"numParte",header:["Numero",{content:"textFilter"}],sort:"string",width:80},{id:"proveedorNombre",header:["Profesional",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fecha_solicitud",header:[{text:o("Fecha sol."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"fecha_prevista",header:[{text:o("Fech.prev."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"horaEntrada",header:["Hora",{content:"textFilter"}],sort:"string",width:50},{id:"proId",header:["Cliente",{content:"textFilter"}],sort:"string",width:80},{id:"clienteId",header:["ClienteId",{content:"textFilter"}],sort:"string",width:80,hidden:!0},{id:"nombreCliente",header:["Nombre Cliente",{content:"textFilter"}],sort:"string",width:210},{id:"direccionTrabajo",header:["Direc. Trabajo",{content:"textFilter"}],sort:"string",width:200},{id:"refPresupuesto",header:["Ref. presupuesto",{content:"textFilter"}],sort:"string",width:100},{id:"nombreEstado",header:["Estado",{content:"textFilter"}],sort:"string",width:120},{id:"estadoParteId",header:["id estado",{content:"textFilter"}],sort:"string",width:10,hidden:!0},{id:"fecha_reparacion",header:[{text:o("Fech.Rep."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"numero_factura_cliente",header:["Nº.fact.cli",{content:"textFilter"}],sort:"string"},{id:"importe_cliente",header:["Imp.cli.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat},{id:"fecha_cobro_cliente",header:[{text:o("Fech.cobro"),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"importe_profesional",header:["Imp. prof.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat},{id:"fecha_pago_profesional",header:[{text:o("Fech.pago"),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"numero_factura_profesional",header:["Nº.fact.pro",{content:"textFilter"}],sort:"string"},{id:"resultado",header:["Resultado",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:80},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span>",css:{"text-align":"center"},width:65}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var n=this.data.pull[t.row];X.loadWindow(n.servicioId,n.parteId,1)}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridPartes",this.getState())}},e)]}},t.prototype.init=function(e,t){var o=m.a.checkLoggedUser();ne=o.comercialId,ie=100;var n=this;this.loadEstadosParte(ie),$$("cmbEstadosParte").attachEvent("onChange",(function(e,t){ie=e,n.load()})),$$("partesGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=this.data.pull[e.row];X.loadWindow(n.servicioId,n.parteId,1,n.clienteId,null,null,n.empresaId,n.agenteId)}))},t.prototype.urlChange=function(e,t){var o=m.a.checkLoggedUser();ne=o.comercialId,ie=100,this.loadEstadosParte(ie),m.a.checkLoggedUser(),ee.languageService.setLanguage(this.app,"es"),this.load()},t.prototype.load=function(){var e=this;g(ie,ne).then((function(t){t||(t=[]),t=$(t),t=e.formateaNombreEmpresa(t),$$("partesGrid").clearAll(),$$("partesGrid").parse(j.a.prepareDataForDataTable("parteId",t));var o=$$("partesGrid").count();$$("PartesNReg").config.label="NREG: "+o,$$("PartesNReg").refresh();var n=webix.storage.local.get("stateGridPartes");n&&e.$$("partesGrid").setState(n)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},t.prototype.formateaNombreEmpresa=function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,3),e.horaEntrada=e.horaEntrada.substr(0,5)})),e},t.prototype.loadEstadosParte=function(e){P().then((function(t){re=t;var o=j.a.prepareDataForCombo("estadoParteId","nombre",t);o.push({id:100,value:"todos"});var n=$$("cmbEstadosParte").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbEstadosParte").setValue(e),$$("cmbEstadosParte").refresh())}))},t.prototype.cleanAndload=function(){$$("partesGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(h.c);t.default=ae},function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(2),r=o(7),a=o(6),s=o(12),c=o(1),l=o(4),u=o(0),p=function(e){return new webix.promise((function(t,o){u.a.getConfig().then((function(t){var o=t.urlApi+"/api/mensajes/send/webPush/new";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{data:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},f=o(13),d=o(5),h=o(9);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g,v,w,$=null,y=function(e){function t(){return m(this,t),b(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"layout",id:"creacionServicioForm",rows:[{view:"toolbar",css:"gradient2",padding:3,elements:[{view:"icon",icon:"mdi mdi-worker",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Aviso</span>"}]},{view:"form",scroll:"y",id:"frmServicios2",css:"colorFondo",elements:[{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-worker",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Datos</span>"}]},{cols:[{view:"text",id:"servicioId",name:"servicioId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0}]},{cols:[{view:"text",id:"operadorAgente",name:"operadorAgente",label:"Solicitado Por",labelPosition:"top",width:100},{view:"datepicker",id:"fechaEntrada",name:"fechaEntrada",width:150,label:"Fecha de Solicitud",labelPosition:"top",disabled:!0},{view:"text",id:"horaEntrada",name:"horaEntrada",width:80,label:"Hora",labelPosition:"top",required:!0,format:webix.i18n.timeFormatSt,pattern:{mask:"##:##"},disabled:!0},{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,label:"Nombre Cliente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"clientesList",data:[]}}]},{cols:[{view:"text",id:"direccionTrabajo",name:"direccionTrabajo",required:!0,width:350,label:"Direccion de trabajo",labelPosition:"top"},{view:"text",id:"poblacionTrabajo",name:"poblacionTrabajo",maxwidth:550,label:"Poblacion",labelPosition:"top"},{view:"combo",id:"cmbTiposProfesional",name:"tipoProfesionalId",options:{},label:"Profesión",labelPosition:"top",width:200,required:!0},{view:"text",id:"comercialCliente",name:"comercialCliente",maxwidth:550,label:"Comercial asociado",labelPosition:"top",disabled:!0}]},{cols:[{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",minwidth:400}]},{cols:[{view:"textarea",id:"descripcionAveria",name:"descripcionAveria",required:!0,label:"Descripción de la avería",labelPosition:"top",height:100},{view:"textarea",id:"observacionesAgente",name:"observacionesAgente",label:"Observaciones del agente",labelPosition:"top",height:60}]},{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-worker",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Viviendas</span>"}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:8},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda afectada 1</span>"}]},{view:"text",id:"nombreLocal1",name:"nombreLocal1",label:"<span class='requerido'>Nombre de la vivienda</span>",labelPosition:"top"},{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto1",name:"contacto1",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono11",name:"telefono11",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono21",name:"telefono21",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo1",value:null,name:"correo1",label:"Correo",labelPosition:"top"}]},{view:"textarea",id:"observaciones1",name:"observaciones1",label:"Observaciones",labelPosition:"top",height:100}]},{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda afectada 2</span>"}]},{cols:[{view:"text",id:"nombreLocal2",name:"nombreLocal2",label:"<span class='requerido'>Nombre de la vivienda</span>",labelPosition:"top"}]},{rows:[{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto2",name:"contacto2",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono12",name:"telefono12",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono22",name:"telefono22",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo2",value:null,name:"correo2",label:"Correo",labelPosition:"top"}]}]},{view:"textarea",id:"observaciones2",name:"observaciones2",label:"Observaciones",labelPosition:"top",height:100}]}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda afectada 3</span>"}]},{cols:[{view:"text",id:"nombreLocal3",name:"nombreLocal3",label:"<span class='requerido'>Nombre de la vivienda</span>",labelPosition:"top"}]},{rows:[{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto3",name:"contacto",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono13",name:"telefono13",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono23",name:"telefono23",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo3",value:null,name:"correo3",label:"Correo",labelPosition:"top"}]}]},{view:"textarea",id:"observaciones3",name:"observaciones3",label:"Observaciones",labelPosition:"top",height:100}]},{padding:{top:140,bottom:0,left:0,right:0},rows:[{cols:[{view:"button",label:"Cancelar",click:this.cancel,css:"webix_danger",hotkey:"esc"},{view:"button",label:"Solicitar",id:"aceptar",click:this.accept,css:"webix_primary",type:"form"}]}]}]}]}]}]}],scroll:!0}},t.prototype.init=function(e,t){this.cargarEventos()},t.prototype.urlChange=function(e,t){v=i.a.checkLoggedUser(),g=v.comercialId,d.languageService.setLanguage(this.app,"es"),this.load()},t.prototype.load=function(){this.loadEmpresas(),this.loadTiposProfesionales(),this.loadClientes(),this.loadUsuarios(),$$("fechaEntrada").setValue(new Date);var e=new Date,t=webix.i18n.timeFormatStr(e);t=t.replace(/\:/,""),$$("horaEntrada").setValue(t)},t.prototype.cargarEventos=function(){var e=this;$$("clientesList").attachEvent("onValueSuggest",(function(t){e.loadClienteData(t.id,null)})),$$("cmbEmpresas").attachEvent("onChange",(function(e,t){h.a.getEmpresa(e).then((function(e){$=e.usuCorreo})).catch((function(e){c.a.errorMessage(e)}))}))},t.prototype.cancel=function(){this.$scope.show("/top/servicios")},t.prototype.accept=function(){this.$scope.app.getService("locale")._;if($$("frmServicios2").validate()){var e={},t=[],o=$$("frmServicios2").getValues(),n={servicioId:o.servicioId,operadorAgente:o.operadorAgente,fechaEntrada:o.fechaEntrada,horaEntrada:o.horaEntrada,clienteId:o.clienteId,direccionTrabajo:o.direccionTrabajo,poblacionTrabajo:o.poblacionTrabajo,tipoProfesionalId:o.tipoProfesionalId,empresaId:o.empresaId,descripcionAveria:o.descripcionAveria,observacionesAgente:o.observacionesAgente,nombreCliente:o.nombreCliente,usuarioId:w.usuarioId,agenteId:g},i=n.horaEntrada,a=i.slice(0,2),s=i.slice(2);if(n.horaEntrada=a+":"+s,n.tipoProfesionalId||delete n.tipoProfesionalId,n.nombreCliente=$$("cmbClientes").data.text,""!=o.nombreLocal1)if(this.$scope.validaLocal(o,1)){if(e=this.$scope.crealocal(o,"1"),t.push(e),e={},""!=o.nombreLocal2){if(!this.$scope.validaLocal(o,2))return void c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 2");e=this.$scope.crealocal(o,"2"),t.push(e),e={}}if(""!=o.nombreLocal3){if(!this.$scope.validaLocal(o,3))return void c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 3");e=this.$scope.crealocal(o,"3"),t.push(e),e={}}n.locales=t,r.a.postServicioWeb(n).then((function(e){e&&u.a.getConfig().then((function(t){var o={asunto:"NUEVA SOLICITUD DE SERVICIO EN LA PLATAFORMA",cuerpo:"El usuario "+v.nombre+" ha dado de alta un nuevo servicio. Haga clic en este mensaje para verlo",url:t.urlClientAdmin+"/#!/top/serviciosForm?servicioId="+e.servicioId,id:e.servicioId,emisor:$};p(o).then((function(e){e&&f.a.postCorreoNuevoServicio(o).then((function(e){c.a.mensajeAceptar("Se ha creado el servicio correctamente y notificado a administración",window)})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 1");else c.a.errorMessage("Se tiene que rellenar por lo menos la primera de las viviendas afectadas")}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.crealocal=function(e,t){var o="contacto"+t,n="telefono1"+t,i="telefono2"+t,r="correo"+t,a="observaciones"+t;return{localAfectadoId:0,servicioId:0,nombreLocal:e["nombreLocal"+t],contacto:e[o],telefono1:e[n],telefono2:e[i],correo:e[r],observaciones:e[a]}},t.prototype.validaLocal=function(e,t){var o=!0,n="contacto"+t,i="telefono1"+t,r=e["nombreLocal"+t],a=e[n],s=e[i];return""!=r&&""!=a&&""!=s||(o=!1),o},t.prototype.loadEmpresas=function(){h.a.getEmpresas().then((function(e){var t=l.a.prepareDataForCombo("empresaId","nombre",e),o=$$("cmbEmpresas").getPopup().getList();o.clearAll(),o.parse(t),$$("cmbEmpresas").setValue(2),$$("cmbEmpresas").refresh(),e.forEach((function(e){2==e.empresaId&&($=e.usuCorreo)}))}))},t.prototype.loadTiposProfesionales=function(e){s.a.getTiposProfesional().then((function(t){var o=l.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTipoProfesionales").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbTipoProfesionales").setValue(e),$$("cmbTipoProfesionales").refresh())}))},t.prototype.loadClientes=function(){a.a.getClientesAgenteActivos(g).then((function(e){var t=l.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("clientesList").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.loadUsuarios=function(){var e=!1;i.a.getUsuarios().then((function(t){var o=t;if(o.length>0)for(var n=1;n<o.length;n++)if(1==o[n].usuarioWeb){w=o[n],e=!0;break}e||c.a.errorMessage("No hay ningún operador web en el sistema, contacte con administración.")})).catch((function(e){c.a.errorMessageAjax(e)}))},t.prototype.loadTiposProfesionales=function(e){s.a.getTiposProfesional().then((function(t){var o=l.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTiposProfesional").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbTiposProfesional").setValue(e),$$("cmbTiposProfesional").refresh())}))},t.prototype.loadClienteData=function(e,t){e&&a.a.getCliente(e).then((function(e){t?($$("direccionTrabajo").setValue(t.direccionTrabajo),$$("comercialCliente").setValue(e.colaboradorNombre),$$("poblacionTrabajo").setValue(t.poblacionTrabajo)):($$("direccionTrabajo").setValue(e.tipoViaTrabajo+" "+e.direccion2),$$("comercialCliente").setValue(e.colaboradorNombre),$$("poblacionTrabajo").setValue(e.poblacion2))}))},t}(n.c);t.default=y},function(e,t,o){"use strict";o.r(t);var n=o(3),i=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]});function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"datatable",autoConfig:!0,css:"webix_shadow_medium"}},t.prototype.init=function(e){e.parse(i)},t}(n.c);t.default=s},function(e,t,o){"use strict";o.r(t);var n,i=o(3),r=o(2),a=o(6),s=o(8),c=o(1),l=o(0),u=o(13),p=!1,f={getPopup:function(){p||(webix.ui({view:"popup",id:"myPopup",width:400,height:300,top:200,left:300,body:{rows:[{view:"form",id:"frmCorreo",elements:[{cols:[{view:"text",id:"posibleCorreo",name:"posibleCorreo",label:"Introduzca su correo electronico",labelPosition:"top",minWidth:150}]},{rows:[{padding:5,cols:[{},{},{view:"button",label:"Aceptar",css:"webix_primary",click:f.accept,type:"form",hotkey:"enter"}]}]}]}]}}),p=!0)},loadPopup:function(){$$("myPopup").show(),l.a.getConfig().then((function(e){n=e})).catch((function(e){message.errorMessageAjax(e)}))},accept:function(){if($$("frmCorreo").validate()){var e={email:$$("frmCorreo").getValues().posibleCorreo};a.a.postClientePorCampo(e).then((function(t){if(t){var o=t.clienteId,i={nombreEmpresa:"Comercializa",emisor:"proveedores@comercializa.info",destinatario:e.email,asunto:"Restablecer contraseña",cuerpo:n.urlClient+"/#!/restablecer?clienteId="+o};u.a.postCorreo(i).then((function(e){e&&($$("myPopup").hide(),c.a.normalMessage("Se ha enviado un enlace a su correo para restablecer su usario y contraseña"))})).catch((function(e){c.a.errorMessageAjax(e)}))}else s.a.postComercialPorCampo(e).then((function(t){if(t){var o=t.comercialId,i={nombreEmpresa:"Comercializa",emisor:"proveedores@comercializa.info",destinatario:e.email,asunto:"Restablecer contraseña",cuerpo:n.urlClient+"/#!/restablecer?comercialId="+o};u.a.postCorreo(i).then((function(e){e&&($$("myPopup").hide(),c.a.normalMessage("Se ha enviado un enlace a su correo para restablecer su usario y contraseña"))})).catch((function(e){c.a.errorMessageAjax(e)}))}else c.a.normalMessage("Correo incorrecto.")})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e.message)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")}};function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return f.getPopup(),{view:"layout",css:"loginBack",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmLogin",elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png'/>"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login",id:"login",required:!0,label:"Usuario",labelPosition:"top"},{view:"text",type:"password",name:"password",id:"password",required:!0,label:"Contraseña",labelPosition:"top"},{view:"checkbox",id:"recordar",name:"recordar",label:"Recordarme en este equipo",labelWidth:200,labelAlign:"left",value:0},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){var e;l.a.getVersion().then((function(t){$$("version").data.label="VRS "+t.version,$$("version").refresh(),(e=r.a.getAccesoCookie())&&($$("login").setValue(e.login),$$("password").setValue(e.password),$$("recordar").setValue(1))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){var e=this;if($$("frmLogin").validate()){var t=void 0,o=$$("frmLogin").getValues(),n={};a.a.getClientesActivosLogin(o.login,o.password).then((function(i){i?((t=i).esCliente=!0,r.a.setUsuarioCookie(t),o.recordar?(n={login:o.login,password:o.password},r.a.setAccesoCookie(n)):r.a.deleteAccesoCookie(),e.$scope.show("top/inicio")):s.a.getAgentesActivosLogin(o.login,o.password).then((function(i){i&&((t=i).esCliente=!1,r.a.setUsuarioCookie(t),o.recordar?(n={login:o.login,password:o.password},r.a.setAccesoCookie(n)):r.a.deleteAccesoCookie(),e.$scope.show("top/inicio"))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.cargarPopup=function(){f.loadPopup()},t}(i.c);t.default=m},function(e,t,o){"use strict";o.r(t);o(37);var n=o(3),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};var r=function(e){function t(o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r={id:"REPCLIENTES",version:"2.3.133",router:n.a,debug:!1,start:"/login"};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i({},r,o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.b);t.default=r,webix.ready((function(){var e=new r;e.use(n.d.Locale),e.use(n.d.Theme),webix.i18n.setLocale("es-ES"),e.render()}))},function(e,t,o){},function(e,t,o){var n={"./creacionServicioForm":33,"./creacionServicioForm.js":33,"./data":34,"./data.js":34,"./facturas":19,"./facturas.js":19,"./facturasEpisReport":14,"./facturasEpisReport.js":14,"./imprimirWindow":20,"./imprimirWindow.js":20,"./inicio":21,"./inicio.js":21,"./lineasTarifaProfesion":22,"./lineasTarifaProfesion.js":22,"./login":35,"./login.js":35,"./mainFooter":17,"./mainFooter.js":17,"./mainMenu":15,"./mainMenu.js":15,"./mainToolbar":16,"./mainToolbar.js":16,"./partes":32,"./partes.js":32,"./restablecer":23,"./restablecer.js":23,"./servicios":24,"./servicios.js":24,"./serviciosForm":25,"./serviciosForm.js":25,"./start":26,"./start.js":26,"./tarifas":27,"./tarifas.js":27,"./top":28,"./top.js":28};function i(e){var t=r(e);return o(t)}function r(e){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=r,e.exports=i,i.id=38},function(e,t,o){var n={"./en":29,"./en.js":29,"./es":30,"./es.js":30,"./fr.":31,"./fr..js":31,"./language_service":5,"./language_service.js":5};function i(e){var t=r(e);return o(t)}function r(e){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=r,e.exports=i,i.id=39}]);