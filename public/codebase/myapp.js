!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/codebase/",o(o.s=39)}([function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={getConfig:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getConfigMysql:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getVersion:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/version").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));o(0);var i={errorMessageAjax:function(e){var t=e.response;webix.alert({type:"alert-error",title:"ERROR",text:t})},errorMessage:function(e){webix.alert({type:"alert-error",title:"ERROR",text:e})},normalMessage:function(e){webix.alert({title:"INFORMATION",text:e})},errorRestriccion:function(){webix.alert({title:"INFORMATION",text:"Hay registros dependientes de esta entrada. No se puede eliminar."})},mensajeAceptar:function(e,t){webix.alert({title:"INFORMACIÓN",ok:"Aceptar",text:e,type:"alert-warning"}).then((function(e){t&&t.location.reload(!0)}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var i=o(11),n=o(0),a={getUsuarioCookie:function(){var e=i.a.getCookie("usuarioComercializa");return e?JSON.parse(e):null},setUsuarioCookie:function(e){i.a.setCookie("usuarioComercializa",JSON.stringify(e),1)},deleteUsuarioCookie:function(e){i.a.deleteCookie("usuarioComercializa")},getAccesoCookie:function(){var e=i.a.getCookie("loginComercializa");return e?JSON.parse(e):null},setAccesoCookie:function(e){i.a.setCookie("loginComercializa",JSON.stringify(e),1e5)},deleteAccesoCookie:function(){i.a.deleteCookie("loginComercializa")},checkLoggedUser:function(){var e=a.getUsuarioCookie();return e||(window.open("/#!/login","_self"),window.close(),!1)},getLoggedUser:function(){var e=a.getUsuarioCookie();return e||{}},getLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var i=o.urlApi+"/api/usuarios/login",n={usuario:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(i,n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},getUsuarios:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getDepartamentosAsociados:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamentos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuarioDepartamento:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{departamento:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e.usuarioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuarioDepartamento:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var i=o.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{departamento:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},deleteUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteUsuarioDepartamento:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareDataForCombo:function(){return[{id:1,value:"Usuario"},{id:2,value:"Jefe de Equipo"},{id:3,value:"Vigilante"}]}}},function(e,t,o){"use strict";o.d(t,"d",(function(){return U})),o.d(t,"b",(function(){return y})),o.d(t,"c",(function(){return f})),o.d(t,"a",(function(){return v}));var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(){r(this,e)},c=function(){function e(t){r(this,e),this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,o){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),o))return this.show(null)},e.prototype.getParam=function(e,t){var o=this._data[e];if(void 0!==o||!t)return o;var i=this.getParentView();return i?i.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(o){return(o.config.id===e||o.config.localId===e)&&o.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,o){var i=e.attachEvent(t,o);return this._events.push({obj:e,id:i}),i},e.prototype.contains=function(e){for(var t in this._subs){var o=this._subs[t].view;if(o===e||o.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var o=t.view._getDefaultSub();if(o)return o}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function l(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),o=[],i=0;i<t.length;i++){var n=t[i],a={},r=n.indexOf(":");if(-1===r&&(r=n.indexOf("?")),-1!==r){var s=n.substr(r+1).split(/[\:\?\&]/g),c=Array.isArray(s),l=0;for(s=c?s:s[Symbol.iterator]();;){var u;if(c){if(l>=s.length)break;u=s[l++]}else{if((l=s.next()).done)break;u=l.value}var p=u.split("=");a[p[0]]=decodeURIComponent(p[1])}}o[i]={page:r>-1?n.substr(0,r):n,params:a,isNew:!0}}return o}function u(e){var t=[],o=e,i=Array.isArray(o),n=0;for(o=i?o:o[Symbol.iterator]();;){var a;if(i){if(n>=o.length)break;a=o[n++]}else{if((n=o.next()).done)break;a=n.value}var r=a;t.push("/"+r.page);var s=p(r.params);s&&t.push("?"+s)}return t.join("")}function p(e){var t=[];for(var o in e)t.length&&t.push("&"),t.push(o+"="+encodeURIComponent(e[o]));return t.join("")}var d=function(){function e(t,o){r(this,e),this._next=1,this.route="string"==typeof t?{url:l(t),path:t}:t,this.index=o}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(){return new e(this.route,this.index+this._next)},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=u(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var o=this.route.url;if(null===e)return o;var i=this.route.url;if(o=i.slice(0,this.index+(t?this._next:0)),e){o=o.concat(l(e));for(var n=0;n<o.length;n++)i[n]&&(o[n].view=i[n].view),i[n]&&o[n].page===i[n].page&&(o[n].isNew=!1)}return o},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=u(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,o){var i=this,n=this._join(e,o);return new Promise((function(e,o){var a=u(n),r={url:n,redirect:a,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[r.redirect,t,r]))return void o(new s);r.confirm.catch((function(e){return o(e)})).then((function(){if(null!==r.redirect){if(r.redirect!==a)return c.show(r.redirect),void o(new s);i.route.path=a,i.route.url=n,e()}else o(new s)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=u(t.url)),new e(t,0)},e.prototype.update=function(e,t,o){var i=this.route.url[this.index+(o||0)];if(!i)return this.route.url.push({page:"",params:{}}),this.update(e,t,o);""===e?i.page=t:i.params[e]=t,this.route.path=u(this.route.url)},e}(),f=function(e){function t(o,i){r(this,t);var a=n(this,e.call(this,o.webix));return a.app=o,a._children=[],a}return a(t,e),t.prototype.ui=function(e,t){var o=(t=t||{}).container||e.container,n=this.app.createView(e);return this._children.push(n),n.render(o,this._segment,this),"object"!==(void 0===e?"undefined":i(e))||e instanceof c?n:n.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"===(void 0===e?"undefined":i(e))){for(var o in e)this.setParam(o,e[o]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var n=this.getParentView();return n?n.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var a=this.getSubViewInfo(t.target);if(a){if(a.parent!==this)return a.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,a.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},t.prototype._show=function(e,t,o){var i=this;return e.show(t,o,!0).then((function(){return i._init_url_data(),i._urlChange()})).then((function(){e.route.linkRouter&&(i.app.getRouter().set(e.route.path,{silent:!0}),i.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,o){var i=this;"string"==typeof t&&(t=new d(t,0)),this._segment=t,this._parent=o,this._init_url_data();var n="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==n?(this._container=n,this._render(t)):this._urlChange().then((function(){return i.getRoot()}))},t.prototype._render=function(e){var t=this,o=this.config();return o.then?o.then((function(o){return t._render_final(o,e)})):this._render_final(o,e)},t.prototype._render_final=function(e,t){var o=this,i=null,n=null,a=!1;if(this._container.tagName?n=this._container:(i=this._container).popup?(n=document.body,a=!0):n=this.webix.$$(i.id),!this.app||!n)return Promise.reject(null);var r=void 0,s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!i&&s.isNew&&s.view&&s.view.destructor();try{if(i&&!a){var l=n,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,n);var p=this._root;a&&p.setPosition&&!p.isVisible()&&p.show(),i&&(i.view&&i.view!==this&&i.view!==this.app&&i.view.destructor(),i.id=this._root.config.id,this.getParentView()||!this.app.app?i.view=this:i.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),r=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){r=Promise.reject(e)}return r.catch((function(e){return o._initError(o,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var o in this._subs){var i=this._subs[o],n=this._renderFrameLock(o,i,null);n&&t.push(n)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,o){if(!t.lock){var i=this._renderFrame(e,t,o);i&&(t.lock=i.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,o){var i=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==o&&(t.url=o),t.route){if(null!==o)return t.route.show(o,t.view).then((function(){return i._createSubView(t,t.route)}));if(t.branch)return}var n=t.view;if(!n&&t.url){if("string"==typeof t.url)return t.route=new d(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||n instanceof t.url||(n=new t.url(this.app,"")),n||(n=t.url)}if(n)return n.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var o=this;return this.app.createFromURL(t.current()).then((function(i){return i.render(e,t,o)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(c),h=function(e){function t(o,i){r(this,t);var a=n(this,e.call(this,o,i));return a._ui=i.ui,a}return a(t,e),t.prototype.config=function(){return this._ui},t}(f),m=function(){function e(t,o,i){r(this,e),this.path="",this.app=i}return e.prototype.set=function(e,t){this.path=e;var o=this.app;o.app.getRouter().set(o._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),b=!0,g=function(e){function t(o){r(this,t);var i=(o||{}).webix||window.webix,a=n(this,e.call(this,i));return a.config=a.webix.extend({name:"App",version:"1.0",start:"/home"},o,!0),a.app=a.config.app,a.ready=Promise.resolve(),a._services={},a.webix.extend(a,a.webix.EventSystem),a}return a(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,o){if((e instanceof c||"function"==typeof e&&e.prototype instanceof c)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,o);for(var n in t=t||(e instanceof Array?[]:{}),e){var a=e[n];if("function"==typeof a&&a.prototype instanceof c&&(a={$subview:a}),!a||"object"!==(void 0===a?"undefined":i(a))||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)t[n]=a;else if(a instanceof Date)t[n]=new Date(a);else{var r=this.copyConfig(a,a instanceof Array?[]:{},o);null!==r&&(t[n]=r)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var o=t.getAttribute("trigger");if(o)return this._forView(t,(function(e){return e.app.trigger(o)})),e.cancelBubble=!0,e.preventDefault();var i=t.getAttribute("route");if(i)return this._forView(t,(function(e){return e.show(i)})),e.cancelBubble=!0,e.preventDefault()}var n=t.parentNode;n&&this.clickHandler(e,n)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,o=this.config.views,i=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{o&&"string"==typeof(i="function"==typeof o?o(e):o[e])&&(e=i,i=null),i||(i="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){i=this._loadError(e,t)}return i.then||(i=Promise.resolve(i)),i=i.then((function(e){return e.__esModule?e.default:e})).catch((function(o){return t._loadError(e,o)}))},t.prototype._forView=function(e,t){var o=this.webix.$$(e);o&&t(o.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},t.prototype.createView=function(e,o){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:o,router:m});if(e.prototype instanceof c)return new e(this,{name:o});e=e(this)}return e instanceof c?e:new h(this,{name:o,ui:e})},t.prototype.show=function(e){return this.render(this._container,e||this.config.start)},t.prototype.trigger=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];this.apply(e,o)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];this.apply(e,o)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var o=0;o<t.length;o++)if(console.error(t[o]),t[o]instanceof Error){var i=t[o].message;0===i.indexOf("Module build failed")?(i=i.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+i+"</pre>"):(i+="<br><br>Check console for more details",this.webix.message({type:"error",text:i,expire:-1}))}},t.prototype.render=function(e,t,o){var i=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var n=null;!this.$router?(b&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return i.clickHandler(e)})),b=!1),"string"==typeof t&&(t=new d(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):n="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var a=this.getSubView(),r=this._subSegment,s=r.show(n,a).then((function(){return i.createFromURL(r.current())})).then((function(t){return t.render(e,r)})).then((function(e){return i.$router.set(r.route.path,{silent:!0}),i.callEvent("app:route",[i.getUrl()]),e}));return this.ready=this.ready.then((function(){return s})),s},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new f(this,{})},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof s))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var o=this._container;this.webix.html.addCss(o,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(o,"webixappstart"),t.webix.html.addCss(o,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new d(this.config.start,0));else{var i=this.$router.get();i||(i=this.config.start,this.$router.set(i,{silent:!0})),e=new d(i,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,o){var i=!0!==e.$subview?e.$subview:null,n=e.name||(i?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(o[n]={id:t.id,url:i,branch:e.branch,popup:e.popup}).popup?null:t},t}(c),v=function(){function e(t,o){var i=this;r(this,e),this.config=o||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return e.prototype.set=function(e,t){var o=this;if(this.config.routes){var i=e.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===i[0]){e=n+(i.length>1?"?"+i[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),o=this.config.routes[t[0]];o&&(e=o+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),w=!1;function $(e){if(!w&&e){w=!0;var t=window;t.Promise||(t.Promise=e.promise);var o=e.version.split(".");10*o[0]+1*o[1]<53&&(e.ui.freeze=function(t){var o=t();return o&&o.then?o.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),o});var n=e.ui.baselayout.prototype.addView,a=e.ui.baselayout.prototype.removeView,r={addView:function(e,t){var o=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return n.apply(this,arguments);var a=function(){var i=o.$scope,a={};e=i.app.copyConfig(e,{},a),n.apply(o,[e,t]);var r=function(e){i._renderFrame(e,a[e],null).then((function(){i._subs[e]=a[e]}))};for(var s in a)r(s);return{v:e.id}}();return"object"===(void 0===a?"undefined":i(a))?a.v:void 0},removeView:function(){if(a.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var o in t){var i=t[o];e.$$(i.id)||(i.view.destructor(),delete t[o])}}}};e.extend(e.ui.layout.prototype,r,!0),e.extend(e.ui.baselayout.prototype,r,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var o=e.uid().toString();for(var i in t.body={id:o},this.$ready.push((function(){this.$app.render({id:o})})),this.$app){var n=this.$app[i];"function"!=typeof n||this[i]||(this[i]=n.bind(this.$app))}}},e.ui.proxy)}}var y=function(e){function t(o){r(this,t),o.router=o.router||v;var i=n(this,e.call(this,o));return $(i.webix),i}return a(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),o(41)("./"+e)},t}(g);(function(){function e(t,o,i){r(this,e),this.storage=o.storage||i.webix.storage.session,this.name=o.storeName||o.id+":route",this.cb=t}e.prototype.set=function(e,t){var o=this;this.storage.put(this.name,e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.storage.get(this.name)}})(),function(e){function t(){return r(this,t),n(this,e.apply(this,arguments))}a(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function e(t,o){r(this,e),this.path="",this.cb=t}e.prototype.set=function(e,t){var o=this;this.path=e,t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.path}}();function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function P(e,t,o){for(var i in e)x(e,i)&&t.call(o||e,e[i],i,e)}function C(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var j=String.prototype.replace,_=String.prototype.split,I=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},A={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:I,chinese:function(){return 0},croatian:I,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:I,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},E={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function T(e){var t,o=(t={},P(E,(function(e,o){P(e,(function(e){t[e]=o}))})),t);return o[e]||o[_.call(e,/-/,1)[0]]||o.en}function V(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var F=/\$/g,S=/%\{(.*?)\}/g;function R(e,t,o,i){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var n=e,a=i||S,r="number"==typeof t?{smart_count:t}:t;if(null!=r.smart_count&&n){var s=_.call(n,"||||");n=(s[function(e,t){return A[T(e)](t)}(o||"en",r.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=j.call(n,a,(function(e,t){return x(r,t)&&null!=r[t]?j.call(r[t],F,"$$"):e}))}function k(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var o=t.allowMissing?R:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:o,this.warn=t.warn||C,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",o=e&&e.suffix||"}";if("||||"===t||"||||"===o)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(V(t)+"(.*?)"+V(o),"g")}(t.interpolation)}k.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},k.prototype.extend=function(e,t){P(e,(function(e,o){var n=t?t+"."+o:o;"object"===(void 0===e?"undefined":i(e))?this.extend(e,n):this.phrases[n]=e}),this)},k.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:P(e,(function(e,o){var n=t?t+"."+o:o;"object"===(void 0===e?"undefined":i(e))?this.unset(e,n):delete this.phrases[n]}),this)},k.prototype.clear=function(){this.phrases={}},k.prototype.replace=function(e){this.clear(),this.extend(e)},k.prototype.t=function(e,t){var o,i,n=null==t?{}:t;if("string"==typeof this.phrases[e])o=this.phrases[e];else if("string"==typeof n._)o=n._;else if(this.onMissingKey){i=(0,this.onMissingKey)(e,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),i=e;return"string"==typeof o&&(i=R(o,n,this.currentLocale,this.tokenRegex)),i},k.prototype.has=function(e){return x(this.phrases,e)},k.transformPhrase=function(e,t,o){return R(e,t,o)};var O=k;function N(e,t,o){if(t.urls)o=t.urls[o]||o;else if(t.param){var i;(i={})[t.param]=o,o=i}e.show(o)}var D={good:"check",error:"warning",saving:"refresh fa-spin"},L={good:"Ok",error:"Error",saving:"Connecting..."};function M(e,t,o){for(var i=0;i<o.length;i++)e[o[i]]=t[i+1]?t[i+1].page:""}var G=window.webix;G&&$(G);var U={UnloadGuard:function(e,t,o){t.on(e,"app:guard",(function(e,i,n){if(i===t||i.contains(t)){var a=o();n.confirm=!1===a?Promise.reject(new s):n.confirm.then((function(){return a}))}}))},Locale:function(e,t,i){var n=(i=i||{}).storage,a=n?n.get("lang")||"en":i.lang||"en";function r(t,o,r){o.__esModule&&(o=o.default);var s={phrases:o};i.polyglot&&e.webix.extend(s,i.polyglot);var l=c.polyglot=new O(s);if(l.locale(t),c._=e.webix.bind(l.t,l),a=t,n&&n.put("lang",a),i.webix){var u=i.webix[t];u&&e.webix.i18n.setLocale(u)}return r?Promise.resolve():e.refresh()}function s(e,t){if(!1!==i.path){var n=(i.path?i.path+"/":"")+e;r(e,o(42)("./"+n),t)}}var c={getLang:function(){return a},setLang:s,setLangData:r,_:null,polyglot:null};e.setService("locale",c),s(a,!0)},Menu:function(e,t,o){var i=t.getSubViewInfo().parent,n=t.$$(o.id||o),a=!1;n.attachEvent("onchange",(function(){a||N(i,o,this.getValue())})),n.attachEvent("onafterselect",(function(){if(!a){var e=null;n.setValue?e=this.getValue():n.getSelectedId&&(e=n.getSelectedId()),N(i,o,e)}})),t.on(e,"app:route",(function(){var e="";if(o.param)e=t.getParam(o.param,!0);else{var r=i.getUrl()[1];r&&(e=r.page)}e&&(a=!0,n.setValue&&n.getValue()!==e?n.setValue(e):n.select&&n.exists(e)&&n.getSelectedId()!==e&&n.select(e),a=!1)}))},Theme:function(e,t,o){var i=(o=o||{}).storage,n=i?i.get("theme")||"flat-default":o.theme||"flat-default",a={getTheme:function(){return n},setTheme:function(t,o){for(var a=t.split("-"),r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var c=r[s].getAttribute("title");c&&(c===t||c===a[0]?r[s].disabled=!1:r[s].disabled=!0)}e.webix.skin.set(a[0]),e.webix.html.removeCss(document.body,"theme-"+n),e.webix.html.addCss(document.body,"theme-"+t),n=t,i&&i.put("theme",t),o||e.refresh()}};e.setService("theme",a),a.setTheme(n,!0)},User:function(e,t,o){var i=(o=o||{}).login||"/login",n=o.logout||"/logout",a=o.afterLogin||e.config.start,r=o.afterLogout||"/login",s=o.ping||3e5,c=o.model,l=o.user,u={getUser:function(){return l},getStatus:function(e){return e?c.status().catch((function(){return null})).then((function(e){l=e})):null!==l},login:function(t,o){return c.login(t,o).then((function(t){if(l=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[l]),e.show(a)}))},logout:function(){return l=null,c.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function p(e,t){e===n?(u.logout(),t.redirect=r):e===i||u.getStatus()||(t.redirect=i)}e.setService("user",u),e.attachEvent("app:guard",(function(e,t,i){return!(!o.public||!o.public(e))||(void 0===l&&(i.confirm=u.getStatus(!0).then((function(){return p(e,i)}))),p(e,i))})),s&&setInterval((function(){return u.getStatus(!0)}),s)},Status:function(e,t,o){var i="good",n=0,a=!1,r=o.expire;r||!1===r||(r=2e3);var s=o.texts||L,c=o.icons||D;function l(e){var n=t.$$(o.target);n&&(e||(e="<div class='status_"+i+"'><span class='webix_icon fa-"+c[i]+"'></span> "+s[i]+"</div>"),n.setHTML(e))}function u(){n--,h("good")}function p(e){n--,h("error",e)}function d(e){n++,h("saving"),e&&e.then&&e.then(u,p)}function f(){0===n&&l(" ")}function h(t,o){n<0&&(n=0),"saving"===t?(i="saving",l()):(a="error"===t,0===n&&(i=a?"error":"good",a?e.error("app:error:server",[o.responseText||o]):r&&setTimeout(f,r),l()))}function m(o){var i=e.webix.dp(o);i&&(t.on(i,"onAfterDataSend",d),t.on(i,"onAfterSaveError",(function(e,t,o){return p(o)})),t.on(i,"onAfterSave",u))}"string"==typeof o&&(o={target:o}),e.setService("status",{getStatus:function(){return i},setStatus:h,track:m}),o.remote&&t.on(e.webix,"onRemoteCall",d),o.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,o,i,n,a,r){d(r)})),o.data&&m(o.data)},UrlParam:function(e,t,o){var i=o.route||o,n={};t.on(e,"app:urlchange",(function(e,o){t===e&&(M(n,o.suburl(),i),o.size(i.length+1))}));var a=t.setParam,r=t.getParam;t.setParam=function(e,o,r){var s=i.indexOf(e);return s>=0?(n[e]=o,this._segment.update("",o,s+1),r?t.show(null):void 0):a.call(this,e,o,r)},t.getParam=function(e,t){var o=n[e];return void 0!==o?o:r.call(this,e,t)},M(n,t.getUrl(),i)}},z=window;z.Promise||(z.Promise=z.webix.promise)},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={prepareDataForDataTable:function(e,t){var o=[];return t.forEach((function(t){t.id=t[e],o.push(t)})),o},prepareDataForCombo:function(e,t,o){var i=[];return o.forEach((function(o){i.push({id:o[e],value:o[t]})})),i}}},function(e,t,o){"use strict";o.r(t),o.d(t,"languageService",(function(){return a}));var i=o(3),n={es:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},en:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},fr:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}}},a={setLanguage:function(e,t){e.use(i.d.Locale,{lang:t}),webix.i18n.locales[t]=n[t],webix.i18n.setLocale(t)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesAgenteActivos:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/clientes-activos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesActivosLogin:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/clientes/activo/login",n={cliente:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(i,n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getTiposCliente:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_clientes";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getProIdCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/siguiente/proid/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/nuevo";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{cliente:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putClienteLogin:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/clientes/restablece/loginPass/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{cliente:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},postClientePorCampo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/recupera/cliente/activo/campo";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{valor:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getNuevaCuentaContable:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/clientes/nuevocodigo";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getInfContable:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/contabilidad/infcontable";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},compruebaNifRepetido:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/comprueba/nif/repetido/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getAgentes:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getAgentesNombre:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/activos/?nombre="+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getColaboradores:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/comerciales_activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getAgenteCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agente/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSyncAgentes:function(){var e=i.a.geturlApi()+"/api/comerciales/",t=webix.ajax().headers({"Content-Type":"application/json"}).sync().get(e),o={data:null,err:null};return 200!=t.status?o.err=t:o.data=JSON.parse(t.response),o},getAgentesActivosLogin:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/comerciales/login",n={login:e,password:t};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(i,n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},postComercialPorCampo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/recupera/comercial/activo/campo/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{valor:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putComercialLogin:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/comerciales/restablece/loginPass/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{comercial:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getServiciosPartes:function(e,t,o){return new webix.promise((function(n,a){i.a.getConfig().then((function(i){var n=i.urlApi+"/api/servicios/partes/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){n(e.json())})).catch((function(e){a(e)}))}))},getServicioParte:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/servicios/parte/uno/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getServiciosComercial:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/agente/"+e.comercialId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getServicio:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getNumServicio:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/servicios/nuevo/numero/servicio";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},postServicioWeb:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/web";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{servicio:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putServicio:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e.servicioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{servicio:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteServicio:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareData:function(e){return e.forEach((function(e){e.fechaEntrada&&(e.fechaEntrada=new Date(e.fechaEntrada))})),e}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getEmpresas:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getFacturasReparaciones:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/facturas/solo/reparaciones";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getFacturasClienteAgenteDepartamento:function(e,t,o,n){return new webix.promise((function(a,r){i.a.getConfig().then((function(i){var a=i.urlApi+"/api/facturas/cliente-agente/recupera/todas/"+t+"/"+o+"/"+e+"/"+n;return webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(a)})).then((function(e){a(e.json())})).catch((function(e){r(e)}))}))},getFacprovesReparaciones:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/facturasProveedores/solo/reparaciones";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},recuperaFechaCobroCli:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/facturas/recupera/fecha/cobro/conta/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},recuperaFechaPagoPro:function(e,t,o){return new webix.promise((function(n,a){i.a.getConfig().then((function(i){var n=i.urlApi+"/api/facturasProveedores/recupera/fecha/cobro/conta/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){n(e.json())})).catch((function(e){a(e)}))}))},postGeneraFacturasClientes:function(e,t,o,n){return new webix.promise((function(a,r){i.a.getConfig().then((function(i){var a=i.urlApi+"/api/facturas/factura/cliente/parte/"+t+"/"+o+"/"+n;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(a,{seleccionados:e})})).then((function(e){a(e.json())})).catch((function(e){r(e)}))}))},postGeneraPrefacturasClientes:function(e,t,o,n){return new webix.promise((function(a,r){i.a.getConfig().then((function(i){var a=i.urlApi+"/api/prefacturas/prefactura/cliente/parte/"+t+"/"+o+"/"+n;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(a,{seleccionados:e})})).then((function(e){a(e.json())})).catch((function(e){r(e)}))}))},postGeneraFacturasProfesionales:function(e,t,o,n){return new webix.promise((function(a,r){i.a.getConfig().then((function(i){var a=i.urlApi+"/api/facturas/factura/cliente/parte/"+t+"/"+o+"/"+n;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(a,{seleccionados:e})})).then((function(e){a(e.json())})).catch((function(e){r(e)}))}))},postGeneraFacturasProveedores:function(e,t,o,n){return new webix.promise((function(a,r){i.a.getConfig().then((function(i){var a=i.urlApi+"/api/facturasProveedores/factura/proveedores/parte/"+t+"/"+o+"/"+n;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(a,{seleccionados:e})})).then((function(e){a(e.json())})).catch((function(e){r(e)}))}))},putLineaFacprove:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/facturasProveedores/actualiza/linea/desde/parte/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{datos:e})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},putCabFacprove:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturasProveedores/actualiza/cabecera/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaFacprove:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/facturasProveedores/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i,{facproveLinea:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},putLineaFactura:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturas/actualiza/linea/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putCabFactura:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/facturas/actualiza/cabecera/factura/desde/parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{datos:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaFactura:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/facturas/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i,{facturaLinea:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteAntprove:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/anticiposProveedores/borrar/desde/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i,{proveedorId:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteAntclien:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/anticiposClientes/borrar/desde/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i,{clienteId:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={areCookiesEnabled:function(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie",e=-1!=document.cookie.indexOf("testcookie")),e},setCookie:function(e,t,o){i.areCookiesEnabled()||alert("NO COOKIES");var n=new Date;n.setDate(n.getDate()+o);var a=encodeURI(t)+(null==o?"":"; expires="+n.toUTCString());document.cookie=e+"="+a},deleteCookie:function(e){i.areCookiesEnabled()||alert("NO COOKIES"),document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},getCookie:function(e){var t,o,i,n=document.cookie.split(";");for(t=0;t<n.length;t++)if(o=n[t].substr(0,n[t].indexOf("=")),i=n[t].substr(n[t].indexOf("=")+1),(o=o.replace(/^\s+|\s+$/g,""))==e)return decodeURI(i)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={postCorreo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/correoElectronico/enlace";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,e)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postCorreoNuevoServicio:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/servicios/enviar/correo/servicio/web";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{correo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postCorreoNuevoCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/enviar/correo/cliente/web";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{correo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getTarifasCliente:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/tarifas_cliente";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getTarifaProfesiones:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/tarifas_cliente/cliente-agente/recupera/tarifa-profesiones/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getLineasTarifaProfesion:function(e,t){var o=[];return o.push(t),new webix.promise((function(t,n){i.a.getConfig().then((function(t){var i=t.urlApi+"/api/tarifas_cliente/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(i,{tiposProfesionales:o})})).then((function(e){t(e.json())})).catch((function(e){n(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getFormasPago:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/formas_pago";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var i,n=o(3),a=o(0);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return r(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"facturasEpisReport",position:"top",move:!0,resize:!0,scroll:"x,y",width:1129,height:775,fullscreen:!1,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("facturasEpisReport").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){a.a.getConfigMysql().then((function(e){i=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){$$("facturasEpisReport").show();var o=new Stimulsoft.Viewer.StiViewerOptions;Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile("../stireport/localization/es.xml",!0),Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHltN9ZO4D78QwpEoh6+UpBm5mrGyhSAIsuWoljPQdUv6R6vgviStsx8W3jirJvfPH27oRYrC2WIPEmaoAZTNtqb+nDxUpJlSmG62eA46oRJDV8kJ2cJSEx19GMJXYgZvv7yQT9aJHYaSrTVD7wdhpNVS1nQC3OtisVd7MQNQeM40GJxcZpyZDPfvld8mK6VX0RTPJsQZ7UcCEH4Y3LaKzA5DmUS+mwSnjXz/JFv1uO2JNkfcioieXfYfTaBIgZlKecarCS5vBgMrXly3m5kw+YwpJ2v+cMXuDk3UrZgrdxNnOhg8ZHPg9ijHxqUomZZBzKpVQU0d06ne60j/liMH5KirAI2JCVfBcBvIcyliJos8LAWr9q/1sPR9y7LmA1eyS1/dXaxmEaqi5ubhLqlf+OS0xFX6tlBBgegqHlIj6Fytwvq5YlGAZ0Cra05JhnKh/ohYlADQz6Jbg5sOKyn5EbejvPS3tWr0LRBH2FO6+mJaSEAwzGmoWT057ScSvGgQmfx8wCqSF+PgK/zTzjy75Oh",StiOptions.WebServer.url=i.report.stiUrl,o.appearance.scrollbarsMode=!0,o.appearance.fullScreenMode=!1,o.toolbar.showSendEmailButton=!1,o.toolbar.viewMode=Stimulsoft.Viewer.StiWebViewMode.Continuous;var n=new Stimulsoft.Viewer.StiViewer(o,"StiViewer",!1),a=new Stimulsoft.Report.StiReport;a.loadFile(t);i.report.host;i.report.database,i.report.user,i.report.password;for(var r=0;r<a.dataSources.items.length;r++)a.dataSources.items[r].sqlCommand;var s=a.dataSources.items[0].sqlCommand;s=s+" WHERE pf.facturaId = "+e,a.dataSources.items[0].sqlCommand=s,n.report=a,n.renderHtml("report_viewer")},t.prototype.cancel=function(){$$("facturasEpisReport").hide()},t}(n.c);t.default=c},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return a(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=n.a.checkLoggedUser(),t=this.app.getService("locale")._,o={view:"sidebar",width:280,id:"main:menu",activeTitle:!0,select:!0,data:[{id:"inicio",icon:"mdi mdi-home",value:"Inicio"},{id:"Reparaciones",icon:"mdi mdi-book",value:t("Reparaciones"),open:!0,data:[{id:"creacionServicioForm",icon:"mdi mdi-worker",value:"<i style='font-weight: bold; color: blue;'>Solicitud de reparación</i>"},{id:"creacionClienteForm",icon:"mdi mdi-account-box",value:"<i style='font-weight: bold; color: blue;'>Dar cliente de alta</i>"},{id:"facturas",icon:"mdi mdi-currency-eur",value:t("Facturas")},{id:"servicios",icon:"mdi mdi-transcribe",value:t("Servicios")},{id:"tarifas",icon:"mdi mdi-coin",value:t("Tarifas")}]}]},i={view:"sidebar",width:280,id:"main:menu",activeTitle:!0,select:!0,data:[{id:"inicio",icon:"mdi mdi-home",value:"Inicio"},{id:"Reparaciones",icon:"mdi mdi-book",value:t("Reparaciones"),open:!0,data:[{id:"facturas",icon:"mdi mdi-currency-eur",value:t("Facturas")},{id:"servicios",icon:"mdi mdi-transcribe",value:t("Servicios")},{id:"tarifas",icon:"mdi mdi-coin",value:t("Tarifas")}]}]};return 1!=e.tipoComercialId?i:o},t.prototype.init=function(){this.use(i.d.Menu,"main:menu")},t}(i.c);t.default=s},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(5);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return r(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app,o=(t.getService("locale"),t.getService("theme"),n.a.getUsuarioCookie());this.app.getService("locale")._;return{view:"toolbar",height:60,elements:[{view:"button",type:"icon",icon:"mdi mdi-menu",width:37,align:"left",click:function(){$$("main:menu").toggle()}},{view:"label",label:"<a href='#!/top/inicio'><img src='assets/img/logo.png' height='50' /></a>",width:150},{view:"button",width:60,label:'<span class="mdi mdi-account-key mdi-36px mystyle"></span>'},{height:46,id:"person_template",css:"header_person",borderless:!0,data:o,template:function(e){var t="<div style='height:100%;width:100%;'>";return t+="<span class='name'>"+e.nombre+"</span> </div>"}},{view:"label",label:"\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t<img style=\"vertical-align:middle\" src='assets/img/handshake.png' height='35' />\n\t\t\t\t\t\t<span>"+this.app.config.name+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t",width:200},{view:"button",type:"icon",icon:"mdi mdi-exit-run mdi-36px",width:50,align:"right",tooltip:"Salir",click:function(){n.a.deleteUsuarioCookie(),e.show("/login")}}]}},t.prototype.init=function(){n.a.checkLoggedUser(),a.languageService.setLanguage(this.app,"es")},t}(i.c);t.default=c},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=(o(11),o(0)),r=function(){return new webix.promise((function(e,t){a.a.getConfig().then((function(e){var t=e.urlApi+"/api/version";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t,null)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;e.getService("locale"),e.getService("theme"),n.a.getUsuarioCookie(),this.app.getService("locale")._;return{view:"label",id:"vers",align:"center",label:"NREG: ",height:60,minWidth:100}},t.prototype.init=function(){r().then((function(e){$$("vers").config.label="Proasistencia "+e.version+" - Aplicación general © Ariadna Software S.L. 2019-2020",$$("vers").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?messageApi.errorRestriccion():messageApi.errorMessageAjax(e)}))},t}(i.c);t.default=l},function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var i=o(2),n=o(0),a={pushServicio:function(e){return new Promise((function(t,o){n.a.getConfig().then((function(t){var o=t.one_push_url,n=i.a.getUsuarioCookie(),a={app_id:t.one_app_id,included_segments:["Web Users"],contents:{en:"El usuario "+n.nombre+" ha dado de alta un nuevo servicio. Haga clic en este mensaje para verlo"},headings:{en:"NUEVA SOLICITUD DE SERVICIO EN LA PLATAFORMA"},url:t.urlClientAdmin+"/#!/top/serviciosForm?servicioId="+e};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json",Authorization:"Basic "+t.one_api_key}).post(o,a)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},pushServicioApi:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/mensajes/send/webPush/new";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{data:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(0),n={getTiposProfesional:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getTiposProfesionalesTarifa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/tarifa/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getTipoProfesional:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postTipoProfesional:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{tipoProfesional:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putTipoProfesional:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{tipoProfesional:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteTipoProfesional:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(8),r=o(6),s=o(20),c=o(1),l=o(4),u=o(19),p=o(0),d=o(12),f=o(5),h=o(9);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g,v,w,$=null,y=function(e){function t(){return m(this,t),b(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"layout",id:"creacionServicioForm",rows:[{view:"toolbar",css:"gradient2",padding:3,elements:[{view:"icon",icon:"mdi mdi-worker",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Aviso</span>"},{view:"button",id:"aceptar",click:this.accept,css:"bt_1 webix_primary",type:"icon",label:'<i class="mdi mdi-send" style="font-size: 20px; margin-right: 25px">Enviar</i>',width:200}]},{view:"form",scroll:"y",id:"frmServicios2",css:"colorFondo",elements:[{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-clipboard-account",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Datos</span>"}]},{cols:[{view:"text",id:"servicioId",name:"servicioId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0}]},{cols:[{view:"text",id:"operadorAgente",name:"operadorAgente",label:"Solicitado Por",labelPosition:"top",width:100},{view:"datepicker",id:"fechaEntrada",name:"fechaEntrada",width:150,label:"Fecha de Solicitud",labelPosition:"top",disabled:!0},{view:"text",id:"horaEntrada",name:"horaEntrada",width:80,label:"Hora",labelPosition:"top",required:!0,format:webix.i18n.timeFormatSt,pattern:{mask:"##:##"},disabled:!0},{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,label:"Nombre Cliente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"clientesList",data:[]}}]},{cols:[{view:"text",id:"direccionTrabajo",name:"direccionTrabajo",required:!0,width:350,label:"Direccion de trabajo",labelPosition:"top"},{view:"text",id:"poblacionTrabajo",name:"poblacionTrabajo",maxwidth:550,label:"Poblacion",labelPosition:"top"},{view:"combo",id:"cmbTiposProfesional",name:"tipoProfesionalId",options:{},label:"Profesión",labelPosition:"top",width:200,required:!0},{view:"text",id:"comercialCliente",name:"comercialCliente",maxwidth:550,label:"Comercial asociado",labelPosition:"top",disabled:!0}]},{cols:[{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",minwidth:400}]},{cols:[{view:"textarea",id:"descripcionAveria",name:"descripcionAveria",required:!0,label:"Descripción de la avería",labelPosition:"top",height:100},{view:"textarea",id:"observacionesAgente",name:"observacionesAgente",label:"Observaciones del agente",labelPosition:"top",height:60}]},{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-modern",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Viviendas / locales</span>"}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:8},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda / local afectado 1</span>"}]},{view:"text",id:"nombreLocal1",name:"nombreLocal1",label:"<span class='requerido'>Nombre de la vivienda / local</span>",labelPosition:"top"},{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto1",name:"contacto1",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono11",name:"telefono11",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono21",name:"telefono21",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo1",value:null,name:"correo1",label:"Correo",labelPosition:"top"}]},{view:"textarea",id:"observaciones1",name:"observaciones1",label:"Observaciones",labelPosition:"top",height:100}]},{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda / local afectado 2</span>"}]},{cols:[{view:"text",id:"nombreLocal2",name:"nombreLocal2",label:"<span class='requerido'>Nombre de la vivienda / local</span>",labelPosition:"top"}]},{rows:[{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto2",name:"contacto2",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono12",name:"telefono12",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono22",name:"telefono22",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo2",value:null,name:"correo2",label:"Correo",labelPosition:"top"}]}]},{view:"textarea",id:"observaciones2",name:"observaciones2",label:"Observaciones",labelPosition:"top",height:100}]}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-home-outline",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Vivienda / local afectado 3</span>"}]},{cols:[{view:"text",id:"nombreLocal3",name:"nombreLocal3",label:"<span class='requerido'>Nombre de la vivienda / local</span>",labelPosition:"top"}]},{rows:[{template:"Persona de contacto",type:"section"},{view:"text",id:"contacto3",name:"contacto3",label:"<span class='requerido'>Nombre</span>",labelPosition:"top"},{cols:[{view:"text",id:"telefono13",name:"telefono13",label:"<span class='requerido'>Telefono (1)</span>",labelPosition:"top"},{view:"text",id:"telefono23",name:"telefono23",label:"Telefono (2)",labelPosition:"top"},{view:"text",id:"correo3",value:null,name:"correo3",label:"Correo",labelPosition:"top"}]}]},{view:"textarea",id:"observaciones3",name:"observaciones3",label:"Observaciones",labelPosition:"top",height:100}]},{padding:{top:140,bottom:0,left:0,right:0},rows:[{cols:[{minwidth:300}]}]}]}]}]}]}],scroll:!0}},t.prototype.init=function(e,t){this.cargarEventos()},t.prototype.urlChange=function(e,t){v=n.a.checkLoggedUser(),g=v.comercialId,f.languageService.setLanguage(this.app,"es"),this.load()},t.prototype.load=function(){this.loadEmpresas(),this.loadTiposProfesionales(),this.loadClientes(),this.loadUsuarios(),$$("fechaEntrada").setValue(new Date);var e=new Date,t=webix.i18n.timeFormatStr(e);t=t.replace(/\:/,""),$$("horaEntrada").setValue(t)},t.prototype.cargarEventos=function(){var e=this;$$("clientesList").attachEvent("onValueSuggest",(function(t){e.loadClienteData(t.id,null)})),$$("cmbEmpresas").attachEvent("onChange",(function(e,t){h.a.getEmpresa(e).then((function(e){$=e.usuCorreo})).catch((function(e){c.a.errorMessage(e)}))}))},t.prototype.cancel=function(){this.$scope.show("/top/servicios")},t.prototype.accept=function(){if($$("frmServicios2").validate()){var e={},t=[],o=$$("frmServicios2").getValues(),i={servicioId:o.servicioId,operadorAgente:o.operadorAgente,fechaEntrada:o.fechaEntrada,horaEntrada:o.horaEntrada,clienteId:o.clienteId,direccionTrabajo:o.direccionTrabajo,poblacionTrabajo:o.poblacionTrabajo,tipoProfesionalId:o.tipoProfesionalId,empresaId:o.empresaId,descripcionAveria:o.descripcionAveria,observacionesAgente:o.observacionesAgente,nombreCliente:o.nombreCliente,usuarioId:w.usuarioId,agenteId:g},n=i.horaEntrada,r=n.slice(0,2),s=n.slice(2);if(i.horaEntrada=r+":"+s,i.tipoProfesionalId||delete i.tipoProfesionalId,i.nombreCliente=$$("cmbClientes").data.text,""!=o.nombreLocal1)if(this.$scope.validaLocal(o,1)){if(e=this.$scope.crealocal(o,"1"),t.push(e),e={},""!=o.nombreLocal2){if(!this.$scope.validaLocal(o,2))return void c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 2");e=this.$scope.crealocal(o,"2"),t.push(e),e={}}if(""!=o.nombreLocal3){if(!this.$scope.validaLocal(o,3))return void c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 3");e=this.$scope.crealocal(o,"3"),t.push(e),e={}}i.locales=t,a.a.postServicioWeb(i).then((function(e){e&&p.a.getConfig().then((function(t){var o={asunto:"NUEVA SOLICITUD DE SERVICIO EN LA PLATAFORMA",cuerpo:"El usuario "+v.nombre+" ha dado de alta un nuevo servicio. Haga clic en este mensaje para verlo",url:t.urlClientAdmin+"#!/top/serviciosForm?servicioId="+e.servicioId,id:e.servicioId,emisor:$};u.a.pushServicioApi(o).then((function(e){e&&d.a.postCorreoNuevoServicio(o).then((function(e){c.a.mensajeAceptar("Se ha creado el servicio correctamente y notificado a administración",window)})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Faltan campos obligatorios en la vivienda afectada 1");else c.a.errorMessage("Se tiene que rellenar por lo menos la primera de las viviendas afectadas")}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.crealocal=function(e,t){var o="contacto"+t,i="telefono1"+t,n="telefono2"+t,a="correo"+t,r="observaciones"+t;return{localAfectadoId:0,servicioId:0,nombreLocal:e["nombreLocal"+t],contacto:e[o],telefono1:e[i],telefono2:e[n],correo:e[a],observaciones:e[r]}},t.prototype.validaLocal=function(e,t){var o=!0,i="contacto"+t,n="telefono1"+t,a=e["nombreLocal"+t],r=e[i],s=e[n];return""!=a&&""!=r&&""!=s||(o=!1),o},t.prototype.loadEmpresas=function(){h.a.getEmpresas().then((function(e){var t=[];e.forEach((function(e){2!=e.empresaId&&3!=e.empresaId&&7!=e.empresaId||t.push(e)}));var o=l.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbEmpresas").setValue(2),$$("cmbEmpresas").refresh(),e.forEach((function(e){2==e.empresaId&&($=e.usuCorreo)}))}))},t.prototype.loadClientes=function(){r.a.getClientesAgenteActivos(g).then((function(e){var t=l.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("clientesList").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.loadUsuarios=function(){var e=!1;n.a.getUsuarios().then((function(t){var o=t;if(o.length>0)for(var i=1;i<o.length;i++)if(1==o[i].usuarioWeb){w=o[i],e=!0;break}e||c.a.errorMessage("No hay ningún operador web en el sistema, contacte con administración.")})).catch((function(e){c.a.errorMessageAjax(e)}))},t.prototype.loadTiposProfesionales=function(e){s.a.getTiposProfesional().then((function(t){var o=[];t.forEach((function(e){(e.tipoProfesionalId>=2&&e.tipoProfesionalId<=9||12==e.tipoProfesionalId)&&o.push(e)}));var i=l.a.prepareDataForCombo("tipoProfesionalId","nombre",o),n=$$("cmbTiposProfesional").getPopup().getList();n.clearAll(),n.parse(i),e&&($$("cmbTiposProfesional").setValue(e),$$("cmbTiposProfesional").refresh())}))},t.prototype.loadClienteData=function(e,t){e&&r.a.getCliente(e).then((function(e){t?($$("direccionTrabajo").setValue(t.direccionTrabajo),$$("comercialCliente").setValue(e.colaboradorNombre),$$("poblacionTrabajo").setValue(t.poblacionTrabajo)):($$("direccionTrabajo").setValue(e.tipoViaTrabajo+" "+e.direccion2),$$("comercialCliente").setValue(e.colaboradorNombre),$$("poblacionTrabajo").setValue(e.poblacion2))}))},t}(i.c);t.default=y},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(10),r=o(1),s=o(4),c=o(5),l=o(9),u=o(15);function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){return p(this,t),d(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,o=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Facturas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("facturasGrid"),{filename:"facturas",name:"Partes",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"facturasNReg",label:"NREG: "},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},((e={view:"datatable",css:{"font-size":"0.9em"},id:"facturasGrid",scroll:"x,y",pager:"mypager1",select:"row",scheme:{$change:function(e){$$("facturasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"facturaId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"numeroFactura",header:[{text:"Numero.",css:{"text-align":"left"}},{content:"textFilter"}],sort:"string",adjust:!0,css:{"text-align":"left"}},{id:"emisorNombre",header:["Emp.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"receptorNombre",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fecha",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"total",header:["Base",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"totalConIva",header:["Total",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"formaPagoNombre",header:["Forma de pago",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-printer'></span>",css:{"text-align":"center"},adjust:"header"}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var i=this,n=this.data.pull[t.row],a="",s="";l.a.getEmpresa(n.empresaId).then((function(e){e.infFacCliRep&&""!=e.infFacCliRep?(s=e.infFacCliRep,a="/stireport/reports/"+s+".mrt",i.$scope.imprimirWindow.showWindow(n.facturaId,a)):(a="/stireport/reports/factcli_reparaciones_generico.mrt",i.$scope.imprimirWindow.showWindow(n.facturaId,a))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridFacturas",this.getState())},onItemDblClick:function(e,t,o){var i=this,n=this.data.pull[e.row],a="",s="";l.a.getEmpresa(n.empresaId).then((function(e){e.infFacCliRep&&""!=e.infFacCliRep?(s=e.infFacCliRep,a="/stireport/reports/"+s+".mrt",i.$scope.imprimirWindow.showWindow(n.facturaId,a)):(a="/stireport/reports/factcli_reparaciones_generico.mrt",i.$scope.imprimirWindow.showWindow(n.facturaId,a))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}},e)]}},t.prototype.init=function(e,t){var o=n.a.checkLoggedUser();this.imprimirWindow=this.ui(u.default);var i=this.getUrlParams(),a=i.facturaId,r=i.empresaId,s=(i.esCliente,null);if(o.comercialId&&1==o.tipoComercialId&&(s=i.agenteId,a&&r)){if(s!=o.comercialId)return;this.showFactura(a,r)}if(o.clienteId&&(s=i.clienteId,a&&r)){if(s!=o.clienteId)return;this.showFactura(a,r)}},t.prototype.showFactura=function(e,t){var o=this,i="",n="";l.a.getEmpresa(t).then((function(t){t.infFacCliRep&&""!=t.infFacCliRep?(n=t.infFacCliRep,i="/stireport/reports/"+n+".mrt",o.imprimirWindow.showWindow(e,i)):(i="/stireport/reports/factcli_reparaciones_generico.mrt",o.imprimirWindow.showWindow(e,i))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.getUrlParams=function(){var e={},t=window.location.href,o=t.indexOf("#!");if(o>=0){var i=t.substring(o).split("?")[1];if(i)for(var n=i.split("&"),a=0;a<n.length;a++){var r=n[a].split("=");e[r[0]]=decodeURIComponent(r[1])}}return e},t.prototype.urlChange=function(e,t){var o=n.a.getLoggedUser(),i=!1,a=o.comercialId,r=o.tipoComercialId;o.esCliente&&(i=!0,a=o.clienteId,r=0),c.languageService.setLanguage(this.app,"es"),this.load(i,a,r)},t.prototype.load=function(e,t,o){var i=this;webix.extend($$("facturasGrid"),webix.ProgressBar),$$("facturasGrid").showProgress({type:"bottom",delay:8e3,hide:!0}),a.a.getFacturasClienteAgenteDepartamento(e,t,7,o).then((function(e){e||(e=[]),e=i.formateaCampos(e),$$("facturasGrid").clearAll(),$$("facturasGrid").parse(s.a.prepareDataForDataTable("facturaId",e));var t=$$("facturasGrid").count();$$("facturasNReg").config.label="NREG: "+t,$$("facturasNReg").refresh();var o=webix.storage.local.get("stateGridFacturas");o&&i.$$("facturasGrid").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.formateaCampos=function(e){return e.forEach((function(e){e.emisorNombre=e.emisorNombre.substr(0,3),e.fecha=new Date(e.fecha)})),e},t.prototype.cleanAndload=function(){$$("facturasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}}));var e=n.a.getLoggedUser(),t=!1,o=e.comercialId,i=e.tipoComercialId;e.esCliente&&(t=!0,o=e.clienteId,i=0),this.load(t,o,i)},t.prototype.print=function(){},t}(i.c);t.default=f},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return a(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"imprimirWindow",position:"center",move:!0,resize:!0,fullscreen:!0,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("imprimirWindow").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){n.a.getConfigMysql().then((function(e){myconfig=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){},t.prototype.cancel=function(){$$("imprimirWindow").hide()},t}(i.c);t.default=s},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(5);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return r(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"iframe",id:"frame-body",src:"/ComerWeb/index.html"}},t.prototype.init=function(){n.a.checkLoggedUser(),a.languageService.setLanguage(this.app,"es")},t}(i.c);t.default=c},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(1),r=o(4),s=o(13),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-format-list-numbers",width:37,align:"left"},{view:"label",label:"Lineas de tarifa"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("tarifaLineasGrid"),{filename:"avisos",name:"Tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "}]},{view:"datatable",id:"tarifaLineasGrid",autoWidth:!0,heigth:800,select:"row",scheme:{$change:function(e){$$("tarifaLineasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"tarifaClienteLineaId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"codigoReparacion",header:["Codigo",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"unidadConstructiva",header:["Descripcion",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"precioUnitario",header:["Importe",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:!0}],onClick:{},editable:!0,editaction:"dblclick",rules:{},on:{}},{view:"form",id:"frmBotones",elements:[{cols:[{minwidth:600},{rows:[{padding:20,cols:[{view:"button",label:"Volver",click:this.accept,type:"form"}]}]}]}]}]}},t.prototype.init=function(e,t){},t.prototype.urlChange=function(e,t){n.a.checkLoggedUser(),c.languageService.setLanguage(this.app,"es");var o=null,i=null;t[0].params.tarifaClienteId&&(o=t[0].params.tarifaClienteId),t[0].params.tipoProfesionalId&&(i=t[0].params.tipoProfesionalId),i&&o&&this.load(o,i)},t.prototype.load=function(e,t){s.a.getLineasTarifaProfesion(e,t).then((function(e){$$("tarifaLineasGrid").clearAll(),$$("tarifaLineasGrid").parse(r.a.prepareDataForDataTable("tarifaClienteLineaId",e));var t=$$("tarifaLineasGrid").count();$$("TarifasNReg").config.label="NREG: "+t,$$("TarifasNReg").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.accept=function(){this.$scope.show("/top/tarifas")},t.prototype.cleanAndload=function(){$$("tarifaLineasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(i.c);t.default=p},function(e,t,o){"use strict";o.r(t);var i,n,a=o(3),r=o(6),s=o(7),c=o(1),l=o(0);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){return u(this,t),p(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return this.app,{view:"layout",css:"loginBackRestablecer",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmRestablecer",rules:{$obj:function(e){return e.login1!=e.login2?(webix.message("Los nombres de usuario no coinciden"),!1):e.password1==e.password2||(webix.message("Las contraseñas no coinciden"),!1)}},elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png'/>"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login1",id:"login1",required:!0,label:"Nuevo nombre de usuario",labelPosition:"top"},{view:"text",name:"login2",id:"login2",required:!0,label:"Repita nuevo nombre de usuario",labelPosition:"top"},{view:"text",type:"password",name:"password1",id:"password1",required:!0,label:"Nueva Contraseña",labelPosition:"top"},{view:"text",type:"password",name:"password2",id:"password2",required:!0,label:"Repita nueva Contraseña",labelPosition:"top"},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){i=this.gup("clienteId"),n=this.gup("comercialId"),l.a.getVersion().then((function(e){$$("version").data.label="VRS "+e.version,$$("version").refresh()})).catch((function(e){c.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){if($$("frmRestablecer").validate()){var e=$$("frmRestablecer").getValues(),t={loginWeb:e.login1,passWeb:e.password1};""!=i&&r.a.putClienteLogin(i,t).then((function(e){e&&1==e.affectedRows&&webix.alert({title:"INFORMATION",text:"Los cambios se han efectuado con exito. Puede ahora ingresar en la aplicación con el nuevo usuario y contraseña"}).then((function(e){})).fail((function(e){c.a.errorMessage(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)})),""!=n&&s.a.putComercialLogin(n,t).then((function(e){e&&1==e.affectedRows&&webix.alert({title:"INFORMATION",text:"Los cambios se han efectuado con exito. Puede ahora ingresar en la aplicación con el nuevo usuario y contraseña"}).then((function(e){})).fail((function(e){c.a.errorMessage(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.gup=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return t?t[1]:t?void 0:""},t}(a.c);t.default=d},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(1),r=o(4),s=o(8),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p,d,f=!1,h=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-transcribe",width:37,align:"left"},{view:"label",label:"Avisos"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("serviciosGrid"),{filename:"avisos",name:"Servicios",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ServiciosNReg",label:"NREG: "}]},{view:"datatable",id:"serviciosGrid",autoWidth:!0,select:"row",scheme:{$change:function(e){$$("serviciosGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"servicioId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"parteId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"fechaEntrada",header:[{text:"Fecha solicitud",css:{"text-align":"center"}},{content:"textFilter"}],sort:"date",adjust:"data",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"nombreCliente",header:["Nombre Cliente",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"tipoProfesionNombre",header:["Profesion",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estadoParteNombre",header:["Estado",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-eye'></span>",css:{"text-align":"center"},width:100}],onClick:{onDelete:function(e,t,o){var i=this.data.pull[t.row].nombre;this.$scope.delete(t.row,i)},onEdit:function(e,t,o){var i=$$("serviciosGrid").getItem(t.row);this.$scope.edit(t.row,i.parteId)}},editable:!0,editaction:"dblclick",rules:{direccionTrabajo:webix.rules.isNotEmpty},on:{onAfterEditStart:function(e){p=e.row,d=this.data.pull[p]},onAfterEditStop:function(e,t,o){var i=this,n=this.getColumnIndex(t.column),r=this.config.columns.length;if(f&&n!=r-2)return!1;if(e.value!=e.old)if(f=!1,this.validate(p)){delete(d=this.data.pull[p]).id;var c=d;delete c.fechaEntrada,0==c.servicioId?s.a.postServicio(c).then((function(e){i.$scope.load(e.servicioId),$$("serviciosGrid").editStop()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)})):s.a.putServicio(c).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))}else a.a.errorMessage("Valores incorrectos")},onAfterFilter:function(){webix.storage.local.put("stateGridServicios",this.getState())}}}]}},t.prototype.init=function(e,t){this.$$("serviciosGrid").attachEvent("onItemDblClick",(function(e,t,o){var i=$$("serviciosGrid").getItem(e.row);this.$scope.edit(e.row,i.parteId)}))},t.prototype.urlChange=function(e,t){var o=n.a.checkLoggedUser(),i=!1,a=o.comercialId,r=o.tipoComercialId;o.esCliente&&(i=!0,a=o.clienteId,r=0),c.languageService.setLanguage(this.app,"es");var s=null;t[0].params.servicioId&&(s=t[0].params.servicioId),webix.UIManager.addHotKey("Esc",(function(){return $$("serviciosGrid").remove(-1),!1}),$$("serviciosGrid")),webix.extend($$("serviciosGrid"),webix.ProgressBar),this.load(s,a,i,r)},t.prototype.load=function(e,t,o,i){var n=this;webix.extend($$("serviciosGrid"),webix.ProgressBar),$$("serviciosGrid").showProgress({type:"bottom",delay:8e3,hide:!0}),s.a.getServiciosPartes(t,o,i).then((function(t){t=s.a.prepareData(t),$$("serviciosGrid").clearAll(),$$("serviciosGrid").parse(r.a.prepareDataForDataTable("servicioId",t)),e&&($$("serviciosGrid").select(e),$$("serviciosGrid").showItem(e));var o=$$("serviciosGrid").count();$$("ServiciosNReg").config.label="NREG: "+o,$$("ServiciosNReg").refresh();var i=webix.storage.local.get("stateGridServicios");i&&n.$$("serviciosGrid").setState(i)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.edit=function(e,t){this.show("/top/serviciosForm?servicioId="+e+"&parteId="+t)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,i=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&s.a.deleteServicio(e).then((function(e){i.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))}})},t.prototype.cleanAndload=function(){$$("serviciosGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}}));var e=n.a.checkLoggedUser(),t=!1,o=e.comercialId,i=e.tipoComercialId;e.esCliente&&(t=!0,o=e.clienteId,i=0),this.load(null,o,t,i)},t}(i.c);t.default=h},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(8),r=o(1),s=o(5);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u,p=0,d=0,f=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"layout",id:"serviciosForm",autoheight:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-transcribe",width:37,align:"left"},{view:"label",label:"Avisos"}]},{view:"form",scroll:"y",id:"frmServicios",elements:[{cols:[{cols:[{rows:[{view:"text",id:"nombreCliente",name:"nombreCliente",disabled:!0,label:"Cliente",labelPosition:"top",minWidth:50},{view:"datepicker",id:"fechaCierre",name:"fechaCierre",minWidth:50,disabled:!0,label:"Fecha de cierre",labelPosition:"top"},{view:"text",id:"tipoProfesionNombre",name:"tipoProfesionNombre",disabled:!0,label:"Profesión ",labelPosition:"top",minWidth:50},{view:"text",id:"estadoParteNombre",name:"estadoParteNombre",disabled:!0,label:"Estado",labelPosition:"top",minWidth:50},{view:"textarea",id:"descripcionAveria",name:"descripcionAveria",disabled:!0,label:"Descripción de la avería",labelPosition:"top",minHeight:100},{view:"textarea",id:"notasWeb",name:"notasWeb",disabled:!0,label:"Notas",labelPosition:"top",minHeight:100}]}]},{cols:[{id:"image",scroll:"y",data:{src:""},template:function(e){return"<img src="+e.src+' style="width:100%;" alt=" Enlace incorrecto, no se puede cargar" onerror="this.style.display="none">'}}]}]},{cols:[{minwidth:600},{rows:[{padding:20,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form"}]}]}]}]}]}},t.prototype.init=function(e,t){u=n.a.checkLoggedUser(),u.usuarioId,s.languageService.setLanguage(this.app,"es")},t.prototype.urlChange=function(e,t){u=n.a.checkLoggedUser(),u.usuarioId,s.languageService.setLanguage(this.app,"es"),t[0].params.servicioId&&(p=t[0].params.servicioId),t[0].params.parteId&&(d=t[0].params.parteId),p&&d&&this.load(p,d)},t.prototype.load=function(e,t){a.a.getServicioParte(e,t).then((function(e){e.fechaEntrada=new Date(e.fechaEntrada),e.fechaCierre&&(e.fechaCierre=new Date(e.fechaCierre)),$$("frmServicios").setValues(e),e.imagen&&""!=e.imagen?($$("image").show(),$$("image").setValues({src:e.imagen})):$$("image").hide()})).catch((function(e){r.a.errorMessageAjax(e)}))},t.prototype.accept=function(){this.$scope.show("/top/servicios?servicioId="+p)},t}(i.c);t.default=f},function(e,t,o){"use strict";o.r(t),t.default={template:"Start page",css:"webix_shadow_medium app_start"}},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(2),a=o(1),r=o(4),s=o(13),c=o(5);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-format-list-numbers",width:37,align:"left"},{view:"label",label:"Tarifas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("tarifasGrid"),{filename:"avisos",name:"Tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "}]},{view:"datatable",id:"tarifasGrid",autoWidth:!0,select:"row",scheme:{$change:function(e){$$("tarifasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"tarifaClienteId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"tipoProfesionalId",header:["Id",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"tipoProfesionalNombre",header:["Profesion",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"nombre",header:["Nombre Tarifa",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit mdi mdi-eye'></span>",css:{"text-align":"center"},width:100}],onClick:{onEdit:function(e,t,o){var i=$$("tarifasGrid").getItem(t.row);this.$scope.edit(t.row,i.tarifaClienteId)}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterFilter:function(){webix.storage.local.put("stateGridTarifas",this.getState())}}}]}},t.prototype.init=function(e,t){this.$$("tarifasGrid").attachEvent("onItemDblClick",(function(e,t,o){var i=$$("tarifasGrid").getItem(e.row);this.$scope.edit(e.row,i.tarifaClienteId)}))},t.prototype.urlChange=function(e,t){var o=n.a.checkLoggedUser(),i=!1,a=o.comercialId;o.esCliente&&(i=!0,a=o.clienteId),c.languageService.setLanguage(this.app,"es");var r=null;t[0].params.tarifaClienteId&&(r=t[0].params.tarifaClienteId),webix.UIManager.addHotKey("Esc",(function(){return $$("tarifasGrid").remove(-1),!1}),$$("tarifasGrid")),webix.extend($$("tarifasGrid"),webix.ProgressBar),this.load(r,a,i)},t.prototype.load=function(e,t,o){var i=this;webix.extend($$("tarifasGrid"),webix.ProgressBar),$$("tarifasGrid").showProgress({type:"bottom",delay:8e3,hide:!0}),s.a.getTarifaProfesiones(t,o).then((function(t){$$("tarifasGrid").clearAll(),$$("tarifasGrid").parse(r.a.prepareDataForDataTable("tipoProfesionalId",t)),e&&($$("tarifasGrid").select(e),$$("tarifasGrid").showItem(e));var o=$$("tarifasGrid").count();$$("TarifasNReg").config.label="NREG: "+o,$$("TarifasNReg").refresh();var n=webix.storage.local.get("stateGridTarifas");n&&i.$$("tarifasGrid").setState(n)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.edit=function(e,t){this.show("/top/lineasTarifaProfesion?tarifaClienteId="+t+"&tipoProfesionalId="+e)},t.prototype.cleanAndload=function(){$$("tarifasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}}));var e=n.a.checkLoggedUser(),t=!1,o=e.comercialId;e.esCliente&&(t=!0,o=e.clienteId),this.load(null,o,t)},t}(i.c);t.default=p},function(e,t,o){"use strict";o.r(t);var i=o(3),n=o(16),a=o(17),r=o(18);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{type:"view",rows:[a.default,{cols:[n.default,{view:"resizer",id:"resizer"},{$subview:!0}]},r.default]}},t.prototype.init=function(){},t}(i.c);t.default=l},function(e,t){},function(e,t,o){"use strict";o.r(t),t.default={Inicio:"Inicio","Nombre usuario":"Nombre usuario","Administración":"Administración",Salir:"Salir","Facturación":"Facturación",Facturas:"Facturas","Refrescar la lista (Ctrl+R)":"Refrescar la lista (Ctrl+R)","Descargar como Excel":"Descargar como Excel",Fecha:"Fecha","IMPRESIÓN DE ENTREGAS":"IMPRESIÓN DE ENTREGAS","IMPRESIÓN DE FACTURAS":"IMPRESIÓN DE FACTURAS",Servicios:"Servicios",Reparaciones:"Reparaciones",Tarifas:"Tarifas",Partes:"Partes","Lineas del parte":"Lineas del parte","Nuevo registro en formulario (Ctrl+A)":"Nuevo registro en formulario (Ctrl+A)",Id:"Id",Codigo:"Codigo",Descripcion:"Descripcion",Comentarios:"Comentarios","Uds.":"Uds.","%IVA Cli.":"%IVA Cli.","€/Ud. Cli.":"€/Ud. Cli.","Imp cli.":"Imp cli.","Imp. cli.IVA":"Imp. cli.IVA","%IVA Pro.":"%IVA Pro.","€/Ud. Pro.":"€/Ud. Pro.","Imp pro.":"Imp pro.","Imp. pro.IVA":"Imp. pro.IVA",Resultado:"Resultado","Ocultar/Mostrar aviso asociado":"Ocultar/Mostrar aviso asociado","Fecha sol.":"Fecha sol.","Fech.prev.":"Fech.prev.","Fech.Rep.":"Fech.Rep.","Fech.cobro":"Fech.cobro","Fech.pago":"Fech.pago"}},function(e,t,o){"use strict";o.r(t),t.default={"Ancient Dashboard":"Ancient Dashboard"}},function(e,t,o){"use strict";o.r(t);var i,n,a,r,s,c,l,u,p,d,f,h=o(3),m=o(2),b=o(0),g=function(e,t){return new webix.promise((function(o,i){b.a.getConfig().then((function(o){var i=o.urlApi+"/api/partes/estado/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},v=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/partes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},w=function(e,t){return new webix.promise((function(o,i){b.a.getConfig().then((function(o){var i=o.urlApi+"/api/partes/nuevo/numero/parte/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},$=function(e){return e.forEach((function(e){e.fecha_solicitud&&(e.fecha_solicitud=new Date(e.fecha_solicitud)),e.fecha_prevista&&(e.fecha_prevista=new Date(e.fecha_prevista)),e.fecha_reparacion&&(e.fecha_reparacion=new Date(e.fecha_reparacion)),e.fecha_factura_cliente&&(e.fecha_factura_cliente=new Date(e.fecha_factura_cliente)),e.fecha_cobro_cliente&&(e.fecha_cobro_cliente=new Date(e.fecha_cobro_cliente)),e.fecha_factura_profesional&&(e.fecha_factura_profesional=new Date(e.fecha_factura_profesional)),e.fecha_pago_profesional&&(e.fecha_pago_profesional=new Date(e.fecha_pago_profesional))})),e},y=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/partes/lineas/del/parte/servicio/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},x=function(e,t,o){return new webix.promise((function(i,n){b.a.getConfig().then((function(i){var n=i.urlApi+"/api/partes/linea/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n)})).then((function(e){i(e.json())})).catch((function(e){n(e)}))}))},P=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_parte";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},C=o(1),j=o(4),_=o(20),I=function(e,t){return new webix.promise((function(o,i){b.a.getConfig().then((function(o){var i=o.urlApi+"/api/proveedores/tipo/proveedor/por/tipo/null/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},A=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/proveedores/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},E=function(e,t,o){return new webix.promise((function(i,n){b.a.getConfig().then((function(i){var n=i.urlApi+"/api/proveedores/tipo/proveedor/por/tipo/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){i(e.json())})).catch((function(e){n(e)}))}))},T=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_parte_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},V=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_presupuesto";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},F=function(){return new webix.promise((function(e,t){b.a.getConfig().then((function(e){var t=e.urlApi+"/api/rechazos_presupuesto";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},S=o(7),R=o(10),k=!1,O={getGrid:function(e){var t=e.getService("locale")._;return"<span class='onDelete webix_icon wxi-trash'></span>",{view:"layout",id:"lineasDelParte",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Lineas del parte")}]},{cols:[{view:"button",id:"btnNew3",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){if(a)if(""!=$$("cmbProveedores").getValue())$$("cmbProveedores").getValue(),$$("cliId").getValue();else C.a.errorMessage(t("Tiene que asignar un profesional al parte"));else C.a.errorMessage(t("Debe dar de alta el parte antes las lineas"))}},{view:"label",id:"partesLineasNReg",label:"NREG: "},{view:"pager",id:"mypager3",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"LineasParteGrid",pager:"mypager3",select:"row",autoheight:!0,footer:!0,ready:function(){$$("LineasParteGrid").attachEvent("onItemDblClick",(function(e,t,o){this.data.pull[e.row],$$("cmbProveedores").getValue(),$$("cliId").getValue()}))},columns:[{id:"parteLineaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"codigoArticulo",header:[t("Codigo"),{content:"textFilter"}],sort:"string",width:80},{id:"descripcion",header:[t("Descripcion"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"comentarios",header:[t("Comentarios"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"unidades",header:[t("Uds."),{content:"textFilter"}],sort:"string",width:40},{id:"ivaCliente",header:[t("%IVA Cli."),{content:"textFilter"}],sort:"string",width:50},{id:"precioCliente",header:[t("€/Ud. Cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"importeCliente",header:[t("Imp cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"importeClienteIva",header:[t("Imp. cli.IVA"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"ivaProveedor",header:[t("%IVA Pro."),{content:"textFilter"}],sort:"string",width:50},{id:"precioProveedor",header:[t("€/Ud. Pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"importeProveedor",header:[t("Imp pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,footer:{content:"summColumn"}},{id:"importeProveedorIva",header:[t("Imp. pro.IVA"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat,footer:{content:"summColumn"}}],rightSplit:1,onClick:{onDelete:function(t,o,i){o=o.row;var n=this.data.pull[o],a=n.codigoArticulo,r=n.facproveLineaId,s=n.facproveId,c=n.facturaLineaId,l=n.facturaId;O.delete(o,a,e,r,s,c,l)},onEdit:function(e,t,o){this.data.pull[t.row],$$("cmbProveedores").getValue(),$$("cliId").getValue()}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){i=e.row,n=this.data.pull[i]},onAfterEditStop:function(e,t,o){var a=this.getColumnIndex(t.column),r=this.config.columns.length;if(k&&a!=r-2)return!1;(e.value!=e.old||k)&&(k=!1,this.validate(i)?(delete(n=this.data.pull[i]).id,n.parteLineaId):C.a.errorMessage("Valores incorrectos"))},onAfterFilter:function(){var e=$$("LineasParteGrid").count();$$("partesLineasNReg").config.label="NREG: "+e,$$("partesLineasNReg").refresh()}}}]}},loadGrid:function(e,t){r=t,s=0,(a=e)?y(a).then((function(e){if(e.length>0){s=e.length,X.estableceNumLineas(s),$$("LineasParteGrid").clearAll(),$$("LineasParteGrid").parse(j.a.prepareDataForDataTable("parteLineaId",e));var t=$$("LineasParteGrid").count();$$("partesLineasNReg").config.label="NREG: "+t,$$("partesLineasNReg").refresh()}else $$("LineasParteGrid").clearAll(),X.estableceNumLineas(s)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)})):$$("LineasParteGrid").clearAll()},delete:function(e,t,o,i,n,s,c){var l={},u={},p=o.getService("locale")._;(i||s)&&(t+=". Este parte tiene facturas asocidas. La linea que borre tembién será eliminada de la facturas en la que se encuentre."),webix.confirm({title:p("AVISO"),text:p("Está seguro que desea eliminar la linea con codigo articulo *").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&x(e,a,r).then((function(e){i&&(l={facproveId:n,facproveLineaId:i},R.a.deleteLineaFacprove(i,l).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))),s&&(u={facturaId:c,facturaLineaId:s},R.a.deleteLineaFactura(s,u).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))),console.log($$("cmbEstadosParteProfesional").getValue()),O.loadGrid(a,r),$$("importeCli").setValue(e.importe_cliente),$$("importeCliIva").setValue(e.importe_cliente_iva),$$("importePro").setValue(e.importe_profesional),$$("importeProIva").setValue(e.importe_profesional_iva),$$("aCuentaProfesional").setValue(e.aCuentaProfesional)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},estableceContado:function(e){setTimeout((function(){var t=0;if(e){for(var o=0;o<e.length;o++)t+=e[o].aCuentaProveedor;$$("aCuentaProfesional").setValue(t)}else $$("aCuentaProfesional").setValue(t)}),300)}},N=o(6),D=o(14),L=o(9),M=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},G=function(e){return new webix.promise((function(t,o){b.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/no-aceptadas/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},U=function(e,t){return new webix.promise((function(o,i){b.a.getConfig().then((function(o){var i=o.urlApi+"/api/ofertas/lineas/"+e+"/"+!0+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},z=!1,q=0,W=0,B=null,J=null,H=0,K=0,Y=0,Z=[{id:"6 meses",value:"6 meses"},{id:"sin garantía",value:"sin garantía"}],Q=0,X={getWindow:function(e){var t=O.getGrid(e);if(!z){c=e.getService("locale")._;webix.ui({view:"suggest",data:Z});var o={view:"tabview",cells:[{header:"Parte",body:{view:"layout",id:"partesForm",rows:[{view:"form",scroll:"y",autoheight:!0,id:"frmPartes",elements:[{view:"fieldset",label:"AVISO ASOCIADO",id:"avisoAsociado",body:{rows:[{cols:[{view:"text",id:"numServicio2",name:"numServicio",disabled:!0,label:"Numero",labelPosition:"top",width:80},{minWidth:650},{view:"text",id:"usuServicioNombre",name:"usuServicioNombre",label:"Operador",labelPosition:"top",width:180,disabled:!0}]},{cols:[{view:"text",id:"comercialNombre",name:"comercialNombre",label:"Agente",labelPosition:"top",disabled:!0},{view:"text",id:"cliId",name:"clienteId",label:"ClienteId",labelPosition:"top",width:100,disabled:!0,hidden:!0},{view:"text",id:"operadorAgente2",name:"operadorAgente",label:"Solicitado Por",labelPosition:"top",width:100,disabled:!0},{view:"datepicker",id:"fechaEntrada2",name:"fechaEntrada",label:"Fec. solicitud",labelPosition:"top",disabled:!0,width:180},{view:"text",id:"hora2",name:"horaEntrada",label:"Hora",labelPosition:"top",disabled:!0,width:80,format:webix.i18n.timeFormatSt,pattern:"##:##"},{view:"text",id:"proId2",name:"proId",label:"Cliente",labelPosition:"top",width:100,disabled:!0},{view:"text",id:"cliNombre",name:"cliNombre",label:"Nombre cliente",labelPosition:"top",width:340,disabled:!0}]},{cols:[{view:"text",id:"direccionTrabajoBis",name:"direccionTrabajo",width:320,label:"Direccion de trabajo",labelPosition:"top",disabled:!0},{view:"text",id:"tipoProNom",name:"tipoProNom",width:200,label:"Profesión",labelPosition:"top",disabled:!0},{view:"text",id:"nomEmpre",name:"nomEmpre",label:"Empresa",labelPosition:"top",disabled:!0},{view:"label",label:"Urgente",width:150},{view:"checkbox",id:"urgente2",name:"urgente",width:50,disabled:!0},{view:"label",label:"Presupuesto",width:100},{view:"checkbox",id:"presupuesto2",name:"necesitaPresupuesto",width:50,disabled:!0}]}]}},{view:"fieldset",label:"DATOS",id:"fieldSetDatos",body:{rows:[{cols:[{view:"text",id:"facturaId",name:"facturaId",label:"facturaId",labelPosition:"top",width:50,hidden:!0},{view:"text",id:"facproveId",name:"facproveId",label:"facproId",labelPosition:"top",width:50,hidden:!0},{view:"text",id:"parteId",name:"parteId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{minWidth:600},{view:"combo",id:"cmbEmpresas2",name:"empresaParteId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:300}]},{cols:[{view:"datepicker",id:"fechaSolicitud",name:"fecha_solicitud",width:150,label:"Fecha solicitud",labelPosition:"top"},{view:"text",id:"numParte",name:"numParte",label:"Numero de parte",labelPosition:"top",width:150},{view:"combo",id:"cmbUsuarios2",name:"operadorId",required:!0,options:{},label:"Operador",labelPosition:"top"},{view:"combo",id:"cmbTipoProfesionales",name:"tipoProfesionalId",options:{},label:"Tipo profesional",labelPosition:"top"},{view:"combo",id:"cmbProveedores",name:"proveedorId",label:"Profesional",labelPosition:"top",options:{filter:function(e,t){var o=e.id;return-1!==e.value.toLowerCase().indexOf(t)||o==t}}}]},{cols:[{view:"datepicker",id:"fechaPrevista",name:"fecha_prevista",label:"Fecha prevista",labelPosition:"top",width:250,required:!0},{view:"datepicker",id:"fechaReparacion",name:"fecha_reparacion",label:"Fecha reparacion",labelPosition:"top",width:250},{view:"combo",id:"cmbEstadosParteProfesional",name:"estadoParteProfesionalId",options:{},label:"Estado del parte Profesional",labelPosition:"top"},{view:"combo",id:"cmbEstadosParte3",name:"estadoParteId",required:!0,options:{},label:"Estado del parte cliente",labelPosition:"top"}]},{cols:[{view:"combo",id:"garantiaTrabajos",name:"garantia_trabajos",stringResult:!0,label:"Garantia de los trabajos",labelPosition:"top",options:Z,on:{onTimedKeyPress:function(){d=this.getText()},onBlur:function(){if(d){var e={id:d,value:d};Z.push(e);var t=$$("garantiaTrabajos").getPopup().getList();t.clearAll(),t.parse(Z),$$("garantiaTrabajos").setValue(d),$$("garantiaTrabajos").refresh(),d=null}}}},{view:"datepicker",id:"fechaCierreProfesional",name:"fecha_cierre_profesional",label:"Fecha cierre Profesional",labelPosition:"top",width:360},{view:"datepicker",id:"fechaCierreCliente",name:"fecha_cierre_cliente",label:"Fecha cierre cliente",labelPosition:"top",width:360}]}]}},{view:"fieldset",label:"PRESUPUESTO",id:"fieldSetPresupuesto",body:{cols:[{width:50},{view:"label",label:"Presupuesto",width:100},{view:"checkbox",id:"presupuesto",name:"presupuesto",width:50},{view:"text",id:"refPresupuesto",name:"refPresupuesto",label:"Referencia",labelPosition:"top",width:110,css:"myclass",hidden:!0},{view:"combo",id:"cmbRefPresupuestoOferta",name:"ofertaId",options:{},label:"Referencia",labelPosition:"top"},{view:"combo",id:"cmbEstadosPresupuesto",name:"estadoPresupuesto",options:{},label:"Estado del presupuesto",labelPosition:"top"},{view:"combo",id:"cmbRechazosPresupuesto",name:"rechazoPresupuestoId",options:{},label:"Causa rechazo presupuesto",labelPosition:"top",value:0},{view:"text",id:"descuentoGeneral",name:"descuentoGeneral",label:"Dto.general %",labelPosition:"top",value:0,format:"1,00",width:100,click:function(e,t){$$(e).setValue("")}},{view:"text",id:"rappel",name:"rappel",label:"Rappel %",labelPosition:"top",value:0,format:"1,00",width:100,click:function(e,t){$$(e).setValue("")}}]}},{rows:[{cols:[{view:"textarea",id:"descripcionAveria2",name:"descripcion_averia",required:!0,label:"Descripción de la avería",labelPosition:"top",height:70},{view:"textarea",id:"trabajosRealizados",name:"trabajos_realizados",label:"Notas Web",labelPosition:"top",height:70},{rows:[{padding:20,cols:[{view:"button",label:"Aceptar",click:X.cancel,hotkey:"esc"}]}]}]},{view:"textarea",id:"observacion",name:"observaciones",label:"Observaciones",labelPosition:"top",height:170}]},{cols:[{view:"fieldset",label:"CLIENTE",id:"fieldSetCliente",body:{rows:[{cols:[{view:"datepicker",id:"fechaFactCli",name:"fecha_factura_cliente",label:"Fech. fact.",labelPosition:"top",disabled:!0},{view:"text",id:"numeroFactCli",name:"numero_factura_cliente",label:"Nº fact.",labelPosition:"top",disabled:!0},{view:"datepicker",id:"fechaCoCli",name:"fecha_cobro_cliente",label:"Cobro",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"importeCli",name:"importe_cliente",disabled:!0,label:"Importe",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"importeCliIva",name:"importe_cliente_iva",disabled:!0,label:"Importe con iva",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"combo",id:"cmbFormasPagoCli",name:"formaPagoClienteId",options:{},label:"Forma pago",labelPosition:"top"},{view:"label",label:"Facturar Por separado",width:150},{view:"checkbox",id:"FactPropiaCli",name:"FactPropiaCli",width:50}]}]}},{view:"fieldset",label:"PROFESIONAL",id:"fieldSetProfesional",body:{rows:[{cols:[{view:"datepicker",id:"fecFactPro",name:"fecFactPro",label:"Fech. fact.",labelPosition:"top",disabled:!0},{view:"text",id:"numeroFactPro",name:"numFactPro",label:"Nº fact.",labelPosition:"top",disabled:!0},{view:"datepicker",id:"fechaCoPro",name:"fecha_pago_profesional",label:"Pago",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"importePro",name:"importe_profesional",disabled:!0,label:"Importe",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"importeProIva",name:"importe_profesional_iva",disabled:!0,label:"Importe con iva",labelPosition:"top",value:0,format:"1,00",click:function(e,t){$$(e).setValue("")}},{view:"text",id:"aCuentaProfesional",name:"aCuentaProfesional",disabled:!0,label:"Contado",labelPosition:"top",value:0,format:"1,00"},{view:"combo",id:"cmbFormasPagoPro",name:"formaPagoProfesionalId",options:{},label:"Forma pago",labelPosition:"top"},{view:"label",label:"Facturar Por separado",width:150},{view:"checkbox",id:"FactPropiaPro",name:"FactPropiaPro",width:50}]}]}}]},{rows:[{cols:[{view:"text",id:"resultado",name:"resultado",label:c("Resultado"),labelPosition:"top",value:0,format:"1,00",width:100,disabled:!0,hidden:!0},{},{}]}]}]}]}},{header:"Lineas",body:{rows:[t]}}]};webix.ui({view:"window",fullscreen:!0,id:"partesFormWin",position:"center",move:!0,resize:!0,head:{view:"toolbar",cols:[{view:"icon",icon:"mdi mdi mdi-file",width:37,align:"left"},{view:"label",label:"Partes"},{view:"toggle",type:"icon",id:"ocultar",maxWidth:50,icon:"mdi mdi-arrow-down-bold-circle-outline",tooltip:c("Ocultar/Mostrar aviso asociado")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("partesFormWin").hide()}}]},modal:!0,body:o}),z=!0,$$("frmPartes").elements.rappel.attachEvent("onKeyPress",(function(e,t){f="",f+=$$("rappel").getText()})),$$("frmPartes").elements.rappel.attachEvent("onBlur",(function(e,t){f=f.replace(".",","),$$("rappel").setValue(f)})),$$("frmPartes").elements.descuentoGeneral.attachEvent("onKeyPress",(function(e,t){f="",f+=$$("descuentoGeneral").getText()})),$$("frmPartes").elements.descuentoGeneral.attachEvent("onBlur",(function(e,t){f=f.replace(".",","),$$("descuentoGeneral").setValue(f)})),$$("importeCli").attachEvent("onChange",(function(e,t){var o=e-$$("importePro").getValue();$$("resultado").setValue(o)})),$$("importePro").attachEvent("onChange",(function(e,t){var o=$$("importeCli").getValue()-e;$$("resultado").setValue(o)})),$$("cmbProveedores").attachEvent("onChange",(function(e,t){var o=$$("cmbEstadosParte3").getValue();J=e,1==o&&$$("cmbEstadosParte3").setValue(2),""!=J&&null!=J&&X.recuperaFormaPagoPro(J)})),$$("cmbFormasPagoCli").attachEvent("onChange",(function(e,t){t&&!0})),$$("cmbFormasPagoPro").attachEvent("onChange",(function(e,t){t&&!0})),$$("cmbTipoProfesionales").attachEvent("onChange",(function(e,t){""!=e&&(B=e,X.loadProveedores(J,B))})),$$("ocultar").attachEvent("onItemClick",(function(e,t){++K%2>0?$$("avisoAsociado").hide():$$("avisoAsociado").show()})),$$("cmbEstadosParteProfesional").attachEvent("onChange",(function(e,t){if(""!=e){var o=e,i=t;if(2==o&&0==Q)return C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),void $$("cmbEstadosParteProfesional").setValue(i);2==o?$$("fechaCierreProfesional").setValue($$("fechaPrevista").getValue()):$$("fechaCierreProfesional").setValue(null)}})),$$("cmbEstadosParte3").attachEvent("onChange",(function(e,t){if(""!=e){var o=e,i=t;if(5==o&&0==Q)return C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),void $$("cmbEstadosParte3").setValue(i);5==o?$$("fechaCierreCliente").setValue($$("fechaPrevista").getValue()):$$("fechaCierreCliente").setValue(null)}})),$$("cmbEstadosPresupuesto").attachEvent("onChange",(function(e,t){var o=$$("cmbRefPresupuestoOferta").getValue();isNaN(parseInt(o))||(""!=e&&3==e&&0==Q&&X.aceptarOferta(),""!=e&&3==e&&Q>0&&X.avisoNumLineas())})),$$("presupuesto").attachEvent("onChange",(function(e,t){if(""!==e){var o=e,i=$$("cmbRefPresupuestoOferta").getValue(),n=$$("cmbEstadosPresupuesto").getValue();console.log(o,isNaN(parseInt(i)),isNaN(parseInt(n))),0==o&&(isNaN(parseInt(i))||isNaN(parseInt(n))||X.desvinculaOferta(i))}}))}},loadWindow:function(e,t,o,i,n,a,r,s){if($$("avisoAsociado").disable(),$$("fieldSetDatos").disable(),$$("fieldSetPresupuesto").disable(),$$("fieldSetCliente").disable(),$$("fieldSetProfesional").disable(),null,$$("frmPartes")&&$$("frmPartes").clear(),Y=i,H=o,q=t,W=e,n,u=r,p=s,$$("partesFormWin")&&$$("partesFormWin").show(),l=m.a.checkLoggedUser(),q)$$("cmbProveedores").blockEvent(),$$("presupuesto").blockEvent(),$$("cmbEstadosParteProfesional").blockEvent(),$$("cmbEstadosParte3").blockEvent(),$$("cmbEstadosPresupuesto").blockEvent(),$$("frmPartes").clear(),O.loadGrid(q,W),v(q).then((function(e){J=e.proveedorId,u=e.empresaId,e.fecha_solicitud=new Date(e.fecha_solicitud),e.fechaEntrada&&(e.fechaEntrada=new Date(e.fechaEntrada)),e.fecha_prevista&&(e.fecha_prevista=new Date(e.fecha_prevista)),e.fecha_reparacion&&(e.fecha_reparacion=new Date(e.fecha_reparacion)),e.fecha_factura_cliente&&(e.fecha_factura_cliente=new Date(e.fecha_factura_cliente)),e.fecha_cobro_cliente&&(e.fecha_cobro_cliente=new Date(e.fecha_cobro_cliente)),e.fecFactPro&&(e.fecFactPro=new Date(e.fecFactPro)),e.fecha_pago_profesional&&(e.fecha_pago_profesional=new Date(e.fecha_pago_profesional)),e.fecha_cierre_cliente&&(e.fecha_cierre_cliente=new Date(e.fecha_cierre_cliente)),e.fecha_cierre_profesional&&(e.fecha_cierre_profesional=new Date(e.fecha_cierre_profesional)),X.loadNuevaGarantiaTrabajos(e.garantia_trabajos),$$("frmPartes").setValues(e),X.loadUsuarios(e.operadorId),X.loadTiposProfesionales(e.tipoProfesionalId),X.loadEstadosParte(e.estadoParteId),X.loadEstadosParteProfesional(e.estadoParteProfesionalId),X.loadEstadosPresupuesto(e.estadoPresupuesto),X.loadRechazosPresupuesto(e.rechazoPresupuestoId),X.loadFormasPagoCli(e.formaPagoClienteId),X.loadFormasPagoPro(e.formaPagoProfesionalId),X.loadEmpresas(e.empresaParteId),X.loadPresupuestos(e.ofertaId),H?$$("cliId").setValue(Y):$$("cliId").setValue($$("cmbClientes").getValue()),$$("cmbProveedores").unblockEvent(),$$("presupuesto").unblockEvent(),$$("cmbEstadosParteProfesional").unblockEvent(),$$("cmbEstadosParte3").unblockEvent(),$$("cmbEstadosPresupuesto").unblockEvent(),X.recuperaFechaCobroCli(),X.recuperaFechaPagoPro()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}));else{if(!H)return X.activaCampos(),J="",X.cargaInfoServicio(),$$("fechaSolicitud").setValue(new Date),X.loadTiposProfesionales($$("cmbTiposProfesional").data.value),X.loadProveedores(null,$$("cmbTiposProfesional").data.value),X.loadEstadosParte(1),X.loadEstadosParteProfesional(),X.loadEstadosPresupuesto(),X.loadRechazosPresupuesto(),X.loadNuevoNum(W,$$("numServicio").getValue()),X.recuperaFormaPagoCli(),X.loadFormasPagoPro(),X.loadEmpresas(u),$$("garantiaTrabajos").setValue("6 meses"),$$("descuentoGeneral").setValue(0),$$("importeCli").setValue(0),$$("importePro").setValue(0),$$("resultado").setValue(0),$$("importeCliIva").setValue(0),$$("importeProIva").setValue(0),$$("aCuentaProfesional").setValue(0),$$("descripcionAveria2").setValue($$("descripcionAveria").getValue()),$$("necesitaPresupuesto").getValue()?($$("rappel").setValue(0),$$("presupuesto").setValue(1)):X.loadRappelAgente(),X.loadUsuarios(l.usuarioId),void O.loadGrid(null,W);X.activaCampos(),J="",$$("fechaSolicitud").setValue(new Date),X.loadTiposProfesionales(),X.loadProveedores(),X.loadEstadosParte(1),X.loadEstadosParteProfesional(),X.loadEstadosPresupuesto(),X.loadRechazosPresupuesto(),X.loadNuevoNum(W,a.numServicio),X.recuperaFormaPagoCli(),X.loadFormasPagoPro(),X.loadEmpresas(u),$$("garantiaTrabajos").setValue("6 meses"),$$("descuentoGeneral").setValue(0),$$("importeCli").setValue(0),$$("importePro").setValue(0),$$("resultado").setValue(0),$$("importeCliIva").setValue(0),$$("importeProIva").setValue(0),$$("aCuentaProfesional").setValue(0),a.necesitaPresupuesto?($$("rappel").setValue(0),$$("presupuesto").setValue(1)):X.loadRappelAgente(),X.loadUsuarios(l.usuarioId),X.cargaInfoServicioDesdeGeneral(a)}},desactivaCampos:function(){$$("fieldSetDatos").disable(),$$("fieldSetPresupuesto").disable(),$$("fieldSetCliente").disable(),$$("fieldSetProfesional").disable(),$$("trabajosRealizados").disable(),$$("lineasDelParte").disable()},activaCampos:function(){$$("fieldSetDatos").enable(),$$("fieldSetPresupuesto").enable(),$$("fieldSetCliente").enable(),$$("fieldSetProfesional").enable(),$$("trabajosRealizados").enable(),$$("lineasDelParte").enable()},cargaInfoServicio:function(){$$("usuServicioNombre").setValue($$("cmbUsuarios").getText()),$$("comercialNombre").setValue($$("cmbAgentes").getText()),$$("proId2").setValue($$("cmbProId").getText()),$$("cliNombre").setValue($$("cmbClientes").getText()),$$("tipoProNom").setValue($$("cmbTiposProfesional").getText()),$$("operadorAgente2").setValue($$("operadorAgente").getValue()),$$("fechaEntrada2").setValue($$("fechaEntrada").getValue()),$$("hora2").setValue($$("horaEntrada").getValue()),$$("nomEmpre").setValue($$("cmbEmpresas").getText()),$$("direccionTrabajoBis").setValue($$("direccionTrabajo").getValue()),$$("presupuesto2").setValue($$("necesitaPresupuesto").getValue()),$$("urgente2").setValue($$("urgente").getValue()),$$("numServicio2").setValue($$("numServicio").getValue()),u=$$("cmbEmpresas").getValue()},cargaInfoServicioDesdeGeneral:function(e){$$("usuServicioNombre").setValue(e.usuServicioNombre),$$("comercialNombre").setValue(e.comercialNombre),$$("proId2").setValue(e.proId),$$("cliNombre").setValue(e.cliNombre),$$("tipoProNom").setValue(e.tipoProNom),$$("operadorAgente2").setValue(e.operadorAgente),$$("fechaEntrada2").setValue(e.fechaEntrada),$$("hora2").setValue(e.horaEntrada),$$("nomEmpre").setValue(e.nomEmpre),$$("direccionTrabajoBis").setValue(e.direccionTrabajo),$$("presupuesto2").setValue(e.necesitaPresupuesto),$$("urgente2").setValue(e.urgente),$$("numServicio2").setValue(e.numServicio),$$("descripcionAveria2").setValue(e.descripcionAveria)},cancel:function(){$$("partesFormWin").hide()},recuperaFechaCobroCli:function(){var e=$$("numeroFactCli").getValue();e&&""!=e&&R.a.recuperaFechaCobroCli(e,u).then((function(e){e&&$$("fechaCoCli").setValue(e.fecvenci)})).catch((function(e){C.a.errorMessageAjax(e)}))},recuperaFechaPagoPro:function(){var e=$$("numeroFactPro").getValue(),t=$$("fechaFactPro").getValue();t=webix.Date.dateToStr("%Y-%m-%d")(new Date(t)),e&&""!=e&&t&&""!=t&&R.a.recuperaFechaPagoPro(t,e,u).then((function(e){e&&$$("fechaCoCli").setValue(e.fecvenci)})).catch((function(e){C.a.errorMessageAjax(e)}))},recuperaFormaPagoCli:function(){var e=this;N.a.getCliente(Y).then((function(t){e.loadFormasPagoCli(t.formaPagoId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadFormasPagoCli:function(e){D.a.getFormasPago().then((function(t){var o=j.a.prepareDataForCombo("formaPagoId","nombre",t),i=$$("cmbFormasPagoCli").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbFormasPagoCli").setValue(e),$$("cmbFormasPagoCli").refresh()):($$("cmbFormasPagoCli").setValue(null),$$("cmbFormasPagoCli").refresh())})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadNuevaGarantiaTrabajos:function(e){var t=!1;if(""!=e){for(var o=0;o<Z.length;o++)if(Z[o].value==e){t=!0;break}if(!t){var i={id:e,value:e};Z.push(i);var n=$$("garantiaTrabajos").getPopup().getList();n.clearAll(),n.parse(Z),$$("garantiaTrabajos").setValue(e),$$("garantiaTrabajos").refresh()}}},recuperaFormaPagoPro:function(e){var t=this;A(e).then((function(e){t.loadFormasPagoPro(e.formaPagoId),t.loadTiposProfesionales(e.tipoProfesionalId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadFormasPagoPro:function(e){D.a.getFormasPago().then((function(t){var o=j.a.prepareDataForCombo("formaPagoId","nombre",t),i=$$("cmbFormasPagoPro").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbFormasPagoPro").setValue(e),$$("cmbFormasPagoPro").refresh()):($$("cmbFormasPagoPro").setValue(null),$$("cmbFormasPagoPro").refresh())})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadUsuarios:function(e){m.a.getUsuarios().then((function(t){var o=j.a.prepareDataForCombo("usuarioId","nombre",t),i=$$("cmbUsuarios2").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbUsuarios2").setValue(e),$$("cmbUsuarios2").refresh()):($$("cmbUsuarios2").setValue(null),$$("cmbUsuarios2").refresh())}))},loadTiposProfesionales:function(e){_.a.getTiposProfesional().then((function(t){var o=j.a.prepareDataForCombo("tipoProfesionalId","nombre",t),i=$$("cmbTipoProfesionales").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTipoProfesionales").setValue(e),$$("cmbTipoProfesionales").refresh())}))},loadProveedores:function(e,t){var o=new Date($$("fechaSolicitud").getValue());o=webix.Date.dateToStr("%y-%m-%d")(o),t?E(t,7,o).then((function(t){0==t.length&&(e=null);var o=j.a.prepareDataForCombo("proveedorId","nombre",t),i=$$("cmbProveedores").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbProveedores").setValue(e),$$("cmbProveedores").refresh()):($$("cmbProveedores").setValue(null),$$("cmbProveedores").refresh())})):I(7,o).then((function(t){var o=j.a.prepareDataForCombo("proveedorId","nombre",t),i=$$("cmbProveedores").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbProveedores").setValue(e),$$("cmbProveedores").refresh()):($$("cmbProveedores").setValue(null),$$("cmbProveedores").refresh())}))},loadEstadosParte:function(e){P().then((function(t){var o=j.a.prepareDataForCombo("estadoParteId","nombre",t),i=$$("cmbEstadosParte3").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEstadosParte3").setValue(e),$$("cmbEstadosParte3").refresh()):($$("cmbEstadosParte3").setValue(null),$$("cmbEstadosParte3").refresh())}))},loadEstadosParteProfesional:function(e){T().then((function(t){var o=j.a.prepareDataForCombo("estadoParteProfesionalId","nombre",t),i=$$("cmbEstadosParteProfesional").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEstadosParteProfesional").setValue(e),$$("cmbEstadosParteProfesional").refresh()):($$("cmbEstadosParteProfesional").setValue(null),$$("cmbEstadosParteProfesional").refresh())}))},loadEstadosPresupuesto:function(e){V().then((function(t){var o=j.a.prepareDataForCombo("estadoPresupuestoId","nombre",t),i=$$("cmbEstadosPresupuesto").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEstadosPresupuesto").setValue(e),$$("cmbEstadosPresupuesto").refresh()):($$("cmbEstadosPresupuesto").setValue(null),$$("cmbEstadosPresupuesto").refresh())}))},loadRechazosPresupuesto:function(e){F().then((function(t){var o=j.a.prepareDataForCombo("rechazoPresupuestoId","nombre",t),i=$$("cmbRechazosPresupuesto").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbRechazosPresupuesto").setValue(e),$$("cmbRechazosPresupuesto").refresh()):($$("cmbRechazosPresupuesto").setValue(null),$$("cmbRechazosPresupuesto").refresh())}))},loadNuevoNum:function(e,t){w(e,t).then((function(e){$$("numParte").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadPartes:function(e){$$("cmbEstadosParte").setValue(e),g(e).then((function(e){e||(e=[]),e=$(e),$$("partesGrid").clearAll(),$$("partesGrid").parse(j.a.prepareDataForDataTable("parteId",e));var t=$$("partesGrid").count();$$("PartesNReg").config.label="NREG: "+t,$$("PartesNReg").refresh();var o=webix.storage.local.get("stateGridPartes");o&&$$("partesGrid").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadRappelAgente:function(){p||(p=$$("cmbAgentes").getValue()),S.a.getAgente(p).then((function(e){$$("rappel").setValue(e.porComer)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadEmpresas:function(e){L.a.getEmpresas().then((function(t){var o=j.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas2").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbEmpresas2").setValue(e),$$("cmbEmpresas2").refresh())}))},loadPresupuestos:function(e){var t=$$("cmbRefPresupuestoOferta").getValue(),o=$$("cmbEstadosPresupuesto").getValue();isNaN(parseInt(t))||3!=o?G(Y).then((function(t){var o=j.a.prepareDataForCombo("ofertaId","referencia",t),i=$$("cmbRefPresupuestoOferta").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbRefPresupuestoOferta").setValue(e),$$("cmbRefPresupuestoOferta").refresh())})).catch((function(e){C.a.errorMessageAjax(e)})):M(e).then((function(t){var o=[];o.push(t);var i=j.a.prepareDataForCombo("ofertaId","referencia",o),n=$$("cmbRefPresupuestoOferta").getPopup().getList();n.clearAll(),n.parse(i),e&&($$("cmbRefPresupuestoOferta").setValue(e),$$("cmbRefPresupuestoOferta").refresh())})).catch((function(e){C.a.errorMessageAjax(e)}))},loadData:function(e){parametroId=e.parametroId,X.loadArtMan(e.articuloMantenimiento),X.loadArtManGas(e.articuloMantenimientoParaGastos),console.log($$("margen")),$$("margen").setValue(e.margenMantenimiento),$$("margen").refresh(),$$("cuentaReten").setValue(e.cuentaretencion),$$("cuentaReten").refresh()},estableceNumLineas:function(e){Q=e},compruebaEstadoCerrado:function(e,t){2==e&&0==Q&&(C.a.errorMessage("No se puede cerrar, no hay lineas en el parte"),t.setValue(oldEstado))},buscarLineasOferta:function(){var e=$$("cmbRefPresupuestoOferta").getValue(),t=$$("cmbProveedores").getValue();""==t&&(t=null),U(e,t).then((function(e){e.length>0&&X.crearLinesParte(e)})).catch((function(e){C.a.errorMessageAjax(e)}))}},ee=o(5);function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ie,ne=1,ae=[],re=function(e){function t(){return te(this,t),oe(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this;X.getWindow(this.app);var o=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Partes"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("partesGrid"),{filename:"partes",name:"Partes",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"PartesNReg",label:"NREG: "}]},{cols:[{view:"combo",id:"cmbEstadosParte",name:"estadoParteId",options:{},label:"Estado del parte para mostrar",labelPosition:"top"},{width:800}]},((e={view:"datatable",css:{"font-size":"0.9em","font-weight":"bold"},scheme:{$change:function(e){var t=ae.filter((function(t){return t.estadoParteId==e.estadoParteId}));e.$css={"background-color":t[0].colorFondo};var o=new Date;e.fecha_prevista<=o&&5!=e.estadoParteId&&e.fecha_prevista<=o&&6!=e.estadoParteId&&(e.$css={"background-color":"#B12225",color:"#B1B322"})}},id:"partesGrid",scroll:"x,y",select:"row",columns:[{id:"parteId",header:["Id",{content:"textFilter"}],sort:"int",width:50,hidden:!0},{id:"empresa",header:[{text:"Emp.",css:{"text-align":"left"}},{content:"textFilter"}],sort:"string",width:50,css:{"text-align":"left"}},{id:"empresaId",header:["empId",{content:"textFilter"}],sort:"int",width:10,hidden:!0},{id:"aqgenteId",header:["agenId",{content:"textFilter"}],sort:"int",width:10,hidden:!0},{id:"operadonNombre",header:["Operador",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"numParte",header:["Numero",{content:"textFilter"}],sort:"string",width:80},{id:"proveedorNombre",header:["Profesional",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fecha_solicitud",header:[{text:o("Fecha sol."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"fecha_prevista",header:[{text:o("Fech.prev."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"horaEntrada",header:["Hora",{content:"textFilter"}],sort:"string",width:50},{id:"proId",header:["Cliente",{content:"textFilter"}],sort:"string",width:80},{id:"clienteId",header:["ClienteId",{content:"textFilter"}],sort:"string",width:80,hidden:!0},{id:"nombreCliente",header:["Nombre Cliente",{content:"textFilter"}],sort:"string",width:210},{id:"direccionTrabajo",header:["Direc. Trabajo",{content:"textFilter"}],sort:"string",width:200},{id:"refPresupuesto",header:["Ref. presupuesto",{content:"textFilter"}],sort:"string",width:100},{id:"nombreEstado",header:["Estado",{content:"textFilter"}],sort:"string",width:120},{id:"estadoParteId",header:["id estado",{content:"textFilter"}],sort:"string",width:10,hidden:!0},{id:"fecha_reparacion",header:[{text:o("Fech.Rep."),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"numero_factura_cliente",header:["Nº.fact.cli",{content:"textFilter"}],sort:"string"},{id:"importe_cliente",header:["Imp.cli.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat},{id:"fecha_cobro_cliente",header:[{text:o("Fech.cobro"),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"importe_profesional",header:["Imp. prof.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat},{id:"fecha_pago_profesional",header:[{text:o("Fech.pago"),css:{"text-align":"center"}},{content:"dateFilter"}],width:80,sort:"date",format:webix.Date.dateToStr("%d/%m/%Y"),css:{"text-align":"center"}},{id:"numFactPro",header:["Nº.fact.pro",{content:"textFilter"}],sort:"string"},{id:"resultado",header:["Resultado",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:80},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span>",css:{"text-align":"center"},width:65}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];X.loadWindow(i.servicioId,i.parteId,1)}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridPartes",this.getState())}},e)]}},t.prototype.init=function(e,t){var o=m.a.checkLoggedUser();ie=o.comercialId,ne=100;var i=this;this.loadEstadosParte(ne),$$("cmbEstadosParte").attachEvent("onChange",(function(e,t){ne=e,i.load()})),$$("partesGrid").attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];X.loadWindow(i.servicioId,i.parteId,1,i.clienteId,null,null,i.empresaId,i.agenteId)}))},t.prototype.urlChange=function(e,t){var o=m.a.checkLoggedUser();ie=o.comercialId,ne=100,this.loadEstadosParte(ne),m.a.checkLoggedUser(),ee.languageService.setLanguage(this.app,"es"),this.load()},t.prototype.load=function(){var e=this;webix.extend($$("partesGrid"),webix.ProgressBar),$$("partesGrid").showProgress({type:"bottom",delay:8e3,hide:!0}),g(ne,ie).then((function(t){t||(t=[]),t=$(t),t=e.formateaNombreEmpresa(t),$$("partesGrid").clearAll(),$$("partesGrid").parse(j.a.prepareDataForDataTable("parteId",t));var o=$$("partesGrid").count();$$("PartesNReg").config.label="NREG: "+o,$$("PartesNReg").refresh();var i=webix.storage.local.get("stateGridPartes");i&&e.$$("partesGrid").setState(i)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},t.prototype.formateaNombreEmpresa=function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,3),e.horaEntrada=e.horaEntrada.substr(0,5)})),e},t.prototype.loadEstadosParte=function(e){P().then((function(t){ae=t;var o=j.a.prepareDataForCombo("estadoParteId","nombre",t);o.push({id:100,value:"todos"});var i=$$("cmbEstadosParte").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbEstadosParte").setValue(e),$$("cmbEstadosParte").refresh())}))},t.prototype.cleanAndload=function(){$$("partesGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(h.c);t.default=re},function(e,t,o){"use strict";o.r(t);var i,n,a=o(3),r=o(2),s=o(13),c=o(0),l=function(){return new webix.promise((function(e,t){c.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_iva";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},u=o(14),p=o(1),d=o(4),f=o(5),h=function(){return new webix.promise((function(e,t){c.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_via";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},m=o(7),b=o(6),g=o(12),v=o(19);function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y=function(e){function t(){return w(this,t),$(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"layout",id:"creacionClienteForm",rows:[{view:"toolbar",css:"gradient2",padding:3,elements:[{view:"icon",icon:"mdi mdi-account",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Cliente</span>"},{view:"button",id:"aceptar",click:this.accept,css:"bt_1 webix_primary",type:"icon",label:'<i class="mdi mdi-content-save" style="font-size: 20px; margin-right: 25px">Guardar</i>',width:200}]},{view:"form",scroll:"y",id:"frmCliente",css:"colorFondo",elements:[{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-clipboard-account",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Datos</span>"}]},{cols:[{view:"text",id:"nif",name:"nif",width:250,label:"Nif",labelPosition:"top",required:!0,on:{onBlur:function(){""!=this.getValue()&&this.$scope.validateNifCif(this.getValue())}}},{view:"text",id:"nombreCliente",name:"nombre",minwidth:400,label:"Nombre",labelPosition:"top",required:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}},{view:"text",id:"iban",name:"iban",width:200,label:"IBAN",labelPosition:"top",required:!0,on:{onBlur:function(){""!=this.getValue()&&(this.$scope.isValidSpanishIBAN(this.getValue())||(p.a.errorMessage("IBAN incorrecto"),this.setValue("")))}}},{view:"datepicker",id:"fechaAlta",name:"fechaAlta",width:150,label:"Fecha alta",labelPosition:"top",required:!0}]},{cols:[{view:"combo",id:"cmbTarifasCliente",name:"tarifaClienteId",options:{},label:"Tarifa sociada",labelPosition:"top",width:200,disabled:!0,hidden:!0,required:!0},{view:"combo",id:"cmbColaboradores",name:"comercialId",options:{},label:"Colaborador asociado",labelPosition:"top",width:250,disabled:!0,hidden:!0},{view:"combo",id:"cmbFormasPagoCli2",name:"formaPagoId",options:{},label:"Forma pago",labelPosition:"top",width:280,disabled:!0,hidden:!0,required:!0}]},{cols:[{view:"combo",id:"cmbTiposIvaCli",name:"tipoIvaId",options:{},label:"IVA",labelPosition:"top",width:80,disabled:!0,hidden:!0,required:!0},{view:"text",type:"number",value:"400",id:"limiteCredito",name:"limiteCredito",label:"Limite de credito",labelPosition:"top",disabled:!0,hidden:!0,width:120},{view:"combo",id:"cmbTiposCliente",name:"tipoClienteId",options:{},label:"Tipo de cliente",labelPosition:"top",minwidth:100,disabled:!0,hidden:!0,required:!0},{view:"text",id:"emailFacturas",name:"emailFacturas",label:"Email Facturación",labelPosition:"top",disabled:!0,hidden:!0,minwidth:120},{view:"text",id:"codigo",name:"codigo",label:"código contable",labelPosition:"top",disabled:!0,hidden:!0,minwidth:120},{view:"text",id:"cuentaContable",name:"cuentaContable",label:"Cuenta contable",labelPosition:"top",disabled:!0,hidden:!0,minwidth:120}]},{cols:[{view:"text",id:"contacto1",name:"contacto1",label:"Persona de contacto (1)",labelPosition:"top",disabled:!0,hidden:!0},{view:"text",id:"telefono1",name:"telefono1",width:200,label:"Telefono(1)",labelPosition:"top",disabled:!0,hidden:!0},{view:"text",id:"email",name:"email",label:"Correo electrónico(1)",labelPosition:"top",width:230,disabled:!0,hidden:!0}]},{cols:[{view:"text",id:"contacto2",name:"contacto2",label:"Persona de contacto (2)",labelPosition:"top",disabled:!0,hidden:!0},{view:"text",id:"telefono2",name:"telefono2",width:200,disabled:!0,hidden:!0,label:"Telefono(2)",labelPosition:"top"},{view:"text",id:"email2",name:"email2",label:"Correo electrónico(2)",labelPosition:"top",width:230,disabled:!0,hidden:!0}]},{view:"toolbar",css:"gradient3",padding:3,elements:[{view:"icon",icon:"mdi mdi-book-multiple",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Direcciones</span>"}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",hidden:!0,css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-book",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Dirección postal</span>"}]},{cols:[{view:"combo",id:"cmbTiposViaPostal",name:"tipoViaId3",options:{},label:"Tipo vía",labelPosition:"top",width:150,disabled:!0,hidden:!0},{view:"text",id:"direccion3",name:"direccion3",label:"Direccion",labelPosition:"top",disabled:!0,hidden:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]},{cols:[{view:"text",id:"poblacion3",name:"poblacion3",label:"Población",labelPosition:"top",disabled:!0,hidden:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]},{cols:[{view:"text",id:"codPostal3",name:"codPostal3",width:150,label:"cod. Postal",labelPosition:"top",disabled:!0,hidden:!0},{view:"text",id:"provincia3",name:"provincia3",label:"Provincia",labelPosition:"top",disabled:!0,hidden:!0}]}]}]},{rows:[{cols:[{padding:{top:5,bottom:5,left:0,right:0},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-book",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Dirección de trabajo</span>"}]},{cols:[{view:"combo",id:"cmbTiposViaTrabajo",name:"tipoViaId2",options:{},label:"Tipo vía",labelPosition:"top",width:150,required:!0},{view:"text",id:"direccion2",name:"direccion2",label:"Direccion",labelPosition:"top",required:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]},{cols:[{view:"text",id:"poblacion2",name:"poblacion2",label:"Población",labelPosition:"top",required:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())},onBlur:function(){var e=!1,t=$$("cmbTiposViaTrabajo").getText()+" "+$$("direccion2").getValue()+" "+this.getValue()+" "+$$("provincia2").getValue();(new google.maps.Geocoder).geocode({address:t},(function(t,o){if(o==google.maps.GeocoderStatus.OK&&t[0]){for(var i=0;i<t[0].address_components.length;i++){var n=t[0].address_components[i];if("postal_code"==n.types[0]){var a=n.long_name;$$("codPostal2").setValue(a),e=!0;break}}e||(p.a.errorMessage("Código postal no encontrado"),$$("codPostal2").setValue(""))}}))}}}]},{cols:[{view:"text",id:"codPostal2",name:"codPostal2",width:150,label:"cod. Postal",labelPosition:"top",required:!0},{view:"text",value:"MADRID",id:"provincia2",name:"provincia2",required:!0,label:"Provincia",labelPosition:"top",on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]}]},{padding:{top:5,bottom:5,left:0,right:8},rows:[{view:"toolbar",css:"gradient",padding:3,elements:[{view:"icon",icon:"mdi mdi-book",css:"radious",width:37,align:"left"},{view:"label",label:"<span style='color: white'>Dirección fiscal</span>"}]},{cols:[{view:"combo",id:"cmbTiposViaFiscal",name:"tipoViaId",options:{},label:"Tipo vía",labelPosition:"top",width:150,required:!0},{view:"text",id:"direccion",name:"direccion",label:"Direccion",labelPosition:"top",required:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]},{cols:[{view:"text",id:"poblacion",name:"poblacion",label:"Población",labelPosition:"top",required:!0,on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())},onBlur:function(){var e=!1,t=$$("cmbTiposViaFiscal").getText()+" "+$$("direccion").getValue()+" "+this.getValue()+" "+$$("provincia").getValue();(new google.maps.Geocoder).geocode({address:t},(function(t,o){if(o==google.maps.GeocoderStatus.OK&&t[0])for(var i=0;i<t[0].address_components.length;i++){var n=t[0].address_components[i];if("postal_code"==n.types[0]){var a=n.long_name;$$("codPostal").setValue(a),e=!0;break}}e||(p.a.errorMessage("Código postal no encontrado"),$$("codPostal").setValue(""))}))}}}]},{cols:[{view:"text",id:"codPostal",name:"codPostal",width:150,label:"cod. Postal",labelPosition:"top",required:!0},{view:"text",value:"MADRID",id:"provincia",name:"provincia",required:!0,label:"Provincia",labelPosition:"top",on:{onTimedKeyPress:function(){this.setValue(this.getValue().toUpperCase())}}}]}]}]}]}]}]}]}},t.prototype.init=function(e,t){},t.prototype.urlChange=function(e,t){i=r.a.checkLoggedUser(),n=i.comercialId,f.languageService.setLanguage(this.app,"es"),this.load()},t.prototype.load=function(){this.loadTiposViaFiscal(),this.loadTiposViaTrabajo(),this.loadTiposViaPostal(),this.loadDatosAgente(),this.loadTarifasCli(2),this.loadFormasPagoCli(11),this.loadTiposIvaCli(5),this.loadTiposCliente(1),this.loadNuevaCuentaContable(),this.$$("fechaAlta").setValue(new Date)},t.prototype.loadTiposViaFiscal=function(e){h().then((function(t){var o=d.a.prepareDataForCombo("tipoViaId","nombre",t),i=$$("cmbTiposViaFiscal").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposViaFiscal").setValue(e),$$("cmbTiposViaFiscal").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadTiposViaTrabajo=function(e){h().then((function(t){var o=d.a.prepareDataForCombo("tipoViaId","nombre",t),i=$$("cmbTiposViaTrabajo").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposViaTrabajo").setValue(e),$$("cmbTiposViaTrabajo").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadTiposViaPostal=function(e){h().then((function(t){var o=d.a.prepareDataForCombo("tipoViaId","nombre",t),i=$$("cmbTiposViaPostal").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposViaPostal").setValue(e),$$("cmbTiposViaPostal").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadColaborador=function(e){m.a.getColaboradores().then((function(t){var o=d.a.prepareDataForCombo("comercialId","nombre",t),i=$$("cmbColaboradores").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbColaboradores").setValue(e),$$("cmbColaboradores").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadDatosAgente=function(){var e=this;m.a.getAgente(n).then((function(t){t&&e.cargaDatosAgente(t)})).catch((function(e){console.log(e)}))},t.prototype.loadTarifasCli=function(e){s.a.getTarifasCliente().then((function(t){var o=d.a.prepareDataForCombo("tarifaClienteId","nombre",t),i=$$("cmbTarifasCliente").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTarifasCliente").setValue(e),$$("cmbTarifasCliente").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadFormasPagoCli=function(e){u.a.getFormasPago().then((function(t){var o=d.a.prepareDataForCombo("formaPagoId","nombre",t),i=$$("cmbFormasPagoCli2").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbFormasPagoCli2").setValue(e),$$("cmbFormasPagoCli2").refresh()):($$("cmbFormasPagoCli2").setValue(null),$$("cmbFormasPagoCli2").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadTiposIvaCli=function(e){l().then((function(t){var o=d.a.prepareDataForCombo("tipoIvaId","nombre",t),i=$$("cmbTiposIvaCli").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposIvaCli").setValue(e),$$("cmbTiposIvaCli").refresh())})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadTiposCliente=function(e){b.a.getTiposCliente().then((function(t){t.forEach((function(e){e.tipoClienteId=e.tipoClienteId+1}));var o=d.a.prepareDataForCombo("tipoClienteId","nombre",t),i=$$("cmbTiposCliente").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbTiposCliente").setValue(e),$$("cmbTiposCliente").refresh()})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.loadNuevaCuentaContable=function(){var e=this;b.a.getNuevaCuentaContable().then((function(t){t.codigo?b.a.getInfContable().then((function(o){if(o){$$("codigo").setValue(t.codigo);var i=e.montarCuentaContable("43",t.codigo,o.numDigitos);$$("cuentaContable").setValue(i)}else p.a.errorMessage("No se ha podido asignar un codigo de contabilidad, consulte con administración")})).catch((function(e){p.a.errorMessageAjax(e)})):p.a.errorMessage("No se ha podido asignar un codigo de contabilidad, consulte con administración")})).catch((function(e){p.a.errorMessageAjax(e)}))},t.prototype.montarCuentaContable=function(e,t,o){return""+e+Array(o-(""+e+t).length+1).join("0")+t},t.prototype.cargaDatosAgente=function(e){$$("direccion3").setValue(e.direccion),$$("codPostal3").setValue(e.codPostal),$$("poblacion3").setValue(e.poblacion),$$("provincia3").setValue(e.provincia),$$("contacto1").setValue(e.contacto1),$$("contacto2").setValue(e.contacto2),$$("telefono1").setValue(e.telefono1),$$("telefono2").setValue(e.telefono2),$$("email").setValue(e.email),$$("email2").setValue(e.email2),$$("emailFacturas").setValue(e.emailFacturas),this.loadTiposViaPostal(e.tipoViaId),this.loadColaborador(e.ascComercialId)},t.prototype.validateNifCif=function(e){e=(e=e.replace(/[a-z]/g,(function(e){return e.toUpperCase()}))).replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),$$("nif").setValue(e);var t=new RegExp(/^\d{8}[a-zA-Z]{1}$/).test(e),o=new RegExp(/^[a-zA-Z]{1}\d{7}[a-zA-Z0-9]{1}$/).test(e);t||o?b.a.compruebaNifRepetido(e).then((function(e){e&&p.a.errorMessage("Ya existe un cliente con este NIF/CIF.")})).catch((function(e){p.a.errorMessageAjax(e)})):(p.a.errorMessage("El nif/cif introducido no tiene un formato valido"),$$("nif").setValue(""))},t.prototype.accept=function(){if($$("frmCliente").validate()){var e=$$("frmCliente").getValues(),t=parseInt(e.tipoClienteId)-1,o={clienteId:0,proId:null,nombre:e.nombre,nombreComercial:e.nombre,nif:e.nif,fechaAlta:e.fechaAlta,fechaBaja:null,activa:1,contacto1:e.contacto1,contacto2:e.contacto2,direccion:e.direccion,poblacion:e.poblacion,provincia:e.provincia,codPostal:e.codPostal,telefono1:e.telefono1,telefono2:e.telefono2,fax:null,email:e.email,email2:e.email2,observaciones:null,tipoClienteId:t,formaPagoId:e.formaPagoId,cuentaContable:e.cuentaContable,iban:e.iban,comercialId:n,colaboradorId:e.comercialId,codigo:e.codigo,tipoViaId:e.tipoViaId,direccion2:e.direccion2,poblacion2:e.poblacion2,provincia2:e.provincia2,codPostal2:e.codPostal2,tipoViaId2:e.tipoViaId2,dniFirmante:e.dniFirmante,direccion3:e.direccion3,poblacion3:e.poblacion3,provincia3:e.provincia3,codPostal3:e.codPostal3,tipoViaId3:e.tipoViaId3,tarifaId:e.tarifaClienteId,tipoIvaId:e.tipoIvaId,facturarPorEmail:1,limiteCredito:e.limiteCredito,emailFacturas:e.emailFacturas};""!=o.colaboradorId&&o.colaboradorId||(o.colaboradorId=null),""!=o.tipoViaId3&&o.tipoViaId3||(o.tipoViaId3=null),b.a.postCliente(o).then((function(e){e&&c.a.getConfig().then((function(t){var o={asunto:"NUEVA SOLICITUD DE ALTA DE CLIENTE EN LA PLATAFORMA",cuerpo:"El usuario "+i.nombre+" ha dado de alta un nuevo cliente. Haga clic en este mensaje para verlo",url:t.urlApi+"/ClienteDetalle.html?ClienteId="+e.clienteId,id:e.clienteId,emisor:"proasistencia@proasistencia.es"};v.a.pushServicioApi(o).then((function(e){e&&g.a.postCorreoNuevoCliente(o).then((function(e){p.a.mensajeAceptar("Se ha dado de alta el cliente correctamente y notificado a administración.",window)})).catch((function(e){p.a.mensajeAceptar("Fallo al notificar el alta del cliente a administración, por favor, comuníquelo lo antes posible.",window)}))})).catch((function(e){p.a.mensajeAceptar("Fallo al notificar el alta del cliente a administración, por favor, comuníquelo lo antes posible.",window)}))})).catch((function(e){p.a.errorMessageAjax(e)}))})).catch((function(e){p.a.errorMessageAjax(e)}))}else p.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.isValidSpanishIBAN=function(e){var t,o,i,n,a;return 24==(e=(e=(e=e.toUpperCase()).trim()).replace(/\s/g,"")).length&&(t=e.substring(0,1),o=e.substring(1,2),i=this.getnumIBAN(t),n=this.getnumIBAN(o),a=(a=String(i)+String(n)+e.substring(2)).substring(6)+a.substring(0,6),1==this.modulo97(a)&&($$("iban").setValue(e),!0))},t.prototype.modulo97=function(e){for(var t=Math.ceil(e.length/7),o="",i=1;i<=t;i++)o=String(parseFloat(o+e.substr(7*(i-1),7))%97);return o},t.prototype.getnumIBAN=function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".search(e)+10},t}(a.c);t.default=y},function(e,t,o){"use strict";o.r(t);var i,n=o(3),a=o(2),r=o(6),s=o(7),c=o(1),l=o(0),u=o(12),p=!1,d={getPopup:function(){p||(webix.ui({view:"popup",id:"myPopup",width:400,height:300,top:200,left:300,body:{rows:[{view:"form",id:"frmCorreo",elements:[{cols:[{view:"text",id:"posibleCorreo",name:"posibleCorreo",label:"Introduzca su correo electronico",labelPosition:"top",minWidth:150}]},{rows:[{padding:5,cols:[{},{},{view:"button",label:"Aceptar",css:"webix_primary",click:d.accept,type:"form",hotkey:"enter"}]}]}]}]}}),p=!0)},loadPopup:function(){$$("myPopup").show(),l.a.getConfig().then((function(e){i=e})).catch((function(e){message.errorMessageAjax(e)}))},accept:function(){if($$("frmCorreo").validate()){var e={email:$$("frmCorreo").getValues().posibleCorreo};r.a.postClientePorCampo(e).then((function(t){if(t){var o=t.clienteId,n={nombreEmpresa:"Comercializa",emisor:"proveedores@comercializa.info",destinatario:e.email,asunto:"Restablecer contraseña",cuerpo:i.urlClient+"#!/restablecer?clienteId="+o};u.a.postCorreo(n).then((function(e){e&&($$("myPopup").hide(),c.a.normalMessage("Se ha enviado un enlace a su correo para restablecer su usario y contraseña"))})).catch((function(e){c.a.errorMessageAjax(e)}))}else s.a.postComercialPorCampo(e).then((function(t){if(t){var o=t.comercialId,n={nombreEmpresa:"Comercializa",emisor:"proveedores@comercializa.info",destinatario:e.email,asunto:"Restablecer contraseña",cuerpo:i.urlClient+"/#!/restablecer?comercialId="+o};u.a.postCorreo(n).then((function(e){e&&($$("myPopup").hide(),c.a.normalMessage("Se ha enviado un enlace a su correo para restablecer su usario y contraseña"))})).catch((function(e){c.a.errorMessageAjax(e)}))}else c.a.normalMessage("Correo incorrecto.")})).catch((function(e){c.a.errorMessageAjax(e)}))})).catch((function(e){c.a.errorMessageAjax(e.message)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")}};function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){return f(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return d.getPopup(),{view:"layout",css:"loginBack",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmLogin",elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png'/>"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login",id:"login",required:!0,label:"Usuario",labelPosition:"top"},{view:"text",type:"password",name:"password",id:"password",required:!0,label:"Contraseña",labelPosition:"top"},{view:"checkbox",id:"recordar",name:"recordar",label:"Recordarme en este equipo",labelWidth:200,labelAlign:"left",value:0},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){var e;l.a.getVersion().then((function(t){$$("version").data.label="VRS "+t.version,$$("version").refresh(),(e=a.a.getAccesoCookie())&&($$("login").setValue(e.login),$$("password").setValue(e.password),$$("recordar").setValue(1))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){var e=this;if($$("frmLogin").validate()){var t=void 0,o=$$("frmLogin").getValues(),i={};r.a.getClientesActivosLogin(o.login,o.password).then((function(n){n?((t=n).esCliente=!0,a.a.setUsuarioCookie(t),o.recordar?(i={login:o.login,password:o.password},a.a.deleteAccesoCookie(),a.a.setAccesoCookie(i)):a.a.deleteAccesoCookie(),e.$scope.show("top/inicio")):s.a.getAgentesActivosLogin(o.login,o.password).then((function(n){n&&((t=n).esCliente=!1,a.a.setUsuarioCookie(t),o.recordar?(i={login:o.login,password:o.password},a.a.setAccesoCookie(i)):a.a.deleteAccesoCookie(),e.$scope.show("top/inicio"))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}else c.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.cargarPopup=function(){d.loadPopup()},t}(n.c);t.default=m},function(e,t,o){"use strict";o.r(t);var i=o(3),n=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]});function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return a(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"datatable",autoConfig:!0,css:"webix_shadow_medium"}},t.prototype.init=function(e){e.parse(n)},t}(i.c);t.default=s},function(e,t,o){"use strict";o.r(t);o(40);var i=o(3),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e};var a=function(e){function t(o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a={id:"REPCLIENTES",version:"2.3.192",router:i.a,debug:!1,start:"/login"};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n({},a,o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(i.b);t.default=a,webix.ready((function(){var e=new a;e.use(i.d.Locale),e.use(i.d.Theme),webix.i18n.setLocale("es-ES"),e.render()}))},function(e,t,o){},function(e,t,o){var i={"./creacionClienteForm":36,"./creacionClienteForm.js":36,"./creacionServicioForm":21,"./creacionServicioForm.js":21,"./data":38,"./data.js":38,"./facturas":22,"./facturas.js":22,"./facturasEpisReport":15,"./facturasEpisReport.js":15,"./imprimirWindow":23,"./imprimirWindow.js":23,"./inicio":24,"./inicio.js":24,"./lineasTarifaProfesion":25,"./lineasTarifaProfesion.js":25,"./login":37,"./login.js":37,"./mainFooter":18,"./mainFooter.js":18,"./mainMenu":16,"./mainMenu.js":16,"./mainToolbar":17,"./mainToolbar.js":17,"./partes":35,"./partes.js":35,"./restablecer":26,"./restablecer.js":26,"./servicios":27,"./servicios.js":27,"./serviciosForm":28,"./serviciosForm.js":28,"./start":29,"./start.js":29,"./tarifas":30,"./tarifas.js":30,"./top":31,"./top.js":31};function n(e){var t=a(e);return o(t)}function a(e){if(!o.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=a,e.exports=n,n.id=41},function(e,t,o){var i={"./en":32,"./en.js":32,"./es":33,"./es.js":33,"./fr.":34,"./fr..js":34,"./language_service":5,"./language_service.js":5};function n(e){var t=a(e);return o(t)}function a(e){if(!o.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=a,e.exports=n,n.id=42}]);